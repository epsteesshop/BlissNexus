<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BlissNexus Arcade â€” 50 Games vs AI</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@400;500;600&display=swap');

:root{
  --bg:#080810;--bg2:#0e0e1a;--bg3:#161625;--bg4:#1e1e30;
  --acc:#00ff88;--a2:#ff4488;--a3:#4488ff;--a4:#ffcc00;--a5:#ff6600;--a6:#aa44ff;
  --tx:#d0d8f0;--dm:#4a5080;
  --arcade:#ff6600;--board:#4488ff;--card:#ffcc00;--puzzle:#aa44ff;--word:#00ccff;--casual:#44ff88;
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{width:100%;min-height:100vh;background:var(--bg);color:var(--tx);font-family:'Inter',sans-serif;overflow-x:hidden;}

/* â”€â”€ BACKGROUND â”€â”€ */
body::before{content:'';position:fixed;inset:0;background:
  radial-gradient(ellipse 80% 50% at 20% 20%, #00ff8808 0%, transparent 60%),
  radial-gradient(ellipse 60% 40% at 80% 80%, #4488ff08 0%, transparent 60%),
  radial-gradient(ellipse 40% 60% at 50% 50%, #ff448806 0%, transparent 70%);
  pointer-events:none;z-index:0;}
body::after{content:'';position:fixed;inset:0;background-image:
  linear-gradient(rgba(0,255,136,.03) 1px,transparent 1px),
  linear-gradient(90deg,rgba(0,255,136,.03) 1px,transparent 1px);
  background-size:40px 40px;pointer-events:none;z-index:0;}
#hub{position:relative;z-index:1;padding:12px 14px 40px;}

/* â”€â”€ HEADER â”€â”€ */
.hdr{text-align:center;padding:28px 0 20px;border-bottom:1px solid #1a2040;}
.title{font-family:'Orbitron',monospace;font-size:2rem;font-weight:900;
  background:linear-gradient(135deg,#00ff88,#4488ff,#ff4488);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  letter-spacing:.08em;text-shadow:none;filter:drop-shadow(0 0 20px #00ff8844);}
.sub{font-size:.58rem;color:var(--dm);letter-spacing:.25em;margin-top:5px;text-transform:uppercase;}
.ai-pill{display:inline-flex;align-items:center;gap:7px;background:linear-gradient(135deg,#0a1a12,#0a1020);
  border:1px solid #00ff8840;border-radius:20px;padding:5px 14px;font-size:.6rem;
  color:var(--acc);margin-top:10px;font-family:'Orbitron',monospace;letter-spacing:.05em;
  box-shadow:0 0 20px #00ff8815;}
.dot{width:7px;height:7px;background:var(--acc);border-radius:50%;
  box-shadow:0 0 8px var(--acc);animation:blink 1.4s ease infinite;}
@keyframes blink{0%,100%{opacity:1;box-shadow:0 0 8px var(--acc);}50%{opacity:.3;box-shadow:none;}}

/* â”€â”€ CATEGORY TABS â”€â”€ */
.cats{display:flex;gap:6px;justify-content:center;flex-wrap:wrap;padding:14px 0 16px;}
.cat{padding:5px 14px;background:var(--bg3);border:1px solid #2a3050;border-radius:20px;
  font-size:.58rem;color:var(--dm);cursor:pointer;transition:all .18s;font-weight:600;letter-spacing:.04em;text-transform:uppercase;}
.cat:hover{border-color:var(--acc);color:var(--acc);background:var(--bg4);}
.cat.on{background:linear-gradient(135deg,#001a0e,#001428);border-color:var(--acc);color:var(--acc);
  box-shadow:0 0 12px #00ff8820;}

/* â”€â”€ GAME GRID â”€â”€ */
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:9px;}
.card{background:var(--bg2);border:1px solid #1e2040;border-radius:12px;
  padding:14px 8px 12px;text-align:center;cursor:pointer;transition:all .2s;
  position:relative;overflow:hidden;}
.card::before{content:'';position:absolute;inset:0;opacity:0;transition:opacity .2s;
  background:radial-gradient(ellipse at top,var(--card-glow,#00ff8820),transparent 70%);}
.card:hover{border-color:var(--card-color,var(--acc));transform:translateY(-3px);
  box-shadow:0 8px 24px var(--card-shadow,#00ff8820);}
.card:hover::before{opacity:1;}
.card:active{transform:translateY(-1px);}
.card.hide{display:none;}
.card[data-cat="Arcade"]{--card-color:#ff6600;--card-shadow:#ff660025;--card-glow:#ff660018;}
.card[data-cat="Board"]{--card-color:#4488ff;--card-shadow:#4488ff25;--card-glow:#4488ff18;}
.card[data-cat="Card"]{--card-color:#ffcc00;--card-shadow:#ffcc0025;--card-glow:#ffcc0018;}
.card[data-cat="Puzzle"]{--card-color:#aa44ff;--card-shadow:#aa44ff25;--card-glow:#aa44ff18;}
.card[data-cat="Word"]{--card-color:#00ccff;--card-shadow:#00ccff25;--card-glow:#00ccff18;}
.card[data-cat="Casual"]{--card-color:#44ff88;--card-shadow:#44ff8825;--card-glow:#44ff8818;}
.ci{font-size:1.7rem;margin-bottom:6px;display:block;filter:drop-shadow(0 2px 4px rgba(0,0,0,.4));}
.cn{font-size:.54rem;color:var(--tx);font-weight:600;line-height:1.3;}
.cc{font-size:.44rem;color:var(--dm);margin-top:2px;text-transform:uppercase;letter-spacing:.08em;}
.badge{position:absolute;top:5px;right:5px;font-size:.38rem;font-weight:700;
  background:var(--bg4);color:var(--a3);border:1px solid #4488ff44;border-radius:3px;
  padding:1px 4px;letter-spacing:.06em;}

/* â”€â”€ MODAL â”€â”€ */
#modal{position:fixed;inset:0;z-index:999;background:rgba(0,0,0,.85);
  backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;}
#modal.on{display:flex;}
#mbox{background:var(--bg2);border:1px solid #2a3060;border-radius:16px;
  width:min(98vw,660px);max-height:94vh;display:flex;flex-direction:column;
  overflow:hidden;box-shadow:0 24px 80px rgba(0,0,0,.7),0 0 0 1px #ffffff08;}
#mhdr{display:flex;align-items:center;justify-content:space-between;
  padding:12px 16px;border-bottom:1px solid #1a2040;
  background:linear-gradient(90deg,var(--bg3),var(--bg2));}
#mtitle{font-family:'Orbitron',monospace;font-size:.78rem;font-weight:700;
  color:var(--acc);letter-spacing:.06em;}
#msc{font-size:.58rem;color:var(--dm);margin-left:8px;}
#mcls{background:transparent;border:1px solid #2a3050;color:var(--dm);
  padding:4px 10px;border-radius:6px;cursor:pointer;font-size:.65rem;font-family:inherit;
  transition:all .14s;letter-spacing:.04em;}
#mcls:hover{border-color:var(--a2);color:var(--a2);background:#1a0a10;}
#mgame{flex:1;overflow:auto;display:flex;flex-direction:column;align-items:center;
  justify-content:center;padding:14px;min-height:360px;background:var(--bg);}
#mft{padding:8px 14px;border-top:1px solid #1a2040;display:flex;gap:7px;align-items:center;
  background:var(--bg2);}
.mb{padding:5px 14px;background:var(--bg3);border:1px solid #2a3050;color:var(--tx);
  border-radius:7px;cursor:pointer;font-size:.6rem;font-family:inherit;transition:all .14s;
  letter-spacing:.04em;}
.mb:hover{border-color:var(--acc);color:var(--acc);background:var(--bg4);}
.mb:active{transform:scale(.97);}
.mb.p{background:linear-gradient(135deg,#005533,#008844);border-color:var(--acc);
  color:#fff;font-weight:600;box-shadow:0 2px 12px #00ff8830;}
.mb.p:hover{box-shadow:0 4px 20px #00ff8850;}
.aif{margin-left:auto;font-size:.56rem;color:var(--acc);display:flex;align-items:center;
  gap:5px;font-family:'Orbitron',monospace;letter-spacing:.04em;}

/* â”€â”€ GAME UI â”€â”€ */
canvas{display:block;background:#000;border:1px solid #1a2040;border-radius:6px;max-width:100%;
  box-shadow:0 4px 20px rgba(0,0,0,.5);}
.gw{display:flex;flex-direction:column;align-items:center;gap:9px;width:100%;}
.msg{font-size:.68rem;color:var(--a4);text-align:center;min-height:18px;
  letter-spacing:.04em;font-weight:500;}
.brd{display:inline-grid;gap:2px;background:#0a0e20;padding:5px;border-radius:8px;
  box-shadow:0 4px 20px rgba(0,0,0,.5);}
.cl{display:flex;align-items:center;justify-content:center;cursor:pointer;
  border-radius:4px;transition:all .1s;}
.slr{display:flex;gap:8px;justify-content:center;}
.reel{width:68px;height:76px;background:linear-gradient(180deg,#1a1a2e,#0a0a1a);
  border:2px solid #2a3050;border-radius:10px;display:flex;align-items:center;
  justify-content:center;font-size:2.2rem;box-shadow:inset 0 2px 8px rgba(0,0,0,.5);}
.crd{width:54px;height:72px;background:linear-gradient(180deg,#1a1a2e,#0e0e1a);
  border:1px solid #2a3050;border-radius:8px;display:flex;align-items:center;
  justify-content:center;font-size:.9rem;cursor:pointer;user-select:none;
  transition:all .14s;box-shadow:0 2px 8px rgba(0,0,0,.3);}
.crd:hover{border-color:var(--acc);transform:translateY(-2px);}
.crd.flip{background:linear-gradient(180deg,#0a1a0e,#061210);border-color:var(--acc);}
.mcl{width:24px;height:24px;background:#0e1020;border:1px solid #2a3050;
  display:flex;align-items:center;justify-content:center;font-size:.6rem;
  cursor:pointer;border-radius:3px;font-weight:700;transition:background .1s;}
.mcl:hover{background:#1a2030;}
.mcl.op{background:#1a1a28;border-color:#0a0e20;}
.g48{display:grid;grid-template-columns:repeat(4,62px);gap:6px;
  background:#0a0e20;padding:6px;border-radius:10px;
  box-shadow:0 4px 20px rgba(0,0,0,.5);}
.t2{width:62px;height:62px;display:flex;align-items:center;justify-content:center;
  border-radius:7px;font-weight:900;font-size:.78rem;transition:all .12s;
  box-shadow:inset 0 1px 0 rgba(255,255,255,.1);}
.sg{display:grid;grid-template-columns:1fr 1fr;gap:7px;width:186px;height:186px;}
.sb{border-radius:10px;cursor:pointer;border:none;transition:opacity .1s;
  box-shadow:0 4px 12px rgba(0,0,0,.4);}
.sb:active{opacity:.7 !important;}
.hw{display:flex;flex-wrap:wrap;gap:4px;justify-content:center;}
.hb{width:28px;height:28px;background:var(--bg3);border:1px solid #2a3050;
  color:var(--tx);border-radius:5px;cursor:pointer;font-size:.62rem;font-family:inherit;
  transition:all .12s;}
.hb:hover:not([disabled]){border-color:var(--acc);color:var(--acc);}
.hb[disabled]{opacity:.2;cursor:not-allowed;}
.bg2{display:inline-grid;grid-template-columns:repeat(10,26px);gap:1px;
  background:#080810;padding:4px;border-radius:4px;}
.bc{width:26px;height:26px;background:#0e1020;display:flex;align-items:center;
  justify-content:center;font-size:.72rem;cursor:pointer;border-radius:3px;
  transition:background .1s;}
.bc:hover{background:#1a2030;}

/* â”€â”€ MOBILE â”€â”€ */
@media(max-width:600px){
  .title{font-size:1.4rem;}
  .grid{grid-template-columns:repeat(auto-fill,minmax(82px,1fr));gap:6px;}
  .card{padding:10px 6px;}
  .ci{font-size:1.4rem;}
  .cn{font-size:.5rem;}
  #mbox{width:100vw;max-height:100dvh;border-radius:20px 20px 0 0;border-bottom:none;}
  #modal{align-items:flex-end;}
  #mgame{padding:8px;min-height:280px;}
  canvas{width:100% !important;height:auto !important;}
  .g48{grid-template-columns:repeat(4,calc(22vw - 8px));}
  .t2{width:calc(22vw - 8px);height:calc(22vw - 8px);font-size:.68rem;}
  .mcl{width:20px;height:20px;font-size:.55rem;}
  #mine-g{grid-template-columns:repeat(16,20px) !important;}
  .sg{width:160px;height:160px;}
  .hb{width:24px;height:24px;font-size:.55rem;}
}
input,textarea,select{font-size:16px !important;}
</style></head><body>
<div id="hub">
  <div class="hdr">
    <div class="title">BLISSNEXUS ARCADE</div>
    <div class="sub">50 Classic Games &middot; Play vs AI</div>
    <div class="ai-pill"><div class="dot"></div>Diddy &#x1F9BE; &nbsp;Â·&nbsp; Online &amp; Ready</div>
  </div>
  <div class="cats" id="cats"></div>
  <div class="grid" id="grid"></div>
</div>
<div id="modal">
  <div id="mbox">
    <div id="mhdr">
      <div style="display:flex;align-items:center;gap:6px;">
        <div id="mtitle">GAME</div><div id="msc"></div>
      </div>
      <button id="mcls" onclick="closeGame()">&#x2715; EXIT</button>
    </div>
    <div id="mgame"></div>
    <div id="mft">
      <button class="mb p" onclick="newGame()">&#x21BA; NEW</button>
      <button class="mb" onclick="gameHint()">&#x1F4A1; HINT</button>
      <div class="aif"><div class="dot"></div>vs Diddy &#x1F9BE;</div>
    </div>
  </div>
</div>
<script>
const GAMES=[
  {id:"pong",name:"Ping Pong AI",icon:"ðŸ“",cat:"Arcade"},
  {id:"snake",name:"Snake AI",icon:"ðŸ",cat:"Arcade"},
  {id:"breakout",name:"Breakout AI",icon:"ðŸ§±",cat:"Arcade"},
  {id:"invaders",name:"Space Invaders AI",icon:"ðŸ‘¾",cat:"Arcade"},
  {id:"flappy",name:"Flappy Bird AI",icon:"ðŸ¦",cat:"Arcade"},
  {id:"whack",name:"Whack-a-Mole AI",icon:"ðŸ”¨",cat:"Arcade"},
  {id:"tron",name:"Light Cycles AI",icon:"ðŸ",cat:"Arcade"},
  {id:"asteroids",name:"Asteroids AI",icon:"â˜„",cat:"Arcade"},
  {id:"frogger",name:"Frogger AI",icon:"ðŸ¸",cat:"Arcade"},
  {id:"pacman",name:"Pac-Man AI",icon:"ðŸŸ¡",cat:"Arcade"},
  {id:"ttt",name:"Tic Tac Toe AI",icon:"â­•",cat:"Board"},
  {id:"c4",name:"Connect Four AI",icon:"ðŸ”µ",cat:"Board"},
  {id:"checkers",name:"Checkers AI",icon:"ðŸŸ¤",cat:"Board"},
  {id:"reversi",name:"Reversi AI",icon:"âš«",cat:"Board"},
  {id:"dots",name:"Dots & Boxes AI",icon:"ðŸŸ«",cat:"Board"},
  {id:"battleship",name:"Battleship AI",icon:"ðŸš¢",cat:"Board"},
  {id:"gomoku",name:"Gomoku AI",icon:"ðŸ”µ",cat:"Board"},
  {id:"chess",name:"Chess AI",icon:"â™Ÿ",cat:"Board"},
  {id:"mancala",name:"Mancala AI",icon:"ðŸª£",cat:"Board"},
  {id:"nim",name:"Nim AI",icon:"ðŸŽ¯",cat:"Board"},
  {id:"blackjack",name:"Blackjack AI",icon:"ðŸ‚¾",cat:"Card"},
  {id:"memory",name:"Memory Match AI",icon:"ðŸƒ",cat:"Card"},
  {id:"slots",name:"Slots AI",icon:"ðŸŽ°",cat:"Card"},
  {id:"yahtzee",name:"Yahtzee AI",icon:"ðŸŽ²",cat:"Card"},
  {id:"solitaire",name:"Solitaire AI",icon:"â™ ",cat:"Card"},
  {id:"war",name:"War AI",icon:"âš”",cat:"Card"},
  {id:"poker",name:"Video Poker AI",icon:"ðŸƒ",cat:"Card"},
  {id:"hilo",name:"Hi-Lo AI",icon:"ðŸ“ˆ",cat:"Card"},
  {id:"mines",name:"Minesweeper AI",icon:"ðŸ’£",cat:"Puzzle"},
  {id:"tetris",name:"Tetris AI",icon:"ðŸŸ¦",cat:"Puzzle"},
  {id:"g2048",name:"2048 AI",icon:"ðŸ”¢",cat:"Puzzle"},
  {id:"p15",name:"15 Puzzle AI",icon:"ðŸ”€",cat:"Puzzle"},
  {id:"sokoban",name:"Sokoban AI",icon:"ðŸ“¦",cat:"Puzzle"},
  {id:"simon",name:"Simon Says AI",icon:"ðŸ”´",cat:"Puzzle"},
  {id:"sudoku",name:"Sudoku AI",icon:"ðŸ”£",cat:"Puzzle"},
  {id:"towers",name:"Tower of Hanoi AI",icon:"ðŸ—¼",cat:"Puzzle"},
  {id:"lights",name:"Lights Out AI",icon:"ðŸ’¡",cat:"Puzzle"},
  {id:"pipe",name:"Pipe Dream AI",icon:"ðŸ”§",cat:"Puzzle"},
  {id:"hangman",name:"Hangman AI",icon:"ðŸª¢",cat:"Word"},
  {id:"wordsearch",name:"Word Search AI",icon:"ðŸ”¤",cat:"Word"},
  {id:"scramble",name:"Word Scramble AI",icon:"ðŸ”¡",cat:"Word"},
  {id:"typerace",name:"Type Racer AI",icon:"âŒ¨",cat:"Word"},
  {id:"rps",name:"Rock Paper Scissors AI",icon:"âœŠ",cat:"Casual"},
  {id:"reaction",name:"Reaction Time AI",icon:"âš¡",cat:"Casual"},
  {id:"numguess",name:"Number Guess AI",icon:"â“",cat:"Casual"},
  {id:"bowling",name:"Bowling AI",icon:"ðŸŽ³",cat:"Casual"},
  {id:"coin",name:"Coin Flip AI",icon:"ðŸª™",cat:"Casual"},
  {id:"mathquiz",name:"Math Quiz AI",icon:"âž•",cat:"Casual"},
  {id:"colormatch",name:"Color Match AI",icon:"ðŸŽ¨",cat:"Casual"},
  {id:"trivia",name:"Trivia AI",icon:"ðŸ§ ",cat:"Casual"},
];
const CATS=["All","Arcade","Board","Card","Puzzle","Word","Casual"];
const catsEl=document.getElementById("cats");
CATS.forEach((c,i)=>{
  const d=document.createElement("div");d.className="cat"+(i===0?" on":"");
  d.textContent=c==="All"?"All (50)":c;
  d.onclick=()=>{document.querySelectorAll(".cat").forEach(x=>x.classList.remove("on"));d.classList.add("on");document.querySelectorAll(".card").forEach(x=>x.classList.toggle("hide",c!=="All"&&x.dataset.cat!==c));};
  catsEl.appendChild(d);
});
const grid=document.getElementById("grid");
GAMES.forEach(g=>{
  const d=document.createElement("div");d.className="card";d.dataset.cat=g.cat;
  d.innerHTML='<div class="badge">AI</div><span class="ci">'+g.icon+'</span><div class="cn">'+g.name+'</div><div class="cc">'+g.cat+'</div>';
  d.onclick=()=>openGame(g.id);grid.appendChild(d);
});
let CUR=null;
function openGame(id){
  const g=GAMES.find(x=>x.id===id);if(!g)return;
  CUR=id;
  document.getElementById("mtitle").textContent=g.icon+" "+g.name.toUpperCase();
  document.getElementById("msc").textContent="";
  document.getElementById("mgame").innerHTML="";
  document.getElementById("modal").classList.add("on");
  if(IMPL[id])IMPL[id].init();else stub(g);
}
function closeGame(){document.getElementById("modal").classList.remove("on");if(CUR&&IMPL[CUR]&&IMPL[CUR].cleanup)IMPL[CUR].cleanup();CUR=null;document.onkeydown=null;}
function newGame(){if(CUR&&IMPL[CUR])IMPL[CUR].init();}
function gameHint(){if(CUR&&IMPL[CUR]&&IMPL[CUR].hint)IMPL[CUR].hint();else say("Think ahead and outplay Diddy!");}
function say(m){document.getElementById("msc").textContent=m;}
function stub(g){document.getElementById("mgame").innerHTML='<div style="text-align:center;padding:40px;color:var(--dm)"><div style="font-size:3rem">'+g.icon+'</div><div style="font-size:.8rem;margin-top:10px;color:var(--acc)">'+g.name+'</div><div style="font-size:.6rem;margin-top:6px">Loadingâ€¦</div></div>';}
function mkC(w,h){const c=document.createElement("canvas");c.width=w;c.height=h;return c;}
function sHUD(a,b){say("You: "+a+"   Diddy: "+b);}
const IMPL={};
// â”€â”€ PONG â”€â”€
IMPL.pong={raf:null,cleanup(){cancelAnimationFrame(this.raf);},
init(){
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const W=440,H=280,c=mkC(W,H);mg.appendChild(c);const ctx=c.getContext("2d");
  const PH=54,PW=9;let ps=H/2-PH/2,ai=H/2-PH/2,bx=W/2,by=H/2,bvx=4,bvy=2,pS=0,aS=0;
  const keys={};document.onkeydown=e=>keys[e.key]=1;document.onkeyup=e=>delete keys[e.key];
  c.onmousemove=e=>{const r=c.getBoundingClientRect();ps=Math.max(0,Math.min(H-PH,(e.clientY-r.top)*H/r.height-PH/2));};
  const loop=()=>{
    if(keys.ArrowUp)ps=Math.max(0,ps-5);if(keys.ArrowDown)ps=Math.min(H-PH,ps+5);
    const aim=by-PH/2;ai+=(aim-ai)*0.09;ai=Math.max(0,Math.min(H-PH,ai));
    bx+=bvx;by+=bvy;
    if(by<6||by>H-6)bvy*=-1;
    if(bx<PW+10&&by>ps&&by<ps+PH&&bvx<0){bvx=Math.abs(bvx)+0.15;bvy+=(by-ps-PH/2)*0.07;}
    if(bx>W-PW-10&&by>ai&&by<ai+PH&&bvx>0){bvx=-Math.abs(bvx)-0.15;bvy+=(by-ai-PH/2)*0.07;}
    bvy=Math.max(-8,Math.min(8,bvy));
    if(bx<0){aS++;bx=W/2;by=H/2;bvx=4;bvy=2*(Math.random()>.5?1:-1);}
    if(bx>W){pS++;bx=W/2;by=H/2;bvx=-4;bvy=2*(Math.random()>.5?1:-1);}
    sHUD(pS,aS);
    ctx.fillStyle="#000";ctx.fillRect(0,0,W,H);
    ctx.setLineDash([6,6]);ctx.strokeStyle="#1a2030";ctx.lineWidth=2;
    ctx.beginPath();ctx.moveTo(W/2,0);ctx.lineTo(W/2,H);ctx.stroke();ctx.setLineDash([]);
    ctx.fillStyle="#00ff88";ctx.fillRect(8,ps,PW,PH);
    ctx.fillStyle="#ff4488";ctx.fillRect(W-8-PW,ai,PW,PH);
    ctx.fillStyle="#fff";ctx.beginPath();ctx.arc(bx,by,6,0,Math.PI*2);ctx.fill();
    ctx.fillStyle="#888";ctx.font="bold 16px monospace";ctx.textAlign="center";
    ctx.fillText(pS,W/4,22);ctx.fillText(aS,3*W/4,22);
    this.raf=requestAnimationFrame(loop);
  };loop();
},hint(){say("Mouse or arrow keys. Edge hits = sharper angles!");}};

// â”€â”€ SNAKE AI: Two snakes, same board â”€â”€
IMPL.snake={iv:null,cleanup(){clearInterval(this.iv);},
init(){
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const CS=16,C=24,R=18,W=C*CS,H=R*CS,c=mkC(W,H);mg.appendChild(c);const ctx=c.getContext("2d");
  let psn=[{x:4,y:9},{x:3,y:9},{x:2,y:9}],pdir={x:1,y:0};
  let asn=[{x:19,y:9},{x:20,y:9},{x:21,y:9}],adir={x:-1,y:0};
  let food={x:12,y:9},pScore=0,aScore=0,alive=true;
  const rand=()=>({x:Math.floor(Math.random()*C),y:Math.floor(Math.random()*R)});
  document.onkeydown=e=>{const m={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};if(m[e.key]&&!(m[e.key].x===-pdir.x&&m[e.key].y===-pdir.y))pdir=m[e.key];};
  // AI pathfinding: simple food-seeking
  const aiDir=()=>{const h=asn[0];const opts=[{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}].filter(d=>!(d.x===-adir.x&&d.y===-adir.y));const safe=opts.filter(d=>{const nx=(h.x+d.x+C)%C,ny=(h.y+d.y+R)%R;return!asn.some(s=>s.x===nx&&s.y===ny)&&!psn.some(s=>s.x===nx&&s.y===ny);});if(!safe.length)return adir;const best=safe.sort((a,b)=>{const ax=Math.abs((h.x+a.x+C)%C-food.x)+Math.abs((h.y+a.y+R)%R-food.y);const bx=Math.abs((h.x+b.x+C)%C-food.x)+Math.abs((h.y+b.y+R)%R-food.y);return ax-bx;});return best[0];};
  clearInterval(this.iv);this.iv=setInterval(()=>{
    if(!alive)return;
    adir=aiDir();
    const ph={x:(psn[0].x+pdir.x+C)%C,y:(psn[0].y+pdir.y+R)%R};
    const ah={x:(asn[0].x+adir.x+C)%C,y:(asn[0].y+adir.y+R)%R};
    const allSegs=[...psn,...asn];
    const pDead=allSegs.some(s=>s.x===ph.x&&s.y===ph.y);
    const aDead=allSegs.some(s=>s.x===ah.x&&s.y===ah.y);
    if(pDead||aDead){alive=false;say(pDead&&aDead?"Draw!":pDead?"Diddy wins! ðŸ¤–":pScore>aScore?"You win! ðŸŽ‰":"Diddy wins! ðŸ¤–");return;}
    psn.unshift(ph);asn.unshift(ah);
    let newFood=false;
    if(ph.x===food.x&&ph.y===food.y){pScore++;newFood=true;}else psn.pop();
    if(ah.x===food.x&&ah.y===food.y){aScore++;newFood=true;}else asn.pop();
    if(newFood){do{food=rand();}while([...psn,...asn].some(s=>s.x===food.x&&s.y===food.y));}
    sHUD(pScore,aScore);
    ctx.fillStyle="#050508";ctx.fillRect(0,0,W,H);
    // grid
    ctx.strokeStyle="#0a0a14";ctx.lineWidth=0.5;
    for(let i=0;i<=C;i++){ctx.beginPath();ctx.moveTo(i*CS,0);ctx.lineTo(i*CS,H);ctx.stroke();}
    for(let i=0;i<=R;i++){ctx.beginPath();ctx.moveTo(0,i*CS);ctx.lineTo(W,i*CS);ctx.stroke();}
    // food glow
    ctx.shadowColor="#ff4488";ctx.shadowBlur=12;ctx.fillStyle="#ff4488";ctx.fillRect(food.x*CS+3,food.y*CS+3,CS-6,CS-6);ctx.shadowBlur=0;
    // player snake
    psn.forEach((s,i)=>{ctx.fillStyle=i===0?"#00ff88":i<3?"#00dd70":"#00aa55";if(i===0){ctx.shadowColor="#00ff88";ctx.shadowBlur=8;}else ctx.shadowBlur=0;ctx.fillRect(s.x*CS+1,s.y*CS+1,CS-2,CS-2);});ctx.shadowBlur=0;
    // ai snake
    asn.forEach((s,i)=>{ctx.fillStyle=i===0?"#ff4488":i<3?"#dd3366":"#aa2244";if(i===0){ctx.shadowColor="#ff4488";ctx.shadowBlur=8;}else ctx.shadowBlur=0;ctx.fillRect(s.x*CS+1,s.y*CS+1,CS-2,CS-2);});ctx.shadowBlur=0;
    // labels
    ctx.font="bold 10px Inter,sans-serif";ctx.fillStyle="#00ff88";ctx.textAlign="left";ctx.fillText("YOU: "+pScore,4,12);ctx.fillStyle="#ff4488";ctx.textAlign="right";ctx.fillText("DIDDY: "+aScore,W-4,12);
    if(!alive){ctx.fillStyle="rgba(0,0,0,.75)";ctx.fillRect(0,0,W,H);ctx.shadowColor=pScore>aScore?"#00ff88":"#ff4488";ctx.shadowBlur=20;ctx.fillStyle=pScore>aScore?"#00ff88":"#ff4488";ctx.font="bold 20px Orbitron,monospace";ctx.textAlign="center";ctx.fillText(pScore>aScore?"YOU WIN":"DIDDY WINS",W/2,H/2);ctx.shadowBlur=0;}
  },130);
  mg.appendChild(mkDpad({up:()=>document.onkeydown&&document.onkeydown({key:"ArrowUp",preventDefault:()=>{}}),down:()=>document.onkeydown&&document.onkeydown({key:"ArrowDown",preventDefault:()=>{}}),left:()=>document.onkeydown&&document.onkeydown({key:"ArrowLeft",preventDefault:()=>{}}),right:()=>document.onkeydown&&document.onkeydown({key:"ArrowRight",preventDefault:()=>{}})}));
},hint(){say("Green = you, Pink = Diddy. Eat food, avoid each other. First to die loses!");}};

// â”€â”€ BREAKOUT AI: Split screen race â”€â”€
IMPL.breakout={raf:null,cleanup(){cancelAnimationFrame(this.raf);},
init(){
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const W=420,H=300,c=mkC(W,H);mg.appendChild(c);const ctx=c.getContext("2d");
  const LW=W/2-2,BW=36,BH=11,G=2,ROWS=5,COLS=9;
  const mkBricks=()=>[];
  let pb=[],ab=[],go=false;
  const mkB=()=>{const b=[];for(let r=0;r<ROWS;r++)for(let cc=0;cc<COLS;cc++)b.push({x:cc*(BW+G)+G,y:r*(BH+G)+G+28,col:["#ff4488","#ff8844","#ffcc44","#44ff88","#4488ff"][r]});return b;};
  pb=mkB();ab=mkB();
  let pp=LW/2-35,ap=LW/2-35;
  let pbx=LW/2,pby=H-55,pbvx=3,pbvy=-4;
  let abx=LW/2,aby=H-55,abvx=-3,abvy=-4;
  let pLives=3,aLives=3,pWon=false,aWon=false;
  c.onmousemove=e=>{const r=c.getBoundingClientRect();const rx=(e.clientX-r.left)*W/r.width;if(rx<LW)pp=Math.max(0,Math.min(LW-70,rx-35));};
  c.onclick=()=>go=true;
  document.onkeydown=e=>{if(e.key==="ArrowLeft")pp=Math.max(0,pp-18);if(e.key==="ArrowRight")pp=Math.min(LW-70,pp+18);if(e.key===" ")go=true;};
  const loop=()=>{
    if(go){pbx+=pbvx;pby+=pbvy;abx+=abvx;aby+=abvy;}
    // Player ball physics
    if(pbx<=5||pbx>=LW-5)pbvx*=-1;if(pby<=5)pbvy*=-1;
    if(pby>H){pLives--;pbx=LW/2;pby=H-70;pbvx=3;pbvy=-4;go=false;}
    if(pby>=H-30&&pby<=H-21&&pbx>=pp&&pbx<=pp+70){pbvy=-Math.abs(pbvy);pbvx+=(pbx-pp-35)/35*3;}
    for(let i=pb.length-1;i>=0;i--){const b=pb[i];if(pbx>b.x&&pbx<b.x+BW&&pby>b.y&&pby<b.y+BH){pb.splice(i,1);pbvy*=-1;break;}}
    if(!pb.length)pWon=true;
    // AI ball + AI paddle AI
    if(abx<=5||abx>=LW-5)abvx*=-1;if(aby<=5)abvy*=-1;
    if(aby>H){aLives--;abx=LW/2;aby=H-70;abvx=-3;abvy=-4;}
    const aim=abx-35;ap+=(aim-ap)*0.12;ap=Math.max(0,Math.min(LW-70,ap));
    if(aby>=H-30&&aby<=H-21&&abx>=ap&&abx<=ap+70){abvy=-Math.abs(abvy);abvx+=(abx-ap-35)/35*3;}
    for(let i=ab.length-1;i>=0;i--){const b=ab[i];if(abx>b.x&&abx<b.x+BW&&aby>b.y&&aby<b.y+BH){ab.splice(i,1);abvy*=-1;break;}}
    if(!ab.length)aWon=true;
    // Draw
    ctx.fillStyle="#050508";ctx.fillRect(0,0,W,H);
    ctx.fillStyle="#1a2040";ctx.fillRect(W/2-1,0,2,H);
    ctx.font="bold 9px Inter";ctx.textAlign="center";ctx.fillStyle="#00ff88";ctx.fillText("YOU  â¤".repeat(pLives).trim(),LW/2,12);ctx.fillStyle="#ff4488";ctx.fillText("â¤".repeat(aLives)+"  DIDDY",LW+LW/2,12);
    // Draw bricks
    pb.forEach(b=>{ctx.fillStyle=b.col;ctx.fillRect(b.x,b.y,BW,BH);ctx.fillStyle="rgba(255,255,255,.15)";ctx.fillRect(b.x,b.y,BW,3);});
    ab.forEach(b=>{ctx.fillStyle=b.col;ctx.fillRect(LW+2+b.x,b.y,BW,BH);ctx.fillStyle="rgba(255,255,255,.15)";ctx.fillRect(LW+2+b.x,b.y,BW,3);});
    // Paddles
    ctx.shadowColor="#00ff88";ctx.shadowBlur=8;ctx.fillStyle="#00ff88";ctx.fillRect(pp,H-24,70,8);ctx.shadowBlur=0;
    ctx.shadowColor="#ff4488";ctx.shadowBlur=8;ctx.fillStyle="#ff4488";ctx.fillRect(LW+2+ap,H-24,70,8);ctx.shadowBlur=0;
    // Balls
    ctx.shadowColor="#00ff88";ctx.shadowBlur=10;ctx.fillStyle="#fff";ctx.beginPath();ctx.arc(pbx,pby,5,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;
    ctx.shadowColor="#ff4488";ctx.shadowBlur=10;ctx.fillStyle="#fff";ctx.beginPath();ctx.arc(LW+2+abx,aby,5,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;
    if(!go){ctx.fillStyle="#00ff8866";ctx.font="11px Inter";ctx.textAlign="center";ctx.fillText("CLICK/SPACE",LW/2,H-60);}
    sHUD((ROWS*COLS-pb.length)+" bricks",(ROWS*COLS-ab.length)+" Diddy");
    if(pWon||aWon||!pLives||!aLives){
      ctx.fillStyle="rgba(0,0,0,.75)";ctx.fillRect(0,0,W,H);
      const pWins=(pWon&&!aWon)||(pb.length<ab.length&&!pLives&&!aLives)||(aLives<=0&&pLives>0)||(pWon);
      ctx.shadowColor=pWins?"#00ff88":"#ff4488";ctx.shadowBlur=20;
      ctx.fillStyle=pWins?"#00ff88":"#ff4488";ctx.font="bold 18px Orbitron,monospace";ctx.textAlign="center";ctx.fillText(pWins?"YOU WIN":"DIDDY WINS",W/2,H/2);ctx.shadowBlur=0;
    }
    this.raf=requestAnimationFrame(loop);
  };loop();
  const d=document.createElement("div");d.style.cssText="display:flex;gap:12px;justify-content:center;margin-top:10px;";
  const hold=(label,fn)=>{const b=document.createElement("div");b.style.cssText="width:80px;height:50px;background:var(--bg3);border:2px solid #2a3050;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.8rem;cursor:pointer;-webkit-tap-highlight-color:transparent;";b.textContent=label;let iv;b.addEventListener("touchstart",e=>{e.preventDefault();go=true;iv=setInterval(fn,30);},{passive:false});b.addEventListener("touchend",()=>clearInterval(iv));b.addEventListener("mousedown",()=>{go=true;iv=setInterval(fn,30);});b.addEventListener("mouseup",()=>clearInterval(iv));return b;};
  d.appendChild(hold("â—€",()=>{pp=Math.max(0,pp-14);}));d.appendChild(hold("â–¶",()=>{pp=Math.min(LW-70,pp+14);}));mg.appendChild(d);
},hint(){say("Your side is left, Diddy is right. Clear your bricks first to win!");}};

// â”€â”€ SPACE INVADERS AI â”€â”€
IMPL.invaders={raf:null,cleanup(){cancelAnimationFrame(this.raf);},
init(){
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const W=400,H=310,c=mkC(W,H);c.style.maxWidth="100%";c.style.height="auto";mg.appendChild(c);
  const ctx=c.getContext("2d");
  let inv=[],bl=[],ib=[],px=W/2,score=0,aiScore=0,lives=3,dx=0.7,fr=0,over=false;
  for(let r=0;r<4;r++)for(let cc=0;cc<9;cc++)inv.push({x:cc*38+25,y:r*28+32,alive:true,r});
  let mvL=false,mvR=false;
  const shoot=()=>{if(bl.length<4)bl.push({x:px,y:H-30});};
  document.onkeydown=e=>{if(e.key==="ArrowLeft")mvL=true;if(e.key==="ArrowRight")mvR=true;if(e.key===" "||e.key==="ArrowUp"){e.preventDefault();shoot();}};
  document.onkeyup=e=>{if(e.key==="ArrowLeft")mvL=false;if(e.key==="ArrowRight")mvR=false;};
  const mkBtn=(label,onDown,onUp,col)=>{const b=document.createElement("div");b.style.cssText="width:64px;height:54px;background:"+(col||"var(--bg3)")+";border:2px solid #2a3050;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.6rem;cursor:pointer;-webkit-tap-highlight-color:transparent;user-select:none;";b.textContent=label;b.addEventListener("touchstart",e=>{e.preventDefault();onDown();},{passive:false});b.addEventListener("touchend",()=>onUp&&onUp());b.addEventListener("mousedown",onDown);b.addEventListener("mouseup",()=>onUp&&onUp());return b;};
  const bd=document.createElement("div");bd.style.cssText="display:flex;gap:10px;justify-content:center;margin-top:8px;";
  bd.appendChild(mkBtn("â—€",()=>mvL=true,()=>mvL=false));
  bd.appendChild(mkBtn("ðŸ”¥",()=>shoot(),null,"#440022"));
  bd.appendChild(mkBtn("â–¶",()=>mvR=true,()=>mvR=false));
  mg.appendChild(bd);
  const loop=()=>{
    fr++;if(over){this.raf=requestAnimationFrame(loop);return;}
    if(mvL)px=Math.max(14,px-5);if(mvR)px=Math.min(W-14,px+5);
    const live=inv.filter(i=>i.alive);
    if(!live.length){say("Board clear! You: "+score+" Diddy: "+aiScore+(score>=aiScore?" YOU WIN ðŸŽ‰":" Diddy wins ðŸ¤–"));over=true;}
    if(fr%2===0)live.forEach(i=>i.x+=dx);
    const xs=live.map(i=>i.x);if(xs.length&&(Math.max(...xs)>W-18||Math.min(...xs)<18)){dx*=-1;live.forEach(i=>i.y+=12);}
    if(fr%55===0&&live.length){const s=live[Math.floor(Math.random()*live.length)];ib.push({x:s.x,y:s.y+10});}
    if(fr%90===0&&live.length){const front=live.sort((a,b)=>b.y-a.y)[0];ib.push({x:front.x,y:front.y+10,ai:true});}
    bl.forEach(b=>b.y-=8);ib.forEach(b=>b.y+=4);
    bl=bl.filter(b=>b.y>0);ib=ib.filter(b=>b.y<H);
    const newBl=[];bl.forEach(b=>{let hit=false;inv.forEach(i=>{if(i.alive&&Math.abs(b.x-i.x)<15&&Math.abs(b.y-i.y)<10){i.alive=false;score+=[40,30,20,10][i.r]||10;hit=true;}});if(!hit)newBl.push(b);});bl=newBl;
    const newIb=[];ib.forEach(b=>{if(!b.ai&&Math.abs(b.x-px)<14&&b.y>H-38){lives--;if(!lives){say("GAME OVER! You: "+score+" Diddy: "+aiScore);over=true;return;}}else newIb.push(b);});ib=newIb;
    if(live.some(i=>i.y>H-40)){say("Invaders landed! Game over.");over=true;}
    sHUD(score,aiScore);
    ctx.fillStyle="#000";ctx.fillRect(0,0,W,H);
    ctx.fillStyle="#ffffff15";for(let i=0;i<40;i++)ctx.fillRect((i*97)%W,((i*53)+fr*0.4)%H,1,1);
    live.forEach(i=>{const em=["ðŸ‘¾","ðŸ‘¾","ðŸ›¸","ðŸ›¸"];ctx.font="18px serif";ctx.textAlign="center";ctx.fillText(em[i.r]||"ðŸ‘¾",i.x,i.y+6);});
    bl.forEach(b=>{ctx.fillStyle="#00ff88";ctx.shadowColor="#00ff88";ctx.shadowBlur=6;ctx.fillRect(b.x-2,b.y-8,4,8);ctx.shadowBlur=0;});
    ib.forEach(b=>{ctx.fillStyle=b.ai?"#ff4488":"#ff8800";ctx.shadowColor=ctx.fillStyle;ctx.shadowBlur=4;ctx.fillRect(b.x-2,b.y,4,8);ctx.shadowBlur=0;});
    ctx.fillStyle="#00ff88";ctx.shadowColor="#00ff88";ctx.shadowBlur=8;ctx.beginPath();ctx.moveTo(px,H-38);ctx.lineTo(px-14,H-22);ctx.lineTo(px+14,H-22);ctx.closePath();ctx.fill();ctx.shadowBlur=0;
    ctx.fillStyle="#00ff88";ctx.font="bold 11px Orbitron,monospace";ctx.textAlign="left";ctx.fillText("YOU: "+score,4,14);ctx.fillStyle="#ff4488";ctx.textAlign="right";ctx.fillText("DIDDY: "+aiScore,W-4,14);ctx.fillStyle="#fff";ctx.textAlign="left";ctx.fillText("â¤".repeat(lives),4,26);
    if(over){ctx.fillStyle="rgba(0,0,0,.8)";ctx.fillRect(0,0,W,H);const pW=score>=aiScore;ctx.shadowColor=pW?"#00ff88":"#ff4488";ctx.shadowBlur=20;ctx.fillStyle=pW?"#00ff88":"#ff4488";ctx.font="bold 18px Orbitron,monospace";ctx.textAlign="center";ctx.fillText(pW?"YOU WIN":"DIDDY WINS",W/2,H/2);ctx.shadowBlur=0;}
    this.raf=requestAnimationFrame(loop);
  };loop();
},hint(){say("Hold â—€â–¶ buttons to move, tap ðŸ”¥ to shoot. Destroy all invaders first!");}};

// â”€â”€ TIC TAC TOE (perfect minimax) â”€â”€
IMPL.ttt={
init(){
  this.b=Array(9).fill("");this.over=false;
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const w=document.createElement("div");w.className="gw";
  w.innerHTML='<div class="msg" id="ttt-m">Your turn â€” you are X</div><div class="brd" id="ttt-b" style="grid-template-columns:repeat(3,80px);grid-template-rows:repeat(3,80px);"></div>';
  mg.appendChild(w);this.render();
},
render(){
  const b=document.getElementById("ttt-b");if(!b)return;b.innerHTML="";
  this.b.forEach((v,i)=>{const c=document.createElement("div");c.className="cl";c.style.cssText="width:80px;height:80px;font-size:2rem;background:var(--bg3);cursor:pointer;";c.style.color=v==="X"?"var(--acc)":"var(--a2)";c.textContent=v;c.onclick=()=>this.mv(i);b.appendChild(c);});
},
mv(i){
  if(this.b[i]||this.over)return;this.b[i]="X";this.render();
  const w=this.chk();if(w||!this.b.includes("")){this.over=true;document.getElementById("ttt-m").textContent=w==="X"?"You win!":w==="O"?"Diddy wins!":"Draw!";return;}
  document.getElementById("ttt-m").textContent="Diddy thinkingâ€¦";
  setTimeout(()=>{let best=-9,bi=-1;this.b.forEach((_,j)=>{if(!this.b[j]){this.b[j]="O";const s=this.mm(false);this.b[j]="";if(s>best){best=s;bi=j;}}});if(bi>=0)this.b[bi]="O";this.render();const w2=this.chk();if(w2||!this.b.includes("")){this.over=true;document.getElementById("ttt-m").textContent=w2==="O"?"Diddy wins!":w2==="X"?"You win!":"Draw!";}else document.getElementById("ttt-m").textContent="Your turn â€” X";},350);
},
mm(isO){const w=this.chk();if(w==="O")return 1;if(w==="X")return -1;if(!this.b.includes(""))return 0;let best=isO?-9:9;this.b.forEach((_,i)=>{if(!this.b[i]){this.b[i]=isO?"O":"X";const s=this.mm(!isO);this.b[i]="";best=isO?Math.max(best,s):Math.min(best,s);}});return best;},
chk(){const L=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const l of L)if(this.b[l[0]]&&this.b[l[0]]===this.b[l[1]]&&this.b[l[1]]===this.b[l[2]])return this.b[l[0]];return null;},
hint(){say("Diddy plays perfectly â€” best you can do is draw!");}};

// â”€â”€ CONNECT FOUR â”€â”€
IMPL.c4={R:6,C:7,
init(){
  this.g=Array(6).fill(null).map(()=>Array(7).fill(0));this.over=false;
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const w=document.createElement("div");w.className="gw";
  w.innerHTML='<div class="msg" id="c4m">Drop a disc â€” you are blue</div><div class="brd" id="c4b" style="grid-template-columns:repeat(7,42px);grid-template-rows:repeat(6,42px);background:#002244;gap:3px;padding:5px;border-radius:8px;"></div>';
  mg.appendChild(w);this.render();
},
render(){
  const b=document.getElementById("c4b");if(!b)return;b.innerHTML="";
  for(let r=0;r<this.R;r++)for(let c=0;c<this.C;c++){const d=document.createElement("div");d.className="cl";d.style.cssText="width:42px;height:42px;border-radius:50%;cursor:pointer;background:"+(this.g[r][c]===0?"#001133":this.g[r][c]===1?"#4488ff":"#ff4488")+";";if(r===0&&!this.over)d.onclick=()=>this.drop(c);b.appendChild(d);}
},
drop(col){
  if(this.over)return;for(let r=this.R-1;r>=0;r--){if(!this.g[r][col]){this.g[r][col]=1;break;}}
  this.render();if(this.win(1)){this.over=true;document.getElementById("c4m").textContent="You win!";return;}
  if(this.full()){document.getElementById("c4m").textContent="Draw!";return;}
  document.getElementById("c4m").textContent="Diddy thinkingâ€¦";
  setTimeout(()=>{const bc=this.best();for(let r=this.R-1;r>=0;r--){if(!this.g[r][bc]){this.g[r][bc]=2;break;}}this.render();if(this.win(2)){this.over=true;document.getElementById("c4m").textContent="Diddy wins!";}else if(this.full())document.getElementById("c4m").textContent="Draw!";else document.getElementById("c4m").textContent="Your turn";},500);
},
best(){
  const W=[[100,-20,10,5,5,10,-20,100],[-20,-50,-2,-2,-2,-2,-50,-20],[10,-2,5,1,1,5,-2,10],[5,-2,1,1,1,1,-2,5],[5,-2,1,1,1,1,-2,5],[10,-2,5,1,1,5,-2,10]];
  let bsc=-999,bc=3;
  for(let c=0;c<this.C;c++){if(!this.g[0][c]){
    const t2=this.g.map(r=>[...r]);for(let r=this.R-1;r>=0;r--)if(!t2[r][c]){t2[r][c]=2;break;}
    if(this.winB(t2,2))return c;
    const t1=this.g.map(r=>[...r]);for(let r=this.R-1;r>=0;r--)if(!t1[r][c]){t1[r][c]=1;break;}
    if(this.winB(t1,1)){bsc=900;bc=c;continue;}
    const row=this.g.map((row,r)=>row[c]===0?r:-1).filter(r=>r>=0).sort((a,b)=>b-a)[0];
    const sc=(W[row]||[])[c]||0;if(sc>bsc){bsc=sc;bc=c;}
  }}return bc;
},
win(p){return this.winB(this.g,p);},
winB(g,p){for(let r=0;r<this.R;r++)for(let c=0;c<this.C;c++){if(c+3<this.C&&[0,1,2,3].every(i=>g[r][c+i]===p))return true;if(r+3<this.R&&[0,1,2,3].every(i=>g[r+i][c]===p))return true;if(r+3<this.R&&c+3<this.C&&[0,1,2,3].every(i=>g[r+i][c+i]===p))return true;if(r+3<this.R&&c-3>=0&&[0,1,2,3].every(i=>g[r+i][c-i]===p))return true;}return false;},
full(){return this.g[0].every(c=>c!==0);},
hint(){say("Control center. Block Diddy's 3-in-a-rows!");}};

// â”€â”€ MINESWEEPER AI: Race to clear the most â”€â”€
IMPL.mines={RR:10,CC:14,M:20,
init(){
  this.board=Array(this.RR).fill(null).map(()=>Array(this.CC).fill(0));
  this.rev=Array(this.RR).fill(null).map(()=>Array(this.CC).fill(false));
  this.flag=Array(this.RR).fill(null).map(()=>Array(this.CC).fill(false));
  this.over=false;this.gen2=false;this.pCleared=0;this.aCleared=0;
  this.aiQueue=[];this.aiVisited=new Set();
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const w=document.createElement("div");w.className="gw";
  w.innerHTML='<div class="msg" id="mine-m">Race Diddy to clear the most safe cells!</div><div id="mine-g" style="display:inline-grid;grid-template-columns:repeat(14,24px);gap:1px;"></div><div style="display:flex;gap:12px;justify-content:center;margin-top:6px;font-size:.62rem;"><div style="color:var(--acc)">YOU: <span id="mine-ps">0</span></div><div style="color:var(--a2)">DIDDY: <span id="mine-as">0</span></div></div>';
  mg.appendChild(w);this.render();
  // AI starts solving after 3 seconds
  this.aiTimer=setTimeout(()=>this.aiStep(),3000);
},
nb(r,c){const n=[];for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++){if(dr||dc){const nr=r+dr,nc=c+dc;if(nr>=0&&nr<this.RR&&nc>=0&&nc<this.CC)n.push([nr,nc]);}}return n;},
gen(sr,sc){let p=0;while(p<this.M){const r=Math.floor(Math.random()*this.RR),c=Math.floor(Math.random()*this.CC);if(this.board[r][c]!==-1&&!(r===sr&&c===sc)){this.board[r][c]=-1;p++;}}for(let r=0;r<this.RR;r++)for(let c=0;c<this.CC;c++)if(this.board[r][c]!==-1)this.board[r][c]=this.nb(r,c).filter(([nr,nc])=>this.board[nr][nc]===-1).length;this.gen2=true;// Seed AI queue with some safe cells
for(let r=0;r<this.RR;r+=3)for(let c=0;c<this.CC;c+=3)if(this.board[r][c]!==-1)this.aiQueue.push([r,c]);},
reveal(r,c,byAi){
  if(this.rev[r][c]||this.flag[r][c]||this.over)return;
  if(!this.gen2)this.gen(r,c);this.rev[r][c]=true;
  if(this.board[r][c]===-1){if(!byAi){this.over=true;say("ðŸ’¥ Boom! Final: You "+this.pCleared+" vs Diddy "+this.aCleared+(this.pCleared>this.aCleared?" â€” You still win!":""));} return;}
  if(byAi)this.aCleared++;else{this.pCleared++;document.getElementById("mine-ps").textContent=this.pCleared;}
  if(this.board[r][c]===0)this.nb(r,c).forEach(([nr,nc])=>this.reveal(nr,nc,byAi));
  const total=this.RR*this.CC-this.M;if(this.rev.flat().filter(Boolean).length>=total){this.over=true;say("Board cleared! You: "+this.pCleared+" Diddy: "+this.aCleared);}
  this.render();
},
aiStep(){
  if(this.over)return;
  if(!this.gen2){this.aiTimer=setTimeout(()=>this.aiStep(),500);return;}
  // AI picks a cell it hasn't tried
  let found=false;
  while(this.aiQueue.length&&!found){const[r,c]=this.aiQueue.shift();const k=r+","+c;if(!this.aiVisited.has(k)&&!this.rev[r][c]){this.aiVisited.add(k);this.reveal(r,c,true);document.getElementById("mine-as").textContent=this.aCleared;found=true;// Add neighbors to queue
this.nb(r,c).forEach(([nr,nc])=>this.aiQueue.push([nr,nc]));}}
  if(!found){for(let r=0;r<this.RR&&!found;r++)for(let c=0;c<this.CC&&!found;c++){const k=r+","+c;if(!this.rev[r][c]&&!this.aiVisited.has(k)){this.aiQueue.push([r,c]);found=true;}}}
  if(!this.over)this.aiTimer=setTimeout(()=>this.aiStep(),600);
},
render(){
  const g=document.getElementById("mine-g");if(!g)return;g.innerHTML="";
  const NC=["","#4488ff","#00aa44","#ff4444","#220088","#880000","#0088aa","#000","#888"];
  for(let r=0;r<this.RR;r++)for(let c=0;c<this.CC;c++){const d=document.createElement("div");d.className="mcl";if(this.rev[r][c]){d.classList.add("op");const v=this.board[r][c];d.textContent=v===-1?"ðŸ’¥":v?v:"";d.style.color=NC[v]||"#fff";}else if(this.flag[r][c])d.textContent="ðŸš©";d.onclick=()=>this.reveal(r,c,false);d.oncontextmenu=e=>{e.preventDefault();if(!this.rev[r][c]&&!this.over){this.flag[r][c]=!this.flag[r][c];this.render();}};g.appendChild(d);}
},
hint(){say("Diddy starts solving in 3 seconds â€” get a head start on the corners!");}};

// â”€â”€ BLACKJACK â”€â”€
IMPL.blackjack={
init(){this.deck=this.nd();this.p=[];this.d=[];this.chips=200;this.bet=20;this.phase="play";const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.style.gap="6px";w.innerHTML='<div class="msg" id="bj-m">Deal and play!</div><div style="width:100%;max-width:400px;"><div style="font-size:.56rem;color:var(--dm);margin-bottom:4px">DEALER</div><div style="display:flex;flex-wrap:wrap;gap:5px;min-height:70px;" id="bj-d"></div><div style="font-size:.56rem;color:var(--dm);margin:7px 0 4px">YOU</div><div style="display:flex;flex-wrap:wrap;gap:5px;min-height:70px;" id="bj-p"></div></div><div style="display:flex;gap:6px;flex-wrap:wrap;justify-content:center;" id="bj-b"></div>';mg.appendChild(w);this.deal();},
nd(){const s="SHDC",v="A23456789TJQK",d=[];for(const ss of s)for(const vv of v)d.push({v:vv,s:ss});return d.sort(()=>Math.random()-.5);},
draw(){return this.deck.pop()||(this.deck=this.nd(),this.deck.pop());},
val(h){let t=0,a=0;h.forEach(c=>{const v=c.v;if("TJQK".includes(v))t+=10;else if(v==="A"){t+=11;a++;}else t+=+v;});while(t>21&&a){t-=10;a--;}return t;},
deal(){this.p=[this.draw(),this.draw()];this.d=[this.draw(),this.draw()];this.phase="play";this.rBJ();const pv=this.val(this.p);if(pv===21)this.stand();else{say("Total: "+pv+" â€” Hit or Stand?");this.rBtns();}},
rBJ(){const su={S:"â™ ",H:"â™¥",D:"â™¦",C:"â™£"};const rd=c=>"HD".includes(c.s);const mk=c=>'<div class="crd" style="font-size:.82rem;flex-direction:column;line-height:1.3;"><span style="color:'+(rd(c)?"#ff4488":"#c0c8e8")+'">'+c.v+'</span><span style="font-size:.65rem;color:'+(rd(c)?"#ff4488":"#888")+'">'+su[c.s]+'</span></div>';const hd='<div class="crd" style="background:#112233;">ðŸ‚ </div>';document.getElementById("bj-d").innerHTML=this.d.map((c,i)=>i>0&&this.phase==="play"?hd:mk(c)).join("");document.getElementById("bj-p").innerHTML=this.p.map(c=>mk(c)).join("");sHUD("Chips: "+this.chips,"Bet: "+this.bet);},
rBtns(){const b=document.getElementById("bj-b");if(!b)return;if(this.phase==="play")b.innerHTML='<button class="mb p" onclick="IMPL.blackjack.hit()">Hit</button><button class="mb" onclick="IMPL.blackjack.stand()">Stand</button><button class="mb" onclick="IMPL.blackjack.dbl()">Double</button>';else b.innerHTML='<button class="mb p" onclick="IMPL.blackjack.deal()">New Hand</button><button class="mb" onclick="IMPL.blackjack.bet=Math.min(IMPL.blackjack.chips,IMPL.blackjack.bet+10);IMPL.blackjack.rBJ()">Bet+10</button><button class="mb" onclick="IMPL.blackjack.bet=Math.max(10,IMPL.blackjack.bet-10);IMPL.blackjack.rBJ()">Bet-10</button>';},
hit(){this.p.push(this.draw());const v=this.val(this.p);this.rBJ();if(v>21){this.chips-=this.bet;this.phase="done";say("Bust! -"+this.bet+" ("+this.chips+" left)");this.rBtns();}else say("Total: "+v);},
stand(){this.phase="done";while(this.val(this.d)<17)this.d.push(this.draw());const pv=this.val(this.p),dv=this.val(this.d);this.rBJ();let msg;if(dv>21||pv>dv){this.chips+=this.bet;msg="Win! +"+this.bet;}else if(pv===dv)msg="Push";else{this.chips-=this.bet;msg="Dealer wins. -"+this.bet+" ("+this.chips+" left)";}say(msg);this.rBtns();},
dbl(){if(this.chips>=this.bet*2){this.bet*=2;this.hit();if(this.phase!=="done")this.stand();}else say("Not enough chips!");},
hint(){say("Hit â‰¤11, stand â‰¥17. Double on 10-11 vs dealer 2-9.");}};

// â”€â”€ MEMORY MATCH â”€â”€
IMPL.memory={EM:["ðŸŽ®","ðŸŽ²","ðŸ†","â­","ðŸŽ¯","ðŸŽª","ðŸŽ¨","ðŸš€"],
init(){
  this.cards=[...this.EM,...this.EM].sort(()=>Math.random()-.5).map((e,i)=>({e,i,flip:false,done:false}));
  this.sel=[];this.pS=0;this.aS=0;this.turn="p";this.lock=false;this.mem={};
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const w=document.createElement("div");w.className="gw";
  w.innerHTML='<div class="msg" id="mem-m">Find pairs! You go first.</div><div id="mem-g" style="display:grid;grid-template-columns:repeat(4,58px);gap:7px;"></div>';
  mg.appendChild(w);this.render();
},
render(){const g=document.getElementById("mem-g");if(!g)return;g.innerHTML="";this.cards.forEach((card,i)=>{const d=document.createElement("div");d.className="crd"+(card.flip||card.done?" flip":"");d.style.cssText="width:58px;height:70px;font-size:1.6rem;";d.textContent=card.flip||card.done?card.e:"";if(!card.done&&!card.flip&&this.turn==="p"&&!this.lock)d.onclick=()=>this.flip(i);g.appendChild(d);});sHUD(this.pS,this.aS+" Diddy");},
flip(i){if(this.lock||this.cards[i].done||this.cards[i].flip)return;this.mem[i]=this.cards[i].e;this.cards[i].flip=true;this.sel.push(i);this.render();if(this.sel.length===2){this.lock=true;setTimeout(()=>this.chk(),650);}},
chk(){const [a,b]=this.sel;if(this.cards[a].e===this.cards[b].e){this.cards[a].done=this.cards[b].done=true;this.pS++;this.sel=[];this.lock=false;if(this.cards.every(c=>c.done))say(this.pS>this.aS?"You win!":this.aS>this.pS?"Diddy wins!":"Draw!");else{say("Match! Go again.");this.render();}}else{this.cards[a].flip=this.cards[b].flip=false;this.sel=[];this.turn="ai";this.lock=false;say("Miss â€” Diddy's turnâ€¦");this.render();setTimeout(()=>this.aiT(),700);}},
aiT(){const avail=this.cards.map((c,i)=>!c.done?i:null).filter(i=>i!=null);let pair=null;const mem=Object.entries(this.mem);for(let i=0;i<mem.length&&!pair;i++)for(let j=i+1;j<mem.length&&!pair;j++){if(mem[i][1]===mem[j][1]&&!this.cards[+mem[i][0]].done&&!this.cards[+mem[j][0]].done)pair=[+mem[i][0],+mem[j][0]];}if(!pair){let r1=avail[Math.floor(Math.random()*avail.length)],r2=avail[Math.floor(Math.random()*avail.length)];while(r2===r1&&avail.length>1)r2=avail[Math.floor(Math.random()*avail.length)];pair=[r1,r2];}const [a,b]=pair;this.cards[a].flip=true;this.mem[a]=this.cards[a].e;this.render();setTimeout(()=>{this.cards[b].flip=true;this.mem[b]=this.cards[b].e;this.render();setTimeout(()=>{if(this.cards[a].e===this.cards[b].e){this.cards[a].done=this.cards[b].done=true;this.aS++;if(this.cards.every(c=>c.done))say(this.pS>this.aS?"You win!":this.aS>this.pS?"Diddy wins!":"Draw!");else setTimeout(()=>this.aiT(),400);}else{this.cards[a].flip=this.cards[b].flip=false;this.turn="p";say("Diddy missed! Your turn.");}this.render();},700);},650);},
hint(){say("Diddy memorizes every card it sees. Match fast!");}};

// â”€â”€ ROCK PAPER SCISSORS â”€â”€
IMPL.rps={pS:0,aS:0,hist:[],
init(){this.pS=0;this.aS=0;this.hist=[];const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="rps-m">Choose your weapon!</div><div id="rps-d" style="font-size:2.8rem;display:flex;gap:18px;justify-content:center;min-height:52px;align-items:center;"></div><div style="display:flex;gap:10px;margin-top:6px;"><button class="mb" style="font-size:1.7rem;padding:10px 16px;" onclick="IMPL.rps.play(0)">âœŠ</button><button class="mb" style="font-size:1.7rem;padding:10px 16px;" onclick="IMPL.rps.play(1)">âœ‹</button><button class="mb" style="font-size:1.7rem;padding:10px 16px;" onclick="IMPL.rps.play(2)">âœŒ</button></div><div style="font-size:.54rem;color:var(--dm);margin-top:5px">âœŠ beats âœŒ Â· âœ‹ beats âœŠ Â· âœŒ beats âœ‹</div>';mg.appendChild(w);sHUD(0,0);},
play(p){const I=["âœŠ","âœ‹","âœŒ"];this.hist.push(p);const freq=[0,0,0];this.hist.slice(-8).forEach(h=>freq[h]++);const mx=freq.indexOf(Math.max(...freq));let ai=(mx+1)%3;if(this.hist.length<3||Math.random()<0.25)ai=Math.floor(Math.random()*3);document.getElementById("rps-d").innerHTML=I[p]+'<span style="font-size:.9rem;color:var(--dm)">vs</span>'+I[ai];let msg;if(p===ai)msg="Draw!";else if((p-ai+3)%3===1){this.pS++;msg="You win!";}else{this.aS++;msg="Diddy wins!";}say(msg);sHUD(this.pS,this.aS);},
hint(){say("Diddy tracks your patterns. Be random!");}};

// â”€â”€ SIMON SAYS â”€â”€
IMPL.simon={seq:[],pl:[],lvl:0,active:false,COLS:["#ff4444","#44cc44","#ffcc00","#4488ff"],
init(){this.seq=[];this.pl=[];this.lvl=0;this.active=false;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="si-m">Watch then repeat!</div><div class="sg">'+"0123".split("").map(i=>'<button class="sb" id="sb'+i+'" style="background:'+this.COLS[i]+';opacity:.35;" onclick="IMPL.simon.press('+i+')"></button>').join("")+'</div><div style="font-size:.56rem;color:var(--dm);margin-top:4px">Level: <span id="si-l">0</span></div>';mg.appendChild(w);setTimeout(()=>this.next(),700);},
next(){this.seq.push(Math.floor(Math.random()*4));this.lvl=this.seq.length;this.pl=[];this.active=false;document.getElementById("si-l").textContent=this.lvl;say("Level "+this.lvl+" â€” Watch!");let i=0;const show=()=>{if(i<this.seq.length){this.flash(this.seq[i++]);setTimeout(show,650);}else{this.active=true;say("Repeat!")}};setTimeout(show,500);},
flash(idx){const el=document.getElementById("sb"+idx);if(!el)return;el.style.opacity="1";setTimeout(()=>el.style.opacity=".35",320);},
press(idx){if(!this.active)return;this.flash(idx);this.pl.push(idx);const pos=this.pl.length-1;if(this.pl[pos]!==this.seq[pos]){say("Wrong! Game over at level "+this.lvl);this.active=false;sHUD(this.lvl,"laughing");return;}if(this.pl.length===this.seq.length){this.active=false;say("Correct! Diddy addsâ€¦");sHUD(this.lvl,"-");setTimeout(()=>this.next(),900);}},
hint(){say("Hum the pattern. Short = high pitch, long = melody!");}};
// â”€â”€ HANGMAN â”€â”€
IMPL.hangman={WDS:["JAVASCRIPT","PYTHON","ALGORITHM","BLOCKCHAIN","METAVERSE","QUANTUM","DEVELOPER","DATABASE","PROTOCOL","ENCRYPTION","RECURSION","VARIABLE","FUNCTION","GRADIENT","RESONANCE"],
init(){this.word=this.WDS[Math.floor(Math.random()*this.WDS.length)];this.guessed=new Set();this.wrong=0;this.max=6;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<canvas id="hc" width="160" height="160" style="background:#000;border:1px solid #1a2030;border-radius:4px;"></canvas><div id="hw" style="font-size:1.3rem;letter-spacing:.28em;color:var(--acc);margin:5px 0;"></div><div class="msg" id="hm"></div><div class="hw" id="hk"></div>';mg.appendChild(w);this.render();},
render(){const w=document.getElementById("hw");if(!w)return;w.textContent=[...this.word].map(c=>this.guessed.has(c)?c:"_").join(" ");const lk=document.getElementById("hk");lk.innerHTML="";"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(l=>{const b=document.createElement("button");b.className="hb";b.textContent=l;if(this.guessed.has(l))b.disabled=true;b.onclick=()=>this.guess(l);lk.appendChild(b);});this.draw();const won=[...this.word].every(c=>this.guessed.has(c));if(won)say("You got it! Word: "+this.word);else if(this.wrong>=this.max)say("Hanged! Word was: "+this.word);else say(this.wrong+"/"+this.max+" wrong");},
guess(l){this.guessed.add(l);if(!this.word.includes(l))this.wrong++;this.render();},
draw(){const c=document.getElementById("hc");if(!c)return;const ctx=c.getContext("2d");ctx.clearRect(0,0,160,160);ctx.strokeStyle="#00ff88";ctx.lineWidth=2;ctx.lineCap="round";ctx.beginPath();ctx.moveTo(20,150);ctx.lineTo(140,150);ctx.moveTo(50,150);ctx.lineTo(50,20);ctx.lineTo(100,20);ctx.lineTo(100,38);ctx.stroke();const pts=[()=>{ctx.beginPath();ctx.arc(100,52,14,0,Math.PI*2);ctx.strokeStyle="#ff4488";ctx.stroke();},()=>{ctx.beginPath();ctx.moveTo(100,66);ctx.lineTo(100,108);ctx.stroke();},()=>{ctx.beginPath();ctx.moveTo(100,76);ctx.lineTo(82,98);ctx.stroke();},()=>{ctx.beginPath();ctx.moveTo(100,76);ctx.lineTo(118,98);ctx.stroke();},()=>{ctx.beginPath();ctx.moveTo(100,108);ctx.lineTo(82,134);ctx.stroke();},()=>{ctx.beginPath();ctx.moveTo(100,108);ctx.lineTo(118,134);ctx.stroke();}];for(let i=0;i<this.wrong;i++)if(pts[i])pts[i]();},
hint(){const u=[...new Set([...this.word].filter(c=>!this.guessed.has(c)))];say("Try: "+u.slice(0,2).join(", ")+" â€” vowels first!");}};

// â”€â”€ 2048 â”€â”€
IMPL.g2048={
init(){this.grid=Array(4).fill(null).map(()=>Array(4).fill(0));this.score=0;this.add();this.add();const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="g48-m">Arrow keys to slide!</div><div class="g48" id="g48-g"></div>';mg.appendChild(w);document.onkeydown=e=>{const m={ArrowLeft:"L",ArrowRight:"R",ArrowUp:"U",ArrowDown:"D"};if(m[e.key]){e.preventDefault();this.move(m[e.key]);}};this.render();},
add(){const e=[];for(let r=0;r<4;r++)for(let c=0;c<4;c++)if(!this.grid[r][c])e.push([r,c]);if(e.length){const[r,c]=e[Math.floor(Math.random()*e.length)];this.grid[r][c]=Math.random()<.9?2:4;}},
rot(){this.grid=this.grid[0].map((_,i)=>this.grid.map(r=>r[i]).reverse());},
move(dir){const prev=JSON.stringify(this.grid);if(dir==="U")this.rot(),this.rot(),this.rot();else if(dir==="L")this.rot(),this.rot();else if(dir==="D")this.rot();for(let r=0;r<4;r++){let row=this.grid[r].filter(x=>x);for(let i=0;i<row.length-1;i++)if(row[i]===row[i+1]){row[i]*=2;this.score+=row[i];row.splice(i+1,1);}while(row.length<4)row.push(0);this.grid[r]=row;}if(dir==="U")this.rot();else if(dir==="L")this.rot(),this.rot();else if(dir==="D")this.rot(),this.rot(),this.rot();if(JSON.stringify(this.grid)!==prev){this.add();this.render();}if(this.grid.flat().includes(2048))say("YOU REACHED 2048!");},
render(){const g=document.getElementById("g48-g");if(!g)return;g.innerHTML="";const BG={0:"#1a2030",2:"#2a3a50",4:"#3a5070",8:"#4a6080",16:"#4488aa",32:"#44aacc",64:"#00ccee",128:"#ffcc44",256:"#ffaa22",512:"#ff8800",1024:"#ff6600",2048:"#ff2200"};this.grid.forEach(row=>row.forEach(v=>{const d=document.createElement("div");d.className="t2";d.style.background=BG[v]||"#cc1100";d.style.color=v<8?"#4a6090":"#fff";d.textContent=v||"";g.appendChild(d);}));sHUD(this.score,"grading you");},
hint(){say("Keep biggest tile in a corner. Build a chain!");}};

// â”€â”€ TETRIS AI: Garbage Attack â”€â”€
IMPL.tetris={C:10,R:20,BS:18,PS:[[[1,1,1,1]],[[1,1],[1,1]],[[0,1,0],[1,1,1]],[[1,0],[1,0],[1,1]],[[0,1],[0,1],[1,1]],[[0,1,1],[1,1,0]],[[1,1,0],[0,1,1]]],CL:["#00ffee","#ffcc00","#aa44ff","#ff8800","#4488ff","#ff4488","#44ff88"],
cleanup(){clearInterval(this.iv);clearInterval(this.aiv);},
init(){
  this.pg=Array(20).fill(null).map(()=>Array(10).fill(0));
  this.ag=Array(20).fill(null).map(()=>Array(10).fill(0));
  this.pc=null;this.ac=null;this.pnxt=null;this.anxt=null;
  this.ps2=0;this.as2=0;this.over=false;
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const wrap=document.createElement("div");wrap.style.cssText="display:flex;gap:8px;justify-content:center;align-items:flex-start;width:100%;";
  const pSide=document.createElement("div");pSide.innerHTML='<div style="font-size:.52rem;color:var(--acc);text-align:center;margin-bottom:3px;font-weight:700">YOU</div>';
  const pc=mkC(this.C*this.BS,this.R*this.BS);pc.id="tc-p";
  pSide.appendChild(pc);
  const aSide=document.createElement("div");aSide.innerHTML='<div style="font-size:.52rem;color:var(--a2);text-align:center;margin-bottom:3px;font-weight:700">DIDDY ðŸ¦¾</div>';
  const ac=mkC(this.C*this.BS,this.R*this.BS);ac.id="tc-a";
  aSide.appendChild(ac);
  const mid=document.createElement("div");mid.style.cssText="display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;font-size:.5rem;color:var(--dm);min-width:38px;";
  mid.innerHTML='<div style="font-size:.6rem;color:var(--a4);font-weight:700">VS</div><div id="ts-p" style="color:var(--acc);font-size:.7rem;font-weight:700">0</div><div style="color:var(--dm)">â€”</div><div id="ts-a" style="color:var(--a2);font-size:.7rem;font-weight:700">0</div><div style="margin-top:8px;font-size:.48rem;color:var(--dm)">CLEAR<br>2+<br>LINES<br>=<br>GARBAGE</div>';
  wrap.appendChild(pSide);wrap.appendChild(mid);wrap.appendChild(aSide);
  const gw=document.createElement("div");gw.className="gw";gw.appendChild(wrap);mg.appendChild(gw);
  this.newP("p");this.newP("a");
  document.onkeydown=e=>{if(e.key==="ArrowLeft")this.mv("p",-1,0);else if(e.key==="ArrowRight")this.mv("p",1,0);else if(e.key==="ArrowDown")this.mv("p",0,1);else if(e.key==="ArrowUp")this.rot2("p");else if(e.key===" "){e.preventDefault();this.drop("p");}};
  clearInterval(this.iv);this.iv=setInterval(()=>{if(!this.over&&!this.mv("p",0,1))this.lock("p");},500);
  clearInterval(this.aiv);this.aiv=setInterval(()=>{if(!this.over)this.aiStep();},420);
  this.draw("p");this.draw("a");
  mg.appendChild(mkDpad({up:()=>this.rot2("p"),down:()=>this.mv("p",0,1),left:()=>this.mv("p",-1,0),right:()=>this.mv("p",1,0),action:()=>this.drop("p"),actionLabel:"â¬‡"}));
},
newP(s){const i=Math.floor(Math.random()*7);const nxt=s==="p"?this.pnxt:this.anxt;if(nxt){if(s==="p")this.pc={shape:nxt.shape,x:3,y:0,col:nxt.col};else this.ac={shape:nxt.shape,x:3,y:0,col:nxt.col};}else{const sh=this.PS[i].map(r=>[...r]);if(s==="p")this.pc={shape:sh,x:3,y:0,col:this.CL[i]};else this.ac={shape:sh,x:3,y:0,col:this.CL[i]};}const ni=Math.floor(Math.random()*7);const nn={shape:this.PS[ni].map(r=>[...r]),col:this.CL[ni]};if(s==="p")this.pnxt=nn;else this.anxt=nn;const g=s==="p"?this.pg:this.ag;const cur=s==="p"?this.pc:this.ac;if(!this.ok(g,cur.shape,cur.x,cur.y)){this.over=true;say(s==="p"?"ðŸ’€ Topped out! Diddy wins!":"ðŸŽ‰ Diddy topped out! You win!");}},
ok(g,s,ox,oy){return s.every((row,r)=>row.every((v,c)=>!v||((ox+c)>=0&&(ox+c)<this.C&&(oy+r)<this.R&&!g[oy+r]?.[ox+c])));},
mv(s,dx,dy){if(this.over)return false;const g=s==="p"?this.pg:this.ag,cur=s==="p"?this.pc:this.ac;if(this.ok(g,cur.shape,cur.x+dx,cur.y+dy)){cur.x+=dx;cur.y+=dy;this.draw(s);return true;}return false;},
rot2(s){const cur=s==="p"?this.pc:this.ac,g=s==="p"?this.pg:this.ag;const ns=cur.shape[0].map((_,i)=>cur.shape.map(r=>r[i]).reverse());if(this.ok(g,ns,cur.x,cur.y)){cur.shape=ns;this.draw(s);}},
drop(s){while(this.mv(s,0,1));this.lock(s);},
lock(s){
  const g=s==="p"?this.pg:this.ag,cur=s==="p"?this.pc:this.ac;
  cur.shape.forEach((row,r)=>row.forEach((v,c)=>{if(v&&g[cur.y+r])g[cur.y+r][cur.x+c]=cur.col;}));
  let lines=0;for(let r=this.R-1;r>=0;r--){if(g[r].every(c=>c)){g.splice(r,1);g.unshift(Array(this.C).fill(0));lines++;r++;}}
  if(s==="p"){this.ps2+=[0,100,300,500,800][lines]||0;document.getElementById("ts-p").textContent=this.ps2;if(lines>=2)this.sendGarbage("a",lines-1);}
  else{this.as2+=[0,100,300,500,800][lines]||0;document.getElementById("ts-a").textContent=this.as2;if(lines>=2)this.sendGarbage("p",lines-1);}
  if(!this.over)this.newP(s);this.draw(s);
},
sendGarbage(to,n){
  const g=to==="p"?this.pg:this.ag;
  for(let i=0;i<n;i++){g.shift();const row=Array(this.C).fill("#444");row[Math.floor(Math.random()*this.C)]=0;g.push(row);}
  say((to==="p"?"Diddy":"You")+" sent "+n+" garbage row"+(n>1?"s":"")+"! ðŸ’¥");
  this.draw(to);
},
aiStep(){
  if(!this.mv("a",0,1)){
    // AI picks best column
    let best=-9999,bx=this.ac.x,brot=0;
    for(let rot=0;rot<4;rot++){const s=this.ac.shape[0].map((_,i)=>this.ac.shape.map(r=>r[i]).reverse());for(let x=0;x<this.C;x++){if(this.ok(this.ag,this.ac.shape,x,this.ac.y)){const tmp=this.ag.map(r=>[...r]);let ty=this.ac.y;while(this.ok(tmp,this.ac.shape,x,ty+1))ty++;this.ac.shape.forEach((row,r)=>row.forEach((v,c)=>{if(v&&tmp[ty+r])tmp[ty+r][x+c]=1;}));let score=0;for(let r=0;r<this.R;r++){if(tmp[r].every(c=>c))score+=100;for(let c=0;c<this.C;c++)if(tmp[r][c])score-=(this.R-r)*0.1;}if(score>best){best=score;bx=x;brot=rot;}}}this.ac.shape=this.ac.shape[0].map((_,i)=>this.ac.shape.map(r=>r[i]).reverse());}
    for(let i=0;i<brot;i++)this.rot2("a");
    while(this.ac.x<bx)this.mv("a",1,0);while(this.ac.x>bx)this.mv("a",-1,0);
    this.drop("a");
  }
},
draw(s){
  const id=s==="p"?"tc-p":"tc-a",g=s==="p"?this.pg:this.ag,cur=s==="p"?this.pc:this.ac;
  const c=document.getElementById(id);if(!c)return;const ctx=c.getContext("2d");
  const W=this.C*this.BS,H=this.R*this.BS;ctx.fillStyle="#050508";ctx.fillRect(0,0,W,H);
  // grid lines
  ctx.strokeStyle="#0a0a14";ctx.lineWidth=1;
  for(let i=0;i<=this.C;i++){ctx.beginPath();ctx.moveTo(i*this.BS,0);ctx.lineTo(i*this.BS,H);ctx.stroke();}
  for(let i=0;i<=this.R;i++){ctx.beginPath();ctx.moveTo(0,i*this.BS);ctx.lineTo(W,i*this.BS);ctx.stroke();}
  g.forEach((row,r)=>row.forEach((col,c2)=>{if(col){ctx.fillStyle=typeof col==="string"&&col.startsWith("#")?col:col;ctx.fillRect(c2*this.BS+1,r*this.BS+1,this.BS-2,this.BS-2);ctx.fillStyle="rgba(255,255,255,.15)";ctx.fillRect(c2*this.BS+1,r*this.BS+1,this.BS-2,3);}}));
  if(cur){let gy=cur.y;while(this.ok(g,cur.shape,cur.x,gy+1))gy++;cur.shape.forEach((row,r)=>row.forEach((v,c2)=>{if(v){ctx.fillStyle=cur.col+"33";ctx.fillRect((cur.x+c2)*this.BS+1,(gy+r)*this.BS+1,this.BS-2,this.BS-2);}}));cur.shape.forEach((row,r)=>row.forEach((v,c2)=>{if(v){ctx.fillStyle=cur.col;ctx.fillRect((cur.x+c2)*this.BS+1,(cur.y+r)*this.BS+1,this.BS-2,this.BS-2);ctx.fillStyle="rgba(255,255,255,.2)";ctx.fillRect((cur.x+c2)*this.BS+1,(cur.y+r)*this.BS+1,this.BS-2,3);};}));}
  if(this.over){ctx.fillStyle="rgba(0,0,0,.8)";ctx.fillRect(0,0,W,H);}
},
hint(){say("Clear 2+ lines to send garbage rows to Diddy's board!");}};

// â”€â”€ REVERSI â”€â”€
IMPL.reversi={
init(){this.g=Array(8).fill(null).map(()=>Array(8).fill(0));this.g[3][3]=1;this.g[4][4]=1;this.g[3][4]=2;this.g[4][3]=2;this.over=false;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="rv-m">You are White âšª â€” click valid squares</div><div class="brd" id="rv-b" style="grid-template-columns:repeat(8,40px);grid-template-rows:repeat(8,40px);background:#004400;gap:2px;padding:4px;border-radius:8px;"></div>';mg.appendChild(w);this.render();},
dirs(){return[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];},
valid(r,c,p){if(this.g[r][c])return false;return this.dirs().some(([dr,dc])=>{let nr=r+dr,nc=c+dc,f=false;while(nr>=0&&nr<8&&nc>=0&&nc<8&&this.g[nr][nc]===3-p){nr+=dr;nc+=dc;f=true;}return f&&nr>=0&&nr<8&&nc>=0&&nc<8&&this.g[nr][nc]===p;});},
place(r,c,p){if(!this.valid(r,c,p))return false;this.g[r][c]=p;this.dirs().forEach(([dr,dc])=>{let nr=r+dr,nc=c+dc,fl=[];while(nr>=0&&nr<8&&nc>=0&&nc<8&&this.g[nr][nc]===3-p){fl.push([nr,nc]);nr+=dr;nc+=dc;}if(nr>=0&&nr<8&&nc>=0&&nc<8&&this.g[nr][nc]===p)fl.forEach(([fr,fc])=>this.g[fr][fc]=p);});return true;},
moves(p){const m=[];for(let r=0;r<8;r++)for(let c=0;c<8;c++)if(this.valid(r,c,p))m.push([r,c]);return m;},
aiMove(){const W=[[100,-20,10,5,5,10,-20,100],[-20,-50,-2,-2,-2,-2,-50,-20],[10,-2,5,1,1,5,-2,10],[5,-2,1,1,1,1,-2,5],[5,-2,1,1,1,1,-2,5],[10,-2,5,1,1,5,-2,10],[-20,-50,-2,-2,-2,-2,-50,-20],[100,-20,10,5,5,10,-20,100]];const ms=this.moves(1);if(!ms.length)return;const best=ms.sort((a,b)=>W[b[0]][b[1]]-W[a[0]][a[1]])[0];this.place(best[0],best[1],1);},
render(){const b=document.getElementById("rv-b");if(!b)return;b.innerHTML="";const mv=this.moves(2);for(let r=0;r<8;r++)for(let c=0;c<8;c++){const d=document.createElement("div");d.className="cl";d.style.cssText="width:40px;height:40px;border-radius:50%;transition:background .1s;";const v=this.g[r][c];d.style.background=v===1?"#1a1a1a":v===2?"#e8e8e8":mv.some(([mr,mc])=>mr===r&&mc===c)?"#005500":"#003300";d.onclick=()=>this.play(r,c);b.appendChild(d);}const p1=this.g.flat().filter(v=>v===1).length,p2=this.g.flat().filter(v=>v===2).length;sHUD("âšª "+p2,"âš« "+p1+" Diddy");},
play(r,c){if(this.over||!this.valid(r,c,2))return;this.place(r,c,2);this.render();if(!this.moves(1).length){if(!this.moves(2).length)this.end();else say("Diddy has no moves â€” your turn!");return;}say("Diddy thinkingâ€¦");setTimeout(()=>{this.aiMove();this.render();if(!this.moves(2).length){if(!this.moves(1).length)this.end();else say("No moves â€” Diddy goes again!");}else say("Your turn âšª");},600);},
end(){const p1=this.g.flat().filter(v=>v===1).length,p2=this.g.flat().filter(v=>v===2).length;this.over=true;say(p2>p1?"You win! "+p2+"-"+p1:p1>p2?"Diddy wins! "+p1+"-"+p2:"Draw!");},
hint(){say("Corners are king. Avoid giving Diddy access to them!");}};

// â”€â”€ FLAPPY BIRD AI: Race side by side â”€â”€
IMPL.flappy={raf:null,cleanup(){cancelAnimationFrame(this.raf);},
init(){
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const W=360,H=400,c=mkC(W,H);mg.appendChild(c);const ctx=c.getContext("2d");
  // Two lanes side by side
  const LW=W/2-2;
  let p={y:H/2,vy:0,alive:true,score:0};
  let ai={y:H/2,vy:0,alive:true,score:0};
  let pipes=[],fr=0,started=false;
  const GAP=115,SPD=2.2,PW=36;
  const jump=()=>{if(!started)started=true;if(p.alive)p.vy=-7;else if(!ai.alive){p={y:H/2,vy:0,alive:true,score:0};ai={y:H/2,vy:0,alive:true,score:0};pipes=[];fr=0;started=false;}};
  c.onclick=jump;document.onkeydown=e=>{if(e.key===" "||e.key==="ArrowUp"){e.preventDefault();jump();}};
  const loop=()=>{
    fr++;
    if(fr%85===0&&started)pipes.push({x:LW,top:55+Math.random()*(H-GAP-110),sc1:false,sc2:false});
    pipes.forEach(p2=>p2.x-=SPD);pipes=pipes.filter(p2=>p2.x>-PW);
    if(p.alive){p.vy+=0.42;p.y+=p.vy;if(p.y<0||p.y>H-30)p.alive=false;pipes.forEach(pp=>{if(Math.abs(LW/2-(pp.x+PW/2))<PW/2+9&&(p.y<pp.top||p.y>pp.top+GAP-14))p.alive=false;if(!pp.sc1&&pp.x<LW/3){pp.sc1=true;p.score++;}});}
    // AI: flap when below center of next pipe gap
    if(ai.alive){ai.vy+=0.42;ai.y+=ai.vy;const next=pipes.find(pp=>pp.x>0);if(next){const mid=(next.top+next.top+GAP)/2;if(ai.y>mid-15&&ai.vy>-2)ai.vy=-7;}ai.y+=0;if(ai.y<0||ai.y>H-30)ai.alive=false;pipes.forEach(pp=>{if(Math.abs(LW*1.5-(pp.x+PW/2))<PW/2+9&&(ai.y<pp.top||ai.y>pp.top+GAP-14))ai.alive=false;if(!pp.sc2&&pp.x<LW/3){pp.sc2=true;ai.score++;}});}
    // Draw
    ctx.fillStyle="#001828";ctx.fillRect(0,0,W,H);
    ctx.fillStyle="#0a1020";ctx.fillRect(W/2-1,0,2,H);
    // Lane labels
    ctx.font="bold 10px Inter";ctx.textAlign="center";ctx.fillStyle="#00ff88";ctx.fillText("YOU",LW/2,14);ctx.fillStyle="#ff4488";ctx.fillText("DIDDY",LW+LW/2,14);
    // Pipes (offset for each lane)
    [0,1].forEach(lane=>{const ox=lane*W/2;pipes.forEach(pp=>{ctx.fillStyle="#1a4422";ctx.fillRect(ox+pp.x,0,PW,pp.top);ctx.fillRect(ox+pp.x,pp.top+GAP,PW,H);ctx.fillStyle="#2a6633";ctx.fillRect(ox+pp.x-3,pp.top-10,PW+6,10);ctx.fillRect(ox+pp.x-3,pp.top+GAP,PW+6,10);});});
    // Ground
    ctx.fillStyle="#112233";ctx.fillRect(0,H-30,W,30);
    // Player bird
    if(p.alive){ctx.shadowColor="#00ff88";ctx.shadowBlur=10;ctx.font="16px serif";ctx.textAlign="center";ctx.fillText("ðŸ¦",LW/2,p.y+7);ctx.shadowBlur=0;}
    else{ctx.fillStyle="rgba(255,0,0,.15)";ctx.fillRect(0,0,LW,H);}
    // AI bird
    if(ai.alive){ctx.shadowColor="#ff4488";ctx.shadowBlur=10;ctx.font="16px serif";ctx.fillText("ðŸ¤–",LW+LW/2,ai.y+7);ctx.shadowBlur=0;}
    else{ctx.fillStyle="rgba(255,0,0,.15)";ctx.fillRect(LW+2,0,LW,H);}
    // Scores
    ctx.shadowBlur=0;ctx.font="bold 16px Orbitron,monospace";ctx.textAlign="center";ctx.fillStyle="#00ff88";ctx.fillText(p.score,LW/2,34);ctx.fillStyle="#ff4488";ctx.fillText(ai.score,LW+LW/2,34);
    // End state
    if(!p.alive||!ai.alive){const pWin=p.score>ai.score||(p.alive&&!ai.alive);ctx.fillStyle="rgba(0,0,0,.6)";ctx.fillRect(0,0,W,H);ctx.shadowColor=pWin?"#00ff88":"#ff4488";ctx.shadowBlur=20;ctx.fillStyle=pWin?"#00ff88":"#ff4488";ctx.font="bold 16px Orbitron,monospace";ctx.textAlign="center";ctx.fillText(pWin?"YOU WIN":"DIDDY WINS",W/2,H/2);ctx.font="11px Inter";ctx.shadowBlur=0;ctx.fillStyle="#c0c8e8";ctx.fillText("Tap to play again",W/2,H/2+22);sHUD(p.score,ai.score);}
    else if(!started){ctx.fillStyle="#00ff8888";ctx.font="12px Inter";ctx.textAlign="center";ctx.fillText("TAP to start",W/2,H/2);}
    if(p.alive&&ai.alive)this.raf=requestAnimationFrame(loop);else{this.raf=requestAnimationFrame(loop);}
  };loop();
},hint(){say("Your lane is left, Diddy is right. Higher score when you crash wins!");}};

// â”€â”€ BATTLESHIP â”€â”€
IMPL.battleship={SZ:8,SH:[4,3,3,2,2],
init(){this.pg=this.mkG();this.ag=this.mkG();this.ps=this.placeS(this.pg);this.as=this.placeS(this.ag);this.ph=[];this.ah=[];this.over=false;this.aiQ=[];const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="bs-m">Fire on the enemy grid!</div><div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center;"><div><div style="font-size:.54rem;color:var(--dm);margin-bottom:3px">ENEMY</div><div id="bs-e" style="display:inline-grid;grid-template-columns:repeat(8,26px);gap:1px;background:#0a1020;padding:3px;"></div></div><div><div style="font-size:.54rem;color:var(--dm);margin-bottom:3px">YOUR FLEET</div><div id="bs-y" style="display:inline-grid;grid-template-columns:repeat(8,26px);gap:1px;background:#0a1020;padding:3px;"></div></div></div>';mg.appendChild(w);this.render();},
mkG(){return Array(this.SZ).fill(null).map(()=>Array(this.SZ).fill(0));},
placeS(g){const ships=[];this.SH.forEach(len=>{let ok=false;while(!ok){const h=Math.random()<.5,r=Math.floor(Math.random()*this.SZ),c=Math.floor(Math.random()*this.SZ);const cells=[];for(let i=0;i<len;i++){const nr=r+(h?0:i),nc=c+(h?i:0);if(nr>=this.SZ||nc>=this.SZ||g[nr][nc])break;cells.push([nr,nc]);}if(cells.length===len){cells.forEach(([r,c])=>g[r][c]=1);ships.push(cells);ok=true;}}});return ships;},
fire(r,c,hits){if(hits.some(h=>h[0]===r&&h[1]===c))return false;hits.push([r,c]);return true;},
hit(r,c,g){return g[r][c]===1;},
render(){const re=document.getElementById("bs-e"),ry=document.getElementById("bs-y");if(!re)return;re.innerHTML="";ry.innerHTML="";for(let r=0;r<this.SZ;r++)for(let c=0;c<this.SZ;c++){const eh=this.ah.find(h=>h[0]===r&&h[1]===c);const ed=document.createElement("div");ed.style.cssText="width:26px;height:26px;background:"+(eh?(this.hit(r,c,this.ag)?"#662200":"#0a1a2a"):"#0a1a30")+";display:flex;align-items:center;justify-content:center;font-size:.7rem;cursor:pointer;border-radius:2px;";ed.textContent=eh?(this.hit(r,c,this.ag)?"ðŸ’¥":"Â·"):"";if(!this.over)ed.onclick=()=>this.pfire(r,c);re.appendChild(ed);const ph=this.ph.find(h=>h[0]===r&&h[1]===c);const pd=document.createElement("div");pd.style.cssText="width:26px;height:26px;background:"+(this.pg[r][c]?ph?"#882200":"#1a3a60":"#0a1a30")+";display:flex;align-items:center;justify-content:center;font-size:.7rem;border-radius:2px;";pd.textContent=ph?(this.hit(r,c,this.pg)?"ðŸ’¥":"Â·"):"";ry.appendChild(pd);}const ps=this.as.filter(s=>s.every(([r,c])=>this.ah.some(h=>h[0]===r&&h[1]===c))).length;const as=this.ps.filter(s=>s.every(([r,c])=>this.ph.some(h=>h[0]===r&&h[1]===c))).length;sHUD("Sunk: "+ps+"/"+this.SH.length,"Sunk: "+as+"/"+this.SH.length);},
pfire(r,c){if(!this.fire(r,c,this.ah)||this.over)return;const h=this.hit(r,c,this.ag);say(h?"ðŸ’¥ Hit!":"ðŸ’§ Missâ€¦");if(this.as.every(s=>s.every(([r,c])=>this.ah.some(h=>h[0]===r&&h[1]===c)))){this.over=true;say("You sunk Diddy's fleet!");this.render();return;}this.render();setTimeout(()=>this.afire(),650);},
afire(){let r,c;if(this.aiQ.length){[r,c]=this.aiQ.shift();while(this.ph.some(h=>h[0]===r&&h[1]===c)&&this.aiQ.length)[r,c]=this.aiQ.shift();}if(r===undefined||this.ph.some(h=>h[0]===r&&h[1]===c)){do{r=Math.floor(Math.random()*this.SZ);c=Math.floor(Math.random()*this.SZ);}while(this.ph.some(h=>h[0]===r&&h[1]===c));}this.ph.push([r,c]);if(this.hit(r,c,this.pg)){say("Diddy hit your ship!");[[r-1,c],[r+1,c],[r,c-1],[r,c+1]].forEach(([nr,nc])=>{if(nr>=0&&nr<this.SZ&&nc>=0&&nc<this.SZ&&!this.ph.some(h=>h[0]===nr&&h[1]===nc))this.aiQ.push([nr,nc]);});}else say("Diddy missed. Your turn!");if(this.ps.every(s=>s.every(([r,c])=>this.ph.some(h=>h[0]===r&&h[1]===c)))){this.over=true;say("Diddy sunk your fleet!");}this.render();},
hint(){say("Checkerboard pattern. After a hit, try adjacent cells!");}};

// â”€â”€ TRON AI (Light Cycles) â”€â”€
IMPL.tron={raf:null,cleanup(){cancelAnimationFrame(this.raf);},
init(){
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const W=400,H=300,GS=10,c=mkC(W,H);c.style.maxWidth="100%";c.style.height="auto";mg.appendChild(c);
  const ctx=c.getContext("2d");const CW=W/GS,CH=H/GS;
  let p1={x:10,y:CH/2,dx:1,dy:0},p2={x:CW-10,y:CH/2,dx:-1,dy:0};
  let t1=new Set(),t2=new Set(),over=false,fr=0,winner="";
  const add=(s,p)=>s.add(p.x+","+p.y);
  // Direct direction â€” no keys dict
  let nd={dx:1,dy:0};
  const setP1=(dx,dy)=>{if(!(dx===-p1.dx&&dy===-p1.dy))nd={dx,dy};};
  document.onkeydown=e=>{if(e.key==="ArrowUp")setP1(0,-1);else if(e.key==="ArrowDown")setP1(0,1);else if(e.key==="ArrowLeft")setP1(-1,0);else if(e.key==="ArrowRight")setP1(1,0);};
  let sx4,sy4;c.addEventListener("touchstart",e=>{sx4=e.touches[0].clientX;sy4=e.touches[0].clientY;},{passive:true});
  c.addEventListener("touchend",e=>{const dx2=e.changedTouches[0].clientX-sx4,dy2=e.changedTouches[0].clientY-sy4;if(Math.max(Math.abs(dx2),Math.abs(dy2))<15)return;if(Math.abs(dx2)>Math.abs(dy2))setP1(dx2>0?1:-1,0);else setP1(0,dy2>0?1:-1);},{passive:true});
  // AI: avoid walls, prefer open space
  const aiMove=()=>{const opts=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}].filter(d=>!(d.dx===-p2.dx&&d.dy===-p2.dy));const safe=opts.filter(d=>{const nx=p2.x+d.dx,ny=p2.y+d.dy;return nx>0&&nx<CW&&ny>0&&ny<CH&&!t1.has(nx+","+ny)&&!t2.has(nx+","+ny);});if(!safe.length)return;const pick=safe.sort((a,b)=>{const scoreDir=(d)=>{let open=0;for(let i=1;i<=5;i++){const nx=p2.x+d.dx*i,ny=p2.y+d.dy*i;if(nx<=0||nx>=CW||ny<=0||ny>=CH||t1.has(nx+","+ny)||t2.has(nx+","+ny))break;open++;}return open;};return scoreDir(b)-scoreDir(a);})[0];p2.dx=pick.dx;p2.dy=pick.dy;};
  const loop=()=>{if(over){this.raf=requestAnimationFrame(loop);return;}fr++;
    if(fr%3===0){p1.dx=nd.dx;p1.dy=nd.dy;if(fr%4===0)aiMove();}
    add(t1,p1);add(t2,p2);p1.x+=p1.dx;p1.y+=p1.dy;p2.x+=p2.dx;p2.y+=p2.dy;
    const p1Dead=p1.x<=0||p1.x>=CW||p1.y<=0||p1.y>=CH||t1.has(p1.x+","+p1.y)||t2.has(p1.x+","+p1.y);
    const p2Dead=p2.x<=0||p2.x>=CW||p2.y<=0||p2.y>=CH||t2.has(p2.x+","+p2.y)||t1.has(p2.x+","+p2.y);
    if(p1Dead||p2Dead){over=true;winner=p1Dead&&p2Dead?"Draw!":(p2Dead?"You WIN! ðŸŽ‰":"Diddy wins! ðŸ¤–");say(winner);}
    ctx.fillStyle="#000";ctx.fillRect(0,0,W,H);
    t1.forEach(k=>{const[x,y]=k.split(",").map(Number);ctx.fillStyle="#00ff88";ctx.fillRect(x*GS,y*GS,GS-1,GS-1);});
    t2.forEach(k=>{const[x,y]=k.split(",").map(Number);ctx.fillStyle="#ff4488";ctx.fillRect(x*GS,y*GS,GS-1,GS-1);});
    ctx.shadowColor="#00ff88";ctx.shadowBlur=12;ctx.fillStyle="#fff";ctx.fillRect(p1.x*GS,p1.y*GS,GS-1,GS-1);ctx.shadowColor="#ff4488";ctx.fillStyle="#fff";ctx.fillRect(p2.x*GS,p2.y*GS,GS-1,GS-1);ctx.shadowBlur=0;
    if(over){ctx.fillStyle="rgba(0,0,0,.7)";ctx.fillRect(0,0,W,H);const wc=winner.includes("YOU")?"#00ff88":"#ff4488";ctx.shadowColor=wc;ctx.shadowBlur=20;ctx.fillStyle=wc;ctx.font="bold 20px Orbitron,monospace";ctx.textAlign="center";ctx.fillText(winner,W/2,H/2);ctx.shadowBlur=0;}
    this.raf=requestAnimationFrame(loop);};loop();
  mg.appendChild(mkDpad({up:()=>setP1(0,-1),down:()=>setP1(0,1),left:()=>setP1(-1,0),right:()=>setP1(1,0)}));
},hint(){say("Green = you, Pink = Diddy. Don't cross any trail â€” yours or theirs!");}};

// â”€â”€ ASTEROIDS â”€â”€
IMPL.asteroids={raf:null,cleanup(){cancelAnimationFrame(this.raf);},
init(){const mg=document.getElementById("mgame");mg.innerHTML="";const W=400,H=340,c=mkC(W,H);mg.appendChild(c);const ctx=c.getContext("2d");let ship={x:W/2,y:H/2,a:0,vx:0,vy:0},bullets=[],rocks=[],score=0,lives=3,fr=0;const keys={};document.onkeydown=e=>keys[e.key]=1;document.onkeyup=e=>delete keys[e.key];for(let i=0;i<5;i++)rocks.push({x:Math.random()*W,y:Math.random()*H,vx:(Math.random()-.5)*2.5,vy:(Math.random()-.5)*2.5,r:30,pts:20});const loop=()=>{fr++;if(keys.ArrowLeft)ship.a-=0.07;if(keys.ArrowRight)ship.a+=0.07;if(keys.ArrowUp){ship.vx+=Math.cos(ship.a)*0.2;ship.vy+=Math.sin(ship.a)*0.2;}ship.vx*=0.99;ship.vy*=0.99;ship.x=(ship.x+ship.vx+W)%W;ship.y=(ship.y+ship.vy+H)%H;if(keys[" "]&&fr%10===0)bullets.push({x:ship.x,y:ship.y,vx:Math.cos(ship.a)*8,vy:Math.sin(ship.a)*8,life:50});bullets.forEach(b=>{b.x=(b.x+b.vx+W)%W;b.y=(b.y+b.vy+H)%H;b.life--;});bullets=bullets.filter(b=>b.life>0);rocks.forEach(r=>{r.x=(r.x+r.vx+W)%W;r.y=(r.y+r.vy+H)%H;});const newRocks=[];bullets.forEach(b=>{rocks.forEach(r=>{if(Math.hypot(b.x-r.x,b.y-r.y)<r.r){score+=r.pts;b.life=0;if(r.r>12){for(let i=0;i<2;i++)newRocks.push({x:r.x,y:r.y,vx:(Math.random()-.5)*4,vy:(Math.random()-.5)*4,r:r.r/2,pts:r.pts*2});}r.r=0;}});});rocks=rocks.filter(r=>r.r>0);rocks.push(...newRocks);if(!rocks.length)for(let i=0;i<5;i++)rocks.push({x:Math.random()<0.5?0:W,y:Math.random()*H,vx:(Math.random()-.5)*3,vy:(Math.random()-.5)*3,r:30,pts:20});rocks.forEach(r=>{if(Math.hypot(ship.x-r.x,ship.y-r.y)<r.r){lives--;rocks=rocks.map(r=>({...r,x:Math.random()*W,y:Math.random()*H}));if(!lives){say("GAME OVER! Score: "+score);return;}}});sHUD(score,"lives: "+lives);ctx.fillStyle="#000";ctx.fillRect(0,0,W,H);ctx.strokeStyle="#00ff88";ctx.lineWidth=1.5;rocks.forEach(r=>{ctx.beginPath();for(let i=0;i<7;i++){const a=i/7*Math.PI*2,rx=r.x+Math.cos(a)*r.r*(0.7+Math.random()*0.3);const ry=r.y+Math.sin(a)*r.r;i?ctx.lineTo(rx,ry):ctx.moveTo(rx,ry);}ctx.closePath();ctx.stroke();});ctx.save();ctx.translate(ship.x,ship.y);ctx.rotate(ship.a);ctx.strokeStyle="#00ff88";ctx.beginPath();ctx.moveTo(14,0);ctx.lineTo(-8,8);ctx.lineTo(-4,0);ctx.lineTo(-8,-8);ctx.closePath();ctx.stroke();if(keys.ArrowUp){ctx.fillStyle="#ff8800";ctx.beginPath();ctx.moveTo(-4,0);ctx.lineTo(-12,4);ctx.lineTo(-10,0);ctx.lineTo(-12,-4);ctx.closePath();ctx.fill();}ctx.restore();ctx.fillStyle="#fff";bullets.forEach(b=>{ctx.beginPath();ctx.arc(b.x,b.y,2,0,Math.PI*2);ctx.fill();});this.raf=requestAnimationFrame(loop);};loop();},hint(){say("Arrow keys to turn/thrust, Space to shoot. Shoot big rocks first!");}};

// â”€â”€ FROGGER AI â”€â”€
IMPL.frogger={raf:null,aiIv:null,cleanup(){cancelAnimationFrame(this.raf);clearInterval(this.aiIv);},
init(){
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const W=380,H=340,c=mkC(W,H);c.style.maxWidth="100%";c.style.height="auto";mg.appendChild(c);
  const ctx=c.getContext("2d");const RH=H/8;
  let fy=H-RH/2,fx=W/2,afy=H-RH/2,afx=W/2+60;
  let lives=3,score=0,aiScore=0,fr=0;
  const lanes=[{y:H*6/8,dir:1,speed:1.8,cars:[{x:20},{x:150},{x:280}],col:"#ff4444"},{y:H*5/8,dir:-1,speed:2.2,cars:[{x:70},{x:200}],col:"#ff8844"},{y:H*4/8,dir:1,speed:1.5,cars:[{x:100},{x:260}],col:"#4488ff"},{y:H*3/8,dir:-1,speed:2.6,cars:[{x:40},{x:190},{x:320}],col:"#44ff88"},{y:H*2/8,dir:1,speed:1.2,cars:[{x:80},{x:220}],col:"#aa44ff"}];
  const move=(dx,dy)=>{fx=Math.max(20,Math.min(W-20,fx+dx*40));fy=Math.min(H-RH/2,fy+dy*RH);if(fy<RH/2){score++;sHUD(score,aiScore+" Diddy");fy=H-RH/2;fx=W/2;}};
  document.onkeydown=e=>{if(e.key==="ArrowUp")move(0,-1);else if(e.key==="ArrowDown")move(0,1);else if(e.key==="ArrowLeft")move(-1,0);else if(e.key==="ArrowRight")move(1,0);};
  let sx3,sy3;c.addEventListener("touchstart",e=>{sx3=e.touches[0].clientX;sy3=e.touches[0].clientY;},{passive:true});
  c.addEventListener("touchend",e=>{const dx2=e.changedTouches[0].clientX-sx3,dy2=e.changedTouches[0].clientY-sy3;if(Math.max(Math.abs(dx2),Math.abs(dy2))<15)return;if(Math.abs(dx2)>Math.abs(dy2))move(dx2>0?1:-1,0);else move(0,dy2>0?1:-1);},{passive:true});
  clearInterval(this.aiIv);this.aiIv=setInterval(()=>{if(afy>RH){afy-=RH;afx=Math.max(20,Math.min(W-20,afx+(Math.random()-.5)*60));}else{aiScore++;sHUD(score,aiScore+" Diddy");afy=H-RH/2;afx=W/2+60;}},1200);
  const loop=()=>{fr++;lanes.forEach(l=>l.cars.forEach(car=>{car.x+=l.dir*l.speed;if(car.x>W+40)car.x=-40;if(car.x<-40)car.x=W+40;}));
    let hit=false;lanes.forEach(l=>l.cars.forEach(car=>{if(Math.abs(fy-l.y)<18&&Math.abs(fx-car.x-20)<34)hit=true;}));
    if(hit){lives--;fy=H-RH/2;fx=W/2;if(!lives){say("GAME OVER! You: "+score+" Diddy: "+aiScore);clearInterval(this.aiIv);return;}}
    ctx.fillStyle="#111";ctx.fillRect(0,0,W,H);
    ctx.fillStyle="#1a3a10";ctx.fillRect(0,0,W,RH);ctx.fillRect(0,H-RH,W,RH);
    ctx.fillStyle="#222";for(let i=1;i<7;i++)ctx.fillRect(0,i*RH,W,RH*0.9);
    ctx.strokeStyle="#333";ctx.lineWidth=1;ctx.setLineDash([12,8]);for(let i=1;i<7;i++){ctx.beginPath();ctx.moveTo(0,i*RH+RH/2);ctx.lineTo(W,i*RH+RH/2);ctx.stroke();}ctx.setLineDash([]);
    lanes.forEach(l=>l.cars.forEach(car=>{ctx.fillStyle=l.col;ctx.fillRect(car.x,l.y-12,60,24);ctx.fillStyle="#000";ctx.fillRect(car.x+5,l.y-10,14,9);ctx.fillRect(car.x+41,l.y-10,14,9);}));
    ctx.font="20px serif";ctx.textAlign="center";ctx.fillText("ðŸ¸",fx,fy+7);
    ctx.globalAlpha=0.75;ctx.fillText("ðŸ¤–",afx,afy+7);ctx.globalAlpha=1;
    ctx.fillStyle="#00ff88";ctx.font="bold 11px Orbitron,monospace";ctx.textAlign="left";ctx.fillText("YOU: "+score,4,14);ctx.fillStyle="#ff4488";ctx.textAlign="right";ctx.fillText("DIDDY: "+aiScore,W-4,14);ctx.fillStyle="#fff";ctx.fillText("â¤".repeat(lives),4,26);
    this.raf=requestAnimationFrame(loop);};loop();
  mg.appendChild(mkDpad({up:()=>move(0,-1),down:()=>move(0,1),left:()=>move(-1,0),right:()=>move(1,0)}));
},hint(){say("Swipe or d-pad to hop lanes. Diddy climbs steadily â€” beat its score!");}};

// â”€â”€ PAC-MAN â”€â”€
IMPL.pacman={raf:null,cleanup(){cancelAnimationFrame(this.raf);},
init(){
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const GS=20,COLS=19,ROWS=15,W=COLS*GS,H=ROWS*GS,c=mkC(W,H);
  c.style.maxWidth="100%";c.style.height="auto";
  mg.appendChild(c);const ctx=c.getContext("2d");
  const MAP=["###################","#........#........#","#.##.###.#.###.##.#","#.................#","#.##.#.#####.#.##.#","#....#...#...#....#","####.###.#.###.####","####.#.......#.####","####.#.#####.#.####","#........#........#","#.##.###.#.###.##.#","#..#.....#.....#..#","##.#.#.#####.#.#.##","#....#...#...#....#","###################"];
  let px=9,py=7,pdx=1,pdy=0,qx=1,qy=0,mouth=0,score=0,aiScore=0;
  const ghosts=[{x:9,y:4,dx:1,dy:0,col:"#ff4488"},{x:8,y:5,dx:-1,dy:0,col:"#ff8844"},{x:10,y:5,dx:0,dy:1,col:"#44aaff"}];
  const walls=new Set();let dots=0;
  MAP.forEach((row,r)=>[...row].forEach((ch,cc)=>{if(ch==="#")walls.add(cc+","+r);if(ch===".")dots++;}));
  const pellets=new Set(MAP.flatMap((row,r)=>[...row].map((ch,cc)=>ch==="."?cc+","+r:null).filter(Boolean)));
  // AI ghost targets player
  const ghostMove=(g,spd,fr)=>{if(fr%spd!==0)return;const opts=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}];const valid=opts.filter(d=>!walls.has((g.x+d.dx)+","+(g.y+d.dy))&&!(d.dx===-g.dx&&d.dy===-g.dy));if(!valid.length)return;// 70% chase, 30% random
const chase=Math.random()<0.7;const pick=chase?valid.sort((a,b)=>(Math.abs(g.x+a.dx-px)+Math.abs(g.y+a.dy-py))-(Math.abs(g.x+b.dx-px)+Math.abs(g.y+b.dy-py)))[0]:valid[Math.floor(Math.random()*valid.length)];g.dx=pick.dx;g.dy=pick.dy;g.x+=g.dx;g.y+=g.dy;};
  // Direct direction control â€” no fake keystrokes
  const setDir=(dx,dy)=>{qx=dx;qy=dy;};
  document.onkeydown=e=>{const m={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};if(m[e.key]){e.preventDefault();setDir(...m[e.key]);}};
  // Swipe
  let sx2,sy2;c.addEventListener("touchstart",e=>{sx2=e.touches[0].clientX;sy2=e.touches[0].clientY;},{passive:true});
  c.addEventListener("touchend",e=>{const dx2=e.changedTouches[0].clientX-sx2,dy2=e.changedTouches[0].clientY-sy2;if(Math.max(Math.abs(dx2),Math.abs(dy2))<15)return;if(Math.abs(dx2)>Math.abs(dy2))setDir(dx2>0?1:-1,0);else setDir(0,dy2>0?1:-1);},{passive:true});
  let fr=0,over=false;
  const loop=()=>{
    fr++;mouth=(mouth+8)%360;
    // Try queued direction first, then continue current
    if(fr%5===0){
      let tried=false;
      if(!walls.has((px+qx)+","+(py+qy))){pdx=qx;pdy=qy;tried=true;}
      const nx=px+pdx,ny=py+pdy;
      if(!walls.has(nx+","+ny)){px=nx;py=ny;}
      const pk=px+","+py;if(pellets.has(pk)){pellets.delete(pk);score+=10;sHUD(score,aiScore+" Diddy");}
    }
    // Ghosts at varied speeds â€” not too fast
    ghostMove(ghosts[0],9,fr);ghostMove(ghosts[1],11,fr);ghostMove(ghosts[2],13,fr);
    // AI ghost collects pellets too (Diddy competition)
    ghosts.forEach(g=>{const gk=g.x+","+g.y;if(pellets.has(gk)){pellets.delete(gk);aiScore+=10;sHUD(score,aiScore+" Diddy");}});
    // Collision
    ghosts.forEach(g=>{if(g.x===px&&g.y===py&&!over){over=true;say(score>aiScore?"You: "+score+" Diddy: "+aiScore+" â€” YOU WIN! ðŸŽ‰":"You: "+score+" Diddy: "+aiScore+" â€” Diddy wins! ðŸ¤–");}});
    if(!pellets.size&&!over){over=true;say("Board clear! You: "+score+" Diddy: "+aiScore+(score>aiScore?" â€” YOU WIN! ðŸŽ‰":" â€” Diddy wins! ðŸ¤–"));}
    // Draw
    ctx.fillStyle="#000";ctx.fillRect(0,0,W,H);
    MAP.forEach((row,r)=>[...row].forEach((ch,cc)=>{if(ch==="#"){ctx.fillStyle="#00248c";ctx.fillRect(cc*GS,r*GS,GS,GS);ctx.strokeStyle="#1a3aaa";ctx.strokeRect(cc*GS+.5,r*GS+.5,GS-1,GS-1);}}));
    pellets.forEach(pk=>{const[pc,pr]=pk.split(",").map(Number);ctx.fillStyle="#ffcc44";ctx.shadowColor="#ffcc44";ctx.shadowBlur=4;ctx.beginPath();ctx.arc(pc*GS+GS/2,pr*GS+GS/2,2.5,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;});
    // Pac-Man
    ctx.fillStyle="#ffcc00";ctx.shadowColor="#ffcc00";ctx.shadowBlur=8;ctx.beginPath();const ang=Math.PI/6*(1+Math.sin(fr*.3));const dir2=Math.atan2(pdy,pdx);ctx.moveTo(px*GS+GS/2,py*GS+GS/2);ctx.arc(px*GS+GS/2,py*GS+GS/2,GS/2-1,dir2+ang,dir2+Math.PI*2-ang);ctx.closePath();ctx.fill();ctx.shadowBlur=0;
    // Ghosts
    ghosts.forEach(g=>{ctx.fillStyle=g.col;ctx.shadowColor=g.col;ctx.shadowBlur=8;ctx.beginPath();const gx=g.x*GS+GS/2,gy=g.y*GS+GS/2;ctx.arc(gx,gy,GS/2-1,Math.PI,0);ctx.lineTo(gx+GS/2-1,gy+GS/2-1);for(let i=0;i<3;i++){ctx.lineTo(gx+(GS-2)-(i*(GS-2)/2.5),gy+(i%2?GS/2-1:GS/2-5));}ctx.lineTo(gx-(GS/2-1),gy+GS/2-1);ctx.closePath();ctx.fill();ctx.shadowBlur=0;ctx.fillStyle="#fff";ctx.beginPath();ctx.arc(gx-4,gy-2,3,0,Math.PI*2);ctx.arc(gx+4,gy-2,3,0,Math.PI*2);ctx.fill();ctx.fillStyle="#00f";ctx.beginPath();ctx.arc(gx-3+g.dx,gy-1+g.dy,1.5,0,Math.PI*2);ctx.arc(gx+5+g.dx,gy-1+g.dy,1.5,0,Math.PI*2);ctx.fill();});
    // Score overlay
    ctx.shadowBlur=0;ctx.fillStyle="#00ff88";ctx.font="bold 12px Orbitron,monospace";ctx.textAlign="left";ctx.fillText("YOU: "+score,4,13);ctx.fillStyle="#ff4488";ctx.textAlign="right";ctx.fillText("DIDDY: "+aiScore,W-4,13);
    if(!over)this.raf=requestAnimationFrame(loop);else{ctx.fillStyle="rgba(0,0,0,.75)";ctx.fillRect(0,0,W,H);ctx.shadowColor=score>aiScore?"#00ff88":"#ff4488";ctx.shadowBlur=20;ctx.fillStyle=score>aiScore?"#00ff88":"#ff4488";ctx.font="bold 18px Orbitron,monospace";ctx.textAlign="center";ctx.fillText(score>aiScore?"YOU WIN":"DIDDY WINS",W/2,H/2);ctx.shadowBlur=0;}
  };loop();
  // D-pad with direct direction setting
  const dp=mkDpad({up:()=>setDir(0,-1),down:()=>setDir(0,1),left:()=>setDir(-1,0),right:()=>setDir(1,0)});
  mg.appendChild(dp);
},hint(){say("Green dots = your score, ghosts collect for Diddy. Avoid the ghosts!");}};

// â”€â”€ SOKOBAN â”€â”€
IMPL.sokoban={
LV:[{map:["#####","#P..#","#.B.#","#.*$#","#####"],w:5,h:5},{map:["#######","#P....#","#.###.#","#.B*$.#","#.....#","#######"],w:7,h:6}],
init(){this.lv=0;this.load(0);},
load(l){const L=this.LV[l%this.LV.length];this.w=L.w;this.h=L.h;this.moves=0;this.map=L.map.map(r=>[...r]);this.px=0;this.py=0;this.boxes=new Set();this.goals=new Set();for(let r=0;r<this.h;r++)for(let c=0;c<this.w;c++){if(this.map[r][c]==="P"){this.px=c;this.py=r;this.map[r][c]=".";}if(this.map[r][c]==="B"){this.boxes.add(c+","+r);this.map[r][c]=".";}if(this.map[r][c]==="$"){this.boxes.add(c+","+r);this.map[r][c]="*";}if(this.map[r][c]==="*")this.goals.add(c+","+r);}
const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="sk-m">Push boxes ðŸ“¦ onto goals â˜… â€” Arrow keys</div><div id="sk-g"></div>';mg.appendChild(w);
document.onkeydown=e=>{const m={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};if(m[e.key]){e.preventDefault();this.move2(m[e.key][0],m[e.key][1]);}};this.render();},
move2(dx,dy){const nx=this.px+dx,ny=this.py+dy;if(!this.map[ny]||this.map[ny][nx]==="#")return;const bk=nx+","+ny;if(this.boxes.has(bk)){const bx2=nx+dx,by2=ny+dy;const bk2=bx2+","+by2;if(!this.map[by2]||this.map[by2][bx2]==="#"||this.boxes.has(bk2))return;this.boxes.delete(bk);this.boxes.add(bk2);}this.px=nx;this.py=ny;this.moves++;if([...this.goals].every(g=>this.boxes.has(g))){say("Level "+(this.lv+1)+" done in "+this.moves+" moves!");setTimeout(()=>this.load(++this.lv),1000);}this.render();},
render(){const g=document.getElementById("sk-g");if(!g)return;g.innerHTML="";const grid=document.createElement("div");grid.style.cssText="display:inline-grid;grid-template-columns:repeat("+this.w+",38px);gap:2px;";for(let r=0;r<this.h;r++)for(let c=0;c<this.w;c++){const d=document.createElement("div");const isGoal=this.goals.has(c+","+r);const isBox=this.boxes.has(c+","+r);const isWall=this.map[r][c]==="#";const isPlayer=this.px===c&&this.py===r;d.style.cssText="width:38px;height:38px;display:flex;align-items:center;justify-content:center;font-size:1.4rem;border-radius:3px;background:"+(isWall?"#1a2030":isGoal?"#0a1a2a":"#0a0a10")+";";d.textContent=isWall?"":isPlayer?"ðŸš¶":isBox?(isGoal?"âœ…":"ðŸ“¦"):isGoal?"â­":"";grid.appendChild(d);}g.appendChild(grid);say("Moves: "+this.moves+" | Level "+(this.lv+1));},
hint(){say("You can't pull boxes, only push. Plan routes carefully!");}};

// â•â•â• VISUAL UPGRADES â•â•â•

// Better score HUD
function sHUD(a, b){
  const el = document.getElementById("msc");
  if(el) el.innerHTML = '<span style="color:var(--acc);font-weight:600">'+a+'</span><span style="color:var(--dm);margin:0 6px">Â·</span><span style="color:var(--a2)">Diddy: '+b+'</span>';
}
function say(m){
  const el = document.getElementById("msc");
  if(el) el.innerHTML = '<span style="color:var(--a4)">'+m+'</span>';
}

// Canvas glow helper
function ctxGlow(ctx, color, blur){
  ctx.shadowColor = color;
  ctx.shadowBlur = blur||12;
}
function ctxNoGlow(ctx){ ctx.shadowBlur=0; }

// Upgrade card hover â€” pulse animation on cards
document.querySelectorAll('.card').forEach(card => {
  card.addEventListener('mouseenter', () => {
    card.style.transition = 'all .18s';
  });
});

// Stub games get a nicer placeholder
const _stub = stub;
window.stub = function(g) {
  const catColor = {Arcade:'#ff6600',Board:'#4488ff',Card:'#ffcc00',Puzzle:'#aa44ff',Word:'#00ccff',Casual:'#44ff88'}[g.cat] || '#00ff88';
  document.getElementById("mgame").innerHTML =
    '<div style="text-align:center;padding:50px 20px;">' +
    '<div style="font-size:4rem;filter:drop-shadow(0 0 20px '+catColor+'66)">'+g.icon+'</div>' +
    '<div style="font-size:1rem;margin-top:14px;color:'+catColor+';font-family:Orbitron,monospace;font-weight:700;letter-spacing:.06em">'+g.name.toUpperCase()+'</div>' +
    '<div style="font-size:.6rem;margin-top:8px;color:var(--dm)">Click NEW to play</div>' +
    '</div>';
};

// Better modal title color per category
const _openGame = openGame;
window.openGame = function(id) {
  _openGame(id);
  const g = GAMES.find(x=>x.id===id);
  if(!g) return;
  const catColor = {Arcade:'#ff6600',Board:'#4488ff',Card:'#ffcc00',Puzzle:'#aa44ff',Word:'#00ccff',Casual:'#44ff88'}[g.cat] || '#00ff88';
  const hdr = document.getElementById("mhdr");
  const title = document.getElementById("mtitle");
  if(hdr) hdr.style.borderBottom = '2px solid '+catColor+'44';
  if(title) title.style.color = catColor;
};

</script></body></html>
