<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BlissNexus Arcade ‚Äî 50 Games vs AI</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@400;500;600&display=swap');

:root{
  --bg:#080810;--bg2:#0e0e1a;--bg3:#161625;--bg4:#1e1e30;
  --acc:#00ff88;--a2:#ff4488;--a3:#4488ff;--a4:#ffcc00;--a5:#ff6600;--a6:#aa44ff;
  --tx:#d0d8f0;--dm:#4a5080;
  --arcade:#ff6600;--board:#4488ff;--card:#ffcc00;--puzzle:#aa44ff;--word:#00ccff;--casual:#44ff88;
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{width:100%;min-height:100vh;background:var(--bg);color:var(--tx);font-family:'Inter',sans-serif;overflow-x:hidden;}

/* ‚îÄ‚îÄ BACKGROUND ‚îÄ‚îÄ */
body::before{content:'';position:fixed;inset:0;background:
  radial-gradient(ellipse 80% 50% at 20% 20%, #00ff8808 0%, transparent 60%),
  radial-gradient(ellipse 60% 40% at 80% 80%, #4488ff08 0%, transparent 60%),
  radial-gradient(ellipse 40% 60% at 50% 50%, #ff448806 0%, transparent 70%);
  pointer-events:none;z-index:0;}
body::after{content:'';position:fixed;inset:0;background-image:
  linear-gradient(rgba(0,255,136,.03) 1px,transparent 1px),
  linear-gradient(90deg,rgba(0,255,136,.03) 1px,transparent 1px);
  background-size:40px 40px;pointer-events:none;z-index:0;}
#hub{position:relative;z-index:1;padding:12px 14px 40px;}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.hdr{text-align:center;padding:28px 0 20px;border-bottom:1px solid #1a2040;}
.title{font-family:'Orbitron',monospace;font-size:2rem;font-weight:900;
  background:linear-gradient(135deg,#00ff88,#4488ff,#ff4488);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  letter-spacing:.08em;text-shadow:none;filter:drop-shadow(0 0 20px #00ff8844);}
.sub{font-size:.58rem;color:var(--dm);letter-spacing:.25em;margin-top:5px;text-transform:uppercase;}
.ai-pill{display:inline-flex;align-items:center;gap:7px;background:linear-gradient(135deg,#0a1a12,#0a1020);
  border:1px solid #00ff8840;border-radius:20px;padding:5px 14px;font-size:.6rem;
  color:var(--acc);margin-top:10px;font-family:'Orbitron',monospace;letter-spacing:.05em;
  box-shadow:0 0 20px #00ff8815;}
.dot{width:7px;height:7px;background:var(--acc);border-radius:50%;
  box-shadow:0 0 8px var(--acc);animation:blink 1.4s ease infinite;}
@keyframes blink{0%,100%{opacity:1;box-shadow:0 0 8px var(--acc);}50%{opacity:.3;box-shadow:none;}}

/* ‚îÄ‚îÄ CATEGORY TABS ‚îÄ‚îÄ */
.cats{display:flex;gap:6px;justify-content:center;flex-wrap:wrap;padding:14px 0 16px;}
.cat{padding:5px 14px;background:var(--bg3);border:1px solid #2a3050;border-radius:20px;
  font-size:.58rem;color:var(--dm);cursor:pointer;transition:all .18s;font-weight:600;letter-spacing:.04em;text-transform:uppercase;}
.cat:hover{border-color:var(--acc);color:var(--acc);background:var(--bg4);}
.cat.on{background:linear-gradient(135deg,#001a0e,#001428);border-color:var(--acc);color:var(--acc);
  box-shadow:0 0 12px #00ff8820;}

/* ‚îÄ‚îÄ GAME GRID ‚îÄ‚îÄ */
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:9px;}
.card{background:var(--bg2);border:1px solid #1e2040;border-radius:12px;
  padding:14px 8px 12px;text-align:center;cursor:pointer;transition:all .2s;
  position:relative;overflow:hidden;}
.card::before{content:'';position:absolute;inset:0;opacity:0;transition:opacity .2s;
  background:radial-gradient(ellipse at top,var(--card-glow,#00ff8820),transparent 70%);}
.card:hover{border-color:var(--card-color,var(--acc));transform:translateY(-3px);
  box-shadow:0 8px 24px var(--card-shadow,#00ff8820);}
.card:hover::before{opacity:1;}
.card:active{transform:translateY(-1px);}
.card.hide{display:none;}
.card[data-cat="Arcade"]{--card-color:#ff6600;--card-shadow:#ff660025;--card-glow:#ff660018;}
.card[data-cat="Board"]{--card-color:#4488ff;--card-shadow:#4488ff25;--card-glow:#4488ff18;}
.card[data-cat="Card"]{--card-color:#ffcc00;--card-shadow:#ffcc0025;--card-glow:#ffcc0018;}
.card[data-cat="Puzzle"]{--card-color:#aa44ff;--card-shadow:#aa44ff25;--card-glow:#aa44ff18;}
.card[data-cat="Word"]{--card-color:#00ccff;--card-shadow:#00ccff25;--card-glow:#00ccff18;}
.card[data-cat="Casual"]{--card-color:#44ff88;--card-shadow:#44ff8825;--card-glow:#44ff8818;}
.ci{font-size:1.7rem;margin-bottom:6px;display:block;filter:drop-shadow(0 2px 4px rgba(0,0,0,.4));}
.cn{font-size:.54rem;color:var(--tx);font-weight:600;line-height:1.3;}
.cc{font-size:.44rem;color:var(--dm);margin-top:2px;text-transform:uppercase;letter-spacing:.08em;}
.badge{position:absolute;top:5px;right:5px;font-size:.38rem;font-weight:700;
  background:var(--bg4);color:var(--a3);border:1px solid #4488ff44;border-radius:3px;
  padding:1px 4px;letter-spacing:.06em;}

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
#modal{position:fixed;inset:0;z-index:999;background:rgba(0,0,0,.85);
  backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;}
#modal.on{display:flex;}
#mbox{background:var(--bg2);border:1px solid #2a3060;border-radius:16px;
  width:min(98vw,660px);max-height:94vh;display:flex;flex-direction:column;
  overflow:hidden;box-shadow:0 24px 80px rgba(0,0,0,.7),0 0 0 1px #ffffff08;}
#mhdr{display:flex;align-items:center;justify-content:space-between;
  padding:12px 16px;border-bottom:1px solid #1a2040;
  background:linear-gradient(90deg,var(--bg3),var(--bg2));}
#mtitle{font-family:'Orbitron',monospace;font-size:.78rem;font-weight:700;
  color:var(--acc);letter-spacing:.06em;}
#msc{font-size:.58rem;color:var(--dm);margin-left:8px;}
#mcls{background:transparent;border:1px solid #2a3050;color:var(--dm);
  padding:4px 10px;border-radius:6px;cursor:pointer;font-size:.65rem;font-family:inherit;
  transition:all .14s;letter-spacing:.04em;}
#mcls:hover{border-color:var(--a2);color:var(--a2);background:#1a0a10;}
#mgame{flex:1;overflow:auto;display:flex;flex-direction:column;align-items:center;
  justify-content:center;padding:14px;min-height:360px;background:var(--bg);}
#mft{padding:8px 14px;border-top:1px solid #1a2040;display:flex;gap:7px;align-items:center;
  background:var(--bg2);}
.mb{padding:5px 14px;background:var(--bg3);border:1px solid #2a3050;color:var(--tx);
  border-radius:7px;cursor:pointer;font-size:.6rem;font-family:inherit;transition:all .14s;
  letter-spacing:.04em;}
.mb:hover{border-color:var(--acc);color:var(--acc);background:var(--bg4);}
.mb:active{transform:scale(.97);}
.mb.p{background:linear-gradient(135deg,#005533,#008844);border-color:var(--acc);
  color:#fff;font-weight:600;box-shadow:0 2px 12px #00ff8830;}
.mb.p:hover{box-shadow:0 4px 20px #00ff8850;}
.aif{margin-left:auto;font-size:.56rem;color:var(--acc);display:flex;align-items:center;
  gap:5px;font-family:'Orbitron',monospace;letter-spacing:.04em;}

/* ‚îÄ‚îÄ GAME UI ‚îÄ‚îÄ */
canvas{display:block;background:#000;border:1px solid #1a2040;border-radius:6px;max-width:100%;
  box-shadow:0 4px 20px rgba(0,0,0,.5);}
.gw{display:flex;flex-direction:column;align-items:center;gap:9px;width:100%;}
.msg{font-size:.68rem;color:var(--a4);text-align:center;min-height:18px;
  letter-spacing:.04em;font-weight:500;}
.brd{display:inline-grid;gap:2px;background:#0a0e20;padding:5px;border-radius:8px;
  box-shadow:0 4px 20px rgba(0,0,0,.5);}
.cl{display:flex;align-items:center;justify-content:center;cursor:pointer;
  border-radius:4px;transition:all .1s;}
.slr{display:flex;gap:8px;justify-content:center;}
.reel{width:68px;height:76px;background:linear-gradient(180deg,#1a1a2e,#0a0a1a);
  border:2px solid #2a3050;border-radius:10px;display:flex;align-items:center;
  justify-content:center;font-size:2.2rem;box-shadow:inset 0 2px 8px rgba(0,0,0,.5);}
.crd{width:54px;height:72px;background:linear-gradient(180deg,#1a1a2e,#0e0e1a);
  border:1px solid #2a3050;border-radius:8px;display:flex;align-items:center;
  justify-content:center;font-size:.9rem;cursor:pointer;user-select:none;
  transition:all .14s;box-shadow:0 2px 8px rgba(0,0,0,.3);}
.crd:hover{border-color:var(--acc);transform:translateY(-2px);}
.crd.flip{background:linear-gradient(180deg,#0a1a0e,#061210);border-color:var(--acc);}
.mcl{width:24px;height:24px;background:#0e1020;border:1px solid #2a3050;
  display:flex;align-items:center;justify-content:center;font-size:.6rem;
  cursor:pointer;border-radius:3px;font-weight:700;transition:background .1s;}
.mcl:hover{background:#1a2030;}
.mcl.op{background:#1a1a28;border-color:#0a0e20;}
.g48{display:grid;grid-template-columns:repeat(4,62px);gap:6px;
  background:#0a0e20;padding:6px;border-radius:10px;
  box-shadow:0 4px 20px rgba(0,0,0,.5);}
.t2{width:62px;height:62px;display:flex;align-items:center;justify-content:center;
  border-radius:7px;font-weight:900;font-size:.78rem;transition:all .12s;
  box-shadow:inset 0 1px 0 rgba(255,255,255,.1);}
.sg{display:grid;grid-template-columns:1fr 1fr;gap:7px;width:186px;height:186px;}
.sb{border-radius:10px;cursor:pointer;border:none;transition:opacity .1s;
  box-shadow:0 4px 12px rgba(0,0,0,.4);}
.sb:active{opacity:.7 !important;}
.hw{display:flex;flex-wrap:wrap;gap:4px;justify-content:center;}
.hb{width:28px;height:28px;background:var(--bg3);border:1px solid #2a3050;
  color:var(--tx);border-radius:5px;cursor:pointer;font-size:.62rem;font-family:inherit;
  transition:all .12s;}
.hb:hover:not([disabled]){border-color:var(--acc);color:var(--acc);}
.hb[disabled]{opacity:.2;cursor:not-allowed;}
.bg2{display:inline-grid;grid-template-columns:repeat(10,26px);gap:1px;
  background:#080810;padding:4px;border-radius:4px;}
.bc{width:26px;height:26px;background:#0e1020;display:flex;align-items:center;
  justify-content:center;font-size:.72rem;cursor:pointer;border-radius:3px;
  transition:background .1s;}
.bc:hover{background:#1a2030;}

/* ‚îÄ‚îÄ MOBILE ‚îÄ‚îÄ */
@media(max-width:600px){
  .title{font-size:1.4rem;}
  .grid{grid-template-columns:repeat(auto-fill,minmax(82px,1fr));gap:6px;}
  .card{padding:10px 6px;}
  .ci{font-size:1.4rem;}
  .cn{font-size:.5rem;}
  #mbox{width:100vw;max-height:100dvh;border-radius:20px 20px 0 0;border-bottom:none;}
  #modal{align-items:flex-end;}
  #mgame{padding:8px;min-height:280px;}
  canvas{width:100% !important;height:auto !important;}
  .g48{grid-template-columns:repeat(4,calc(22vw - 8px));}
  .t2{width:calc(22vw - 8px);height:calc(22vw - 8px);font-size:.68rem;}
  .mcl{width:20px;height:20px;font-size:.55rem;}
  #mine-g{grid-template-columns:repeat(16,20px) !important;}
  .sg{width:160px;height:160px;}
  .hb{width:24px;height:24px;font-size:.55rem;}
}
input,textarea,select{font-size:16px !important;}
</style></head><body>
<div id="hub">
  <div class="hdr">
    <div class="title">BLISSNEXUS ARCADE</div>
    <div class="sub">50 Classic Games &middot; Play vs AI</div>
    <div class="ai-pill"><div class="dot"></div>Diddy &#x1F9BE; &nbsp;¬∑&nbsp; Online &amp; Ready</div>
  </div>
  <div class="cats" id="cats"></div>
  <div class="grid" id="grid"></div>
</div>
<div id="modal">
  <div id="mbox">
    <div id="mhdr">
      <div style="display:flex;align-items:center;gap:6px;">
        <div id="mtitle">GAME</div><div id="msc"></div>
      </div>
      <button id="mcls" onclick="closeGame()">&#x2715; EXIT</button>
    </div>
    <div id="mgame"></div>
    <div id="mft">
      <button class="mb p" onclick="newGame()">&#x21BA; NEW</button>
      <button class="mb" onclick="gameHint()">&#x1F4A1; HINT</button>
      <div class="aif"><div class="dot"></div>vs Diddy &#x1F9BE;</div>
    </div>
  </div>
</div>
<script>
const GAMES=[
  {id:"pong",name:"Ping Pong",icon:"üèì",cat:"Arcade"},
  {id:"snake",name:"Snake",icon:"üêç",cat:"Arcade"},
  {id:"breakout",name:"Breakout",icon:"üß±",cat:"Arcade"},
  {id:"invaders",name:"Space Invaders",icon:"üëæ",cat:"Arcade"},
  {id:"flappy",name:"Flappy Bird",icon:"üê¶",cat:"Arcade"},
  {id:"whack",name:"Whack-a-Mole",icon:"üî®",cat:"Arcade"},
  {id:"tron",name:"Light Cycles",icon:"üèç",cat:"Arcade"},
  {id:"asteroids",name:"Asteroids",icon:"‚òÑ",cat:"Arcade"},
  {id:"frogger",name:"Frogger",icon:"üê∏",cat:"Arcade"},
  {id:"pacman",name:"Pac-Man",icon:"üü°",cat:"Arcade"},
  {id:"ttt",name:"Tic Tac Toe",icon:"‚≠ï",cat:"Board"},
  {id:"c4",name:"Connect Four",icon:"üîµ",cat:"Board"},
  {id:"checkers",name:"Checkers",icon:"üü§",cat:"Board"},
  {id:"reversi",name:"Reversi",icon:"‚ö´",cat:"Board"},
  {id:"dots",name:"Dots & Boxes",icon:"üü´",cat:"Board"},
  {id:"battleship",name:"Battleship",icon:"üö¢",cat:"Board"},
  {id:"gomoku",name:"Gomoku",icon:"üîµ",cat:"Board"},
  {id:"chess",name:"Chess",icon:"‚ôü",cat:"Board"},
  {id:"mancala",name:"Mancala",icon:"ü™£",cat:"Board"},
  {id:"nim",name:"Nim",icon:"üéØ",cat:"Board"},
  {id:"blackjack",name:"Blackjack",icon:"üÇæ",cat:"Card"},
  {id:"memory",name:"Memory Match",icon:"üÉè",cat:"Card"},
  {id:"slots",name:"Slots",icon:"üé∞",cat:"Card"},
  {id:"yahtzee",name:"Yahtzee",icon:"üé≤",cat:"Card"},
  {id:"solitaire",name:"Solitaire",icon:"‚ô†",cat:"Card"},
  {id:"war",name:"War",icon:"‚öî",cat:"Card"},
  {id:"poker",name:"Video Poker",icon:"üÉè",cat:"Card"},
  {id:"hilo",name:"Hi-Lo Cards",icon:"üìà",cat:"Card"},
  {id:"mines",name:"Minesweeper",icon:"üí£",cat:"Puzzle"},
  {id:"tetris",name:"Tetris",icon:"üü¶",cat:"Puzzle"},
  {id:"g2048",name:"2048",icon:"üî¢",cat:"Puzzle"},
  {id:"p15",name:"15 Puzzle",icon:"üîÄ",cat:"Puzzle"},
  {id:"sokoban",name:"Sokoban",icon:"üì¶",cat:"Puzzle"},
  {id:"simon",name:"Simon Says",icon:"üî¥",cat:"Puzzle"},
  {id:"sudoku",name:"Sudoku",icon:"üî£",cat:"Puzzle"},
  {id:"towers",name:"Tower of Hanoi",icon:"üóº",cat:"Puzzle"},
  {id:"lights",name:"Lights Out",icon:"üí°",cat:"Puzzle"},
  {id:"pipe",name:"Pipe Dream",icon:"üîß",cat:"Puzzle"},
  {id:"hangman",name:"Hangman",icon:"ü™¢",cat:"Word"},
  {id:"wordsearch",name:"Word Search",icon:"üî§",cat:"Word"},
  {id:"scramble",name:"Word Scramble",icon:"üî°",cat:"Word"},
  {id:"typerace",name:"Type Racer",icon:"‚å®",cat:"Word"},
  {id:"rps",name:"Rock Paper Scissors",icon:"‚úä",cat:"Casual"},
  {id:"reaction",name:"Reaction Time",icon:"‚ö°",cat:"Casual"},
  {id:"numguess",name:"Number Guess",icon:"‚ùì",cat:"Casual"},
  {id:"bowling",name:"Bowling",icon:"üé≥",cat:"Casual"},
  {id:"coin",name:"Coin Flip",icon:"ü™ô",cat:"Casual"},
  {id:"mathquiz",name:"Math Quiz",icon:"‚ûï",cat:"Casual"},
  {id:"colormatch",name:"Color Match",icon:"üé®",cat:"Casual"},
  {id:"trivia",name:"Trivia",icon:"üß†",cat:"Casual"},
];
const CATS=["All","Arcade","Board","Card","Puzzle","Word","Casual"];
const catsEl=document.getElementById("cats");
CATS.forEach((c,i)=>{
  const d=document.createElement("div");d.className="cat"+(i===0?" on":"");
  d.textContent=c==="All"?"All (50)":c;
  d.onclick=()=>{document.querySelectorAll(".cat").forEach(x=>x.classList.remove("on"));d.classList.add("on");document.querySelectorAll(".card").forEach(x=>x.classList.toggle("hide",c!=="All"&&x.dataset.cat!==c));};
  catsEl.appendChild(d);
});
const grid=document.getElementById("grid");
GAMES.forEach(g=>{
  const d=document.createElement("div");d.className="card";d.dataset.cat=g.cat;
  d.innerHTML='<div class="badge">AI</div><span class="ci">'+g.icon+'</span><div class="cn">'+g.name+'</div><div class="cc">'+g.cat+'</div>';
  d.onclick=()=>openGame(g.id);grid.appendChild(d);
});
let CUR=null;
function openGame(id){
  const g=GAMES.find(x=>x.id===id);if(!g)return;
  CUR=id;
  document.getElementById("mtitle").textContent=g.icon+" "+g.name.toUpperCase();
  document.getElementById("msc").textContent="";
  document.getElementById("mgame").innerHTML="";
  document.getElementById("modal").classList.add("on");
  if(IMPL[id])IMPL[id].init();else stub(g);
}
function closeGame(){document.getElementById("modal").classList.remove("on");if(CUR&&IMPL[CUR]&&IMPL[CUR].cleanup)IMPL[CUR].cleanup();CUR=null;document.onkeydown=null;}
function newGame(){if(CUR&&IMPL[CUR])IMPL[CUR].init();}
function gameHint(){if(CUR&&IMPL[CUR]&&IMPL[CUR].hint)IMPL[CUR].hint();else say("Think ahead and outplay Diddy!");}
function say(m){document.getElementById("msc").textContent=m;}
function stub(g){document.getElementById("mgame").innerHTML='<div style="text-align:center;padding:40px;color:var(--dm)"><div style="font-size:3rem">'+g.icon+'</div><div style="font-size:.8rem;margin-top:10px;color:var(--acc)">'+g.name+'</div><div style="font-size:.6rem;margin-top:6px">Loading‚Ä¶</div></div>';}
function mkC(w,h){const c=document.createElement("canvas");c.width=w;c.height=h;return c;}
function sHUD(a,b){say("You: "+a+"   Diddy: "+b);}
const IMPL={};
// ‚îÄ‚îÄ PONG ‚îÄ‚îÄ
IMPL.pong={raf:null,cleanup(){cancelAnimationFrame(this.raf);},
init(){
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const W=440,H=280,c=mkC(W,H);mg.appendChild(c);const ctx=c.getContext("2d");
  const PH=54,PW=9;let ps=H/2-PH/2,ai=H/2-PH/2,bx=W/2,by=H/2,bvx=4,bvy=2,pS=0,aS=0;
  const keys={};document.onkeydown=e=>keys[e.key]=1;document.onkeyup=e=>delete keys[e.key];
  c.onmousemove=e=>{const r=c.getBoundingClientRect();ps=Math.max(0,Math.min(H-PH,(e.clientY-r.top)*H/r.height-PH/2));};
  const loop=()=>{
    if(keys.ArrowUp)ps=Math.max(0,ps-5);if(keys.ArrowDown)ps=Math.min(H-PH,ps+5);
    const aim=by-PH/2;ai+=(aim-ai)*0.09;ai=Math.max(0,Math.min(H-PH,ai));
    bx+=bvx;by+=bvy;
    if(by<6||by>H-6)bvy*=-1;
    if(bx<PW+10&&by>ps&&by<ps+PH&&bvx<0){bvx=Math.abs(bvx)+0.15;bvy+=(by-ps-PH/2)*0.07;}
    if(bx>W-PW-10&&by>ai&&by<ai+PH&&bvx>0){bvx=-Math.abs(bvx)-0.15;bvy+=(by-ai-PH/2)*0.07;}
    bvy=Math.max(-8,Math.min(8,bvy));
    if(bx<0){aS++;bx=W/2;by=H/2;bvx=4;bvy=2*(Math.random()>.5?1:-1);}
    if(bx>W){pS++;bx=W/2;by=H/2;bvx=-4;bvy=2*(Math.random()>.5?1:-1);}
    sHUD(pS,aS);
    ctx.fillStyle="#000";ctx.fillRect(0,0,W,H);
    ctx.setLineDash([6,6]);ctx.strokeStyle="#1a2030";ctx.lineWidth=2;
    ctx.beginPath();ctx.moveTo(W/2,0);ctx.lineTo(W/2,H);ctx.stroke();ctx.setLineDash([]);
    ctx.fillStyle="#00ff88";ctx.fillRect(8,ps,PW,PH);
    ctx.fillStyle="#ff4488";ctx.fillRect(W-8-PW,ai,PW,PH);
    ctx.fillStyle="#fff";ctx.beginPath();ctx.arc(bx,by,6,0,Math.PI*2);ctx.fill();
    ctx.fillStyle="#888";ctx.font="bold 16px monospace";ctx.textAlign="center";
    ctx.fillText(pS,W/4,22);ctx.fillText(aS,3*W/4,22);
    this.raf=requestAnimationFrame(loop);
  };loop();
},hint(){say("Mouse or arrow keys. Edge hits = sharper angles!");}};

// ‚îÄ‚îÄ SNAKE ‚îÄ‚îÄ
IMPL.snake={iv:null,cleanup(){clearInterval(this.iv);},
init(){
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const CS=18,C=22,R=18,W=C*CS,H=R*CS,c=mkC(W,H);mg.appendChild(c);const ctx=c.getContext("2d");
  let sn=[{x:5,y:9}],dir={x:1,y:0},food={x:15,y:9},score=0,alive=true;
  document.onkeydown=e=>{const m={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};if(m[e.key]&&!(m[e.key].x===-dir.x&&m[e.key].y===-dir.y))dir=m[e.key];};
  clearInterval(this.iv);this.iv=setInterval(()=>{
    if(!alive)return;
    const h={x:(sn[0].x+dir.x+C)%C,y:(sn[0].y+dir.y+R)%R};
    if(sn.some(s=>s.x===h.x&&s.y===h.y)){alive=false;say("Game over! Score: "+score);return;}
    sn.unshift(h);
    if(h.x===food.x&&h.y===food.y){score++;food={x:Math.floor(Math.random()*C),y:Math.floor(Math.random()*R)};sHUD(score,"watching üëÅ");}
    else sn.pop();
    ctx.fillStyle="#000";ctx.fillRect(0,0,W,H);
    ctx.fillStyle="#ff4488";ctx.fillRect(food.x*CS+2,food.y*CS+2,CS-4,CS-4);
    sn.forEach((s,i)=>{ctx.fillStyle=i?"#00cc66":"#00ff88";ctx.fillRect(s.x*CS+1,s.y*CS+1,CS-2,CS-2);});
    if(!alive){ctx.fillStyle="rgba(0,0,0,.7)";ctx.fillRect(0,0,W,H);ctx.fillStyle="#ff4488";ctx.font="bold 22px monospace";ctx.textAlign="center";ctx.fillText("GAME OVER",W/2,H/2);}
  },130);
},hint(){say("Arrow keys. Wraps through walls. Don't bite yourself!");}};

// ‚îÄ‚îÄ BREAKOUT ‚îÄ‚îÄ
IMPL.breakout={raf:null,cleanup(){cancelAnimationFrame(this.raf);},
init(){
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const W=440,H=320,c=mkC(W,H);mg.appendChild(c);const ctx=c.getContext("2d");
  const BW=40,BH=13,G=2;let bricks=[],px=W/2-40,bx=W/2,by=H-50,bvx=3.5,bvy=-4,score=0,lives=3,go=false;
  for(let r=0;r<5;r++)for(let cc=0;cc<10;cc++)bricks.push({x:cc*(BW+G)+G,y:r*(BH+G)+G+36,col:["#ff4488","#ff8844","#ffcc44","#44ff88","#4488ff"][r]});
  c.onmousemove=e=>{const r=c.getBoundingClientRect();px=Math.max(0,Math.min(W-80,(e.clientX-r.left)*W/r.width-40));};
  c.onclick=()=>go=true;document.onkeydown=e=>{if(e.key==="ArrowLeft")px=Math.max(0,px-18);if(e.key==="ArrowRight")px=Math.min(W-80,px+18);if(e.key===" ")go=true;};
  const loop=()=>{
    if(go){bx+=bvx;by+=bvy;}
    if(bx<=5||bx>=W-5)bvx*=-1;if(by<=5)bvy*=-1;
    if(by>H){lives--;if(!lives){say("Game over! Score: "+score);return;}bx=W/2;by=H-80;bvx=3.5;bvy=-4;go=false;}
    if(by>=H-27&&by<=H-18&&bx>=px&&bx<=px+80){bvy=-Math.abs(bvy);bvx+=(bx-px-40)/40*4;}
    for(let i=bricks.length-1;i>=0;i--){const b=bricks[i];if(bx>b.x&&bx<b.x+BW&&by>b.y&&by<b.y+BH){bricks.splice(i,1);score+=10;bvy*=-1;break;}}
    if(!bricks.length){say("YOU WIN! Score: "+score);return;}
    sHUD(score,"lives: "+lives);
    ctx.fillStyle="#000";ctx.fillRect(0,0,W,H);
    bricks.forEach(b=>{ctx.fillStyle=b.col;ctx.fillRect(b.x,b.y,BW,BH);ctx.fillStyle="rgba(255,255,255,.12)";ctx.fillRect(b.x,b.y,BW,4);});
    ctx.fillStyle="#00ff88";ctx.fillRect(px,H-22,80,9);
    ctx.fillStyle="#fff";ctx.beginPath();ctx.arc(bx,by,5,0,Math.PI*2);ctx.fill();
    if(!go){ctx.fillStyle="#00ff8866";ctx.font="11px monospace";ctx.textAlign="center";ctx.fillText("CLICK or SPACE",W/2,H-70);}
    this.raf=requestAnimationFrame(loop);
  };loop();
},hint(){say("Edge of paddle = sharper angle. Keep bricks from rebuilding!");}};

// ‚îÄ‚îÄ SPACE INVADERS ‚îÄ‚îÄ
IMPL.invaders={raf:null,cleanup(){cancelAnimationFrame(this.raf);},
init(){
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const W=400,H=320,c=mkC(W,H);mg.appendChild(c);const ctx=c.getContext("2d");
  let inv=[],bl=[],ib=[],px=W/2,score=0,lives=3,dx=0.8,fr=0,over=false;
  for(let r=0;r<4;r++)for(let cc=0;cc<9;cc++)inv.push({x:cc*38+25,y:r*28+28,alive:true,r});
  const keys={};document.onkeydown=e=>{keys[e.key]=1;if((e.key===" "||e.key==="ArrowUp")&&bl.length<4)bl.push({x:px,y:H-30});};document.onkeyup=e=>delete keys[e.key];
  const loop=()=>{
    fr++;if(over){this.raf=requestAnimationFrame(loop);return;}
    if(keys.ArrowLeft)px=Math.max(14,px-4);if(keys.ArrowRight)px=Math.min(W-14,px+4);
    const live=inv.filter(i=>i.alive);if(!live.length){say("YOU WIN! Score: "+score);over=true;}
    if(fr%2===0)live.forEach(i=>i.x+=dx);
    const xs=live.map(i=>i.x);if(xs.length&&(Math.max(...xs)>W-18||Math.min(...xs)<18)){dx*=-1;live.forEach(i=>i.y+=10);}
    if(fr%55===0&&live.length){const s=live[Math.floor(Math.random()*live.length)];ib.push({x:s.x,y:s.y+10});}
    bl.forEach(b=>b.y-=8);ib.forEach(b=>b.y+=4);
    bl=bl.filter(b=>b.y>0);ib=ib.filter(b=>b.y<H);
    bl.forEach(b=>live.forEach(i=>{if(i.alive&&Math.abs(b.x-i.x)<14&&Math.abs(b.y-i.y)<11){i.alive=false;score+=10*(4-i.r);b.y=-99;}}));
    ib.forEach(b=>{if(Math.abs(b.x-px)<14&&b.y>H-38){lives--;b.y=-99;if(!lives){say("GAME OVER! Score: "+score);over=true;}}});
    sHUD(score,"lives: "+lives);
    ctx.fillStyle="#000";ctx.fillRect(0,0,W,H);
    const cols=["#ff4488","#ff8844","#ffcc44","#44ff88"];
    live.forEach(i=>{ctx.fillStyle=cols[i.r];ctx.font="15px serif";ctx.textAlign="center";ctx.fillText("üëæ",i.x,i.y+6);});
    ctx.fillStyle="#00ff88";ctx.fillRect(px-13,H-33,26,10);ctx.fillRect(px-5,H-42,10,9);
    bl.forEach(b=>{ctx.fillStyle="#00ff88";ctx.fillRect(b.x-2,b.y,4,8);});
    ib.forEach(b=>{ctx.fillStyle="#ff4488";ctx.fillRect(b.x-2,b.y,4,8);});
    if(over){ctx.fillStyle="rgba(0,0,0,.75)";ctx.fillRect(0,0,W,H);ctx.fillStyle=lives?"#00ff88":"#ff4488";ctx.font="bold 18px monospace";ctx.textAlign="center";ctx.fillText(lives?"YOU WIN":"GAME OVER",W/2,H/2);ctx.fillText("Score: "+score,W/2,H/2+24);}
    this.raf=requestAnimationFrame(loop);
  };loop();
},hint(){say("Arrows + Space. Kill bottom row first for safety!");}};
// ‚îÄ‚îÄ TIC TAC TOE (perfect minimax) ‚îÄ‚îÄ
IMPL.ttt={
init(){
  this.b=Array(9).fill("");this.over=false;
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const w=document.createElement("div");w.className="gw";
  w.innerHTML='<div class="msg" id="ttt-m">Your turn ‚Äî you are X</div><div class="brd" id="ttt-b" style="grid-template-columns:repeat(3,80px);grid-template-rows:repeat(3,80px);"></div>';
  mg.appendChild(w);this.render();
},
render(){
  const b=document.getElementById("ttt-b");if(!b)return;b.innerHTML="";
  this.b.forEach((v,i)=>{const c=document.createElement("div");c.className="cl";c.style.cssText="width:80px;height:80px;font-size:2rem;background:var(--bg3);cursor:pointer;";c.style.color=v==="X"?"var(--acc)":"var(--a2)";c.textContent=v;c.onclick=()=>this.mv(i);b.appendChild(c);});
},
mv(i){
  if(this.b[i]||this.over)return;this.b[i]="X";this.render();
  const w=this.chk();if(w||!this.b.includes("")){this.over=true;document.getElementById("ttt-m").textContent=w==="X"?"You win!":w==="O"?"Diddy wins!":"Draw!";return;}
  document.getElementById("ttt-m").textContent="Diddy thinking‚Ä¶";
  setTimeout(()=>{let best=-9,bi=-1;this.b.forEach((_,j)=>{if(!this.b[j]){this.b[j]="O";const s=this.mm(false);this.b[j]="";if(s>best){best=s;bi=j;}}});if(bi>=0)this.b[bi]="O";this.render();const w2=this.chk();if(w2||!this.b.includes("")){this.over=true;document.getElementById("ttt-m").textContent=w2==="O"?"Diddy wins!":w2==="X"?"You win!":"Draw!";}else document.getElementById("ttt-m").textContent="Your turn ‚Äî X";},350);
},
mm(isO){const w=this.chk();if(w==="O")return 1;if(w==="X")return -1;if(!this.b.includes(""))return 0;let best=isO?-9:9;this.b.forEach((_,i)=>{if(!this.b[i]){this.b[i]=isO?"O":"X";const s=this.mm(!isO);this.b[i]="";best=isO?Math.max(best,s):Math.min(best,s);}});return best;},
chk(){const L=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const l of L)if(this.b[l[0]]&&this.b[l[0]]===this.b[l[1]]&&this.b[l[1]]===this.b[l[2]])return this.b[l[0]];return null;},
hint(){say("Diddy plays perfectly ‚Äî best you can do is draw!");}};

// ‚îÄ‚îÄ CONNECT FOUR ‚îÄ‚îÄ
IMPL.c4={R:6,C:7,
init(){
  this.g=Array(6).fill(null).map(()=>Array(7).fill(0));this.over=false;
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const w=document.createElement("div");w.className="gw";
  w.innerHTML='<div class="msg" id="c4m">Drop a disc ‚Äî you are blue</div><div class="brd" id="c4b" style="grid-template-columns:repeat(7,42px);grid-template-rows:repeat(6,42px);background:#002244;gap:3px;padding:5px;border-radius:8px;"></div>';
  mg.appendChild(w);this.render();
},
render(){
  const b=document.getElementById("c4b");if(!b)return;b.innerHTML="";
  for(let r=0;r<this.R;r++)for(let c=0;c<this.C;c++){const d=document.createElement("div");d.className="cl";d.style.cssText="width:42px;height:42px;border-radius:50%;cursor:pointer;background:"+(this.g[r][c]===0?"#001133":this.g[r][c]===1?"#4488ff":"#ff4488")+";";if(r===0&&!this.over)d.onclick=()=>this.drop(c);b.appendChild(d);}
},
drop(col){
  if(this.over)return;for(let r=this.R-1;r>=0;r--){if(!this.g[r][col]){this.g[r][col]=1;break;}}
  this.render();if(this.win(1)){this.over=true;document.getElementById("c4m").textContent="You win!";return;}
  if(this.full()){document.getElementById("c4m").textContent="Draw!";return;}
  document.getElementById("c4m").textContent="Diddy thinking‚Ä¶";
  setTimeout(()=>{const bc=this.best();for(let r=this.R-1;r>=0;r--){if(!this.g[r][bc]){this.g[r][bc]=2;break;}}this.render();if(this.win(2)){this.over=true;document.getElementById("c4m").textContent="Diddy wins!";}else if(this.full())document.getElementById("c4m").textContent="Draw!";else document.getElementById("c4m").textContent="Your turn";},500);
},
best(){
  const W=[[100,-20,10,5,5,10,-20,100],[-20,-50,-2,-2,-2,-2,-50,-20],[10,-2,5,1,1,5,-2,10],[5,-2,1,1,1,1,-2,5],[5,-2,1,1,1,1,-2,5],[10,-2,5,1,1,5,-2,10]];
  let bsc=-999,bc=3;
  for(let c=0;c<this.C;c++){if(!this.g[0][c]){
    const t2=this.g.map(r=>[...r]);for(let r=this.R-1;r>=0;r--)if(!t2[r][c]){t2[r][c]=2;break;}
    if(this.winB(t2,2))return c;
    const t1=this.g.map(r=>[...r]);for(let r=this.R-1;r>=0;r--)if(!t1[r][c]){t1[r][c]=1;break;}
    if(this.winB(t1,1)){bsc=900;bc=c;continue;}
    const row=this.g.map((row,r)=>row[c]===0?r:-1).filter(r=>r>=0).sort((a,b)=>b-a)[0];
    const sc=(W[row]||[])[c]||0;if(sc>bsc){bsc=sc;bc=c;}
  }}return bc;
},
win(p){return this.winB(this.g,p);},
winB(g,p){for(let r=0;r<this.R;r++)for(let c=0;c<this.C;c++){if(c+3<this.C&&[0,1,2,3].every(i=>g[r][c+i]===p))return true;if(r+3<this.R&&[0,1,2,3].every(i=>g[r+i][c]===p))return true;if(r+3<this.R&&c+3<this.C&&[0,1,2,3].every(i=>g[r+i][c+i]===p))return true;if(r+3<this.R&&c-3>=0&&[0,1,2,3].every(i=>g[r+i][c-i]===p))return true;}return false;},
full(){return this.g[0].every(c=>c!==0);},
hint(){say("Control center. Block Diddy's 3-in-a-rows!");}};

// ‚îÄ‚îÄ MINESWEEPER ‚îÄ‚îÄ
IMPL.mines={RR:12,CC:16,M:28,
init(){
  this.board=Array(this.RR).fill(null).map(()=>Array(this.CC).fill(0));
  this.rev=Array(this.RR).fill(null).map(()=>Array(this.CC).fill(false));
  this.flag=Array(this.RR).fill(null).map(()=>Array(this.CC).fill(false));
  this.over=false;this.gen2=false;this.flags=0;
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const w=document.createElement("div");w.className="gw";
  w.innerHTML='<div class="msg" id="mine-m">Click to reveal ¬∑ Right-click to flag ¬∑ Mines: 28</div><div id="mine-g" style="display:inline-grid;grid-template-columns:repeat(16,24px);gap:1px;"></div>';
  mg.appendChild(w);this.render();
},
nb(r,c){const n=[];for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++){if(dr||dc){const nr=r+dr,nc=c+dc;if(nr>=0&&nr<this.RR&&nc>=0&&nc<this.CC)n.push([nr,nc]);}}return n;},
gen(sr,sc){let p=0;while(p<this.M){const r=Math.floor(Math.random()*this.RR),c=Math.floor(Math.random()*this.CC);if(this.board[r][c]!==-1&&!(r===sr&&c===sc)){this.board[r][c]=-1;p++;}}for(let r=0;r<this.RR;r++)for(let c=0;c<this.CC;c++)if(this.board[r][c]!==-1)this.board[r][c]=this.nb(r,c).filter(([nr,nc])=>this.board[nr][nc]===-1).length;this.gen2=true;},
reveal(r,c){
  if(this.rev[r][c]||this.flag[r][c]||this.over)return;
  if(!this.gen2)this.gen(r,c);this.rev[r][c]=true;
  if(this.board[r][c]===-1){this.over=true;for(let rr=0;rr<this.RR;rr++)for(let cc=0;cc<this.CC;cc++)if(this.board[rr][cc]===-1)this.rev[rr][cc]=true;say("BOOM! Diddy: told you not to click there.");this.render();return;}
  if(this.board[r][c]===0)this.nb(r,c).forEach(([nr,nc])=>this.reveal(nr,nc));
  if(this.rev.flat().filter(Boolean).length>=this.RR*this.CC-this.M){this.over=true;say("Board cleared! Diddy impressed.");}
  this.render();
},
render(){
  const g=document.getElementById("mine-g");if(!g)return;g.innerHTML="";
  const NC=["","#4488ff","#00aa44","#ff4444","#220088","#880000","#0088aa","#000","#888"];
  for(let r=0;r<this.RR;r++)for(let c=0;c<this.CC;c++){const d=document.createElement("div");d.className="mcl";if(this.rev[r][c]){d.classList.add("op");const v=this.board[r][c];d.textContent=v===-1?"üí•":v?v:"";d.style.color=NC[v]||"#fff";}else if(this.flag[r][c])d.textContent="üö©";d.onclick=()=>this.reveal(r,c);d.oncontextmenu=e=>{e.preventDefault();if(!this.rev[r][c]&&!this.over){this.flag[r][c]=!this.flag[r][c];this.flags+=this.flag[r][c]?1:-1;say("Mines: "+(this.M-this.flags)+" remaining");this.render();}};g.appendChild(d);}
},hint(){say("Start corners. Right-click flags mines!");}};
// ‚îÄ‚îÄ BLACKJACK ‚îÄ‚îÄ
IMPL.blackjack={
init(){this.deck=this.nd();this.p=[];this.d=[];this.chips=200;this.bet=20;this.phase="play";const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.style.gap="6px";w.innerHTML='<div class="msg" id="bj-m">Deal and play!</div><div style="width:100%;max-width:400px;"><div style="font-size:.56rem;color:var(--dm);margin-bottom:4px">DEALER</div><div style="display:flex;flex-wrap:wrap;gap:5px;min-height:70px;" id="bj-d"></div><div style="font-size:.56rem;color:var(--dm);margin:7px 0 4px">YOU</div><div style="display:flex;flex-wrap:wrap;gap:5px;min-height:70px;" id="bj-p"></div></div><div style="display:flex;gap:6px;flex-wrap:wrap;justify-content:center;" id="bj-b"></div>';mg.appendChild(w);this.deal();},
nd(){const s="SHDC",v="A23456789TJQK",d=[];for(const ss of s)for(const vv of v)d.push({v:vv,s:ss});return d.sort(()=>Math.random()-.5);},
draw(){return this.deck.pop()||(this.deck=this.nd(),this.deck.pop());},
val(h){let t=0,a=0;h.forEach(c=>{const v=c.v;if("TJQK".includes(v))t+=10;else if(v==="A"){t+=11;a++;}else t+=+v;});while(t>21&&a){t-=10;a--;}return t;},
deal(){this.p=[this.draw(),this.draw()];this.d=[this.draw(),this.draw()];this.phase="play";this.rBJ();const pv=this.val(this.p);if(pv===21)this.stand();else{say("Total: "+pv+" ‚Äî Hit or Stand?");this.rBtns();}},
rBJ(){const su={S:"‚ô†",H:"‚ô•",D:"‚ô¶",C:"‚ô£"};const rd=c=>"HD".includes(c.s);const mk=c=>'<div class="crd" style="font-size:.82rem;flex-direction:column;line-height:1.3;"><span style="color:'+(rd(c)?"#ff4488":"#c0c8e8")+'">'+c.v+'</span><span style="font-size:.65rem;color:'+(rd(c)?"#ff4488":"#888")+'">'+su[c.s]+'</span></div>';const hd='<div class="crd" style="background:#112233;">üÇ†</div>';document.getElementById("bj-d").innerHTML=this.d.map((c,i)=>i>0&&this.phase==="play"?hd:mk(c)).join("");document.getElementById("bj-p").innerHTML=this.p.map(c=>mk(c)).join("");sHUD("Chips: "+this.chips,"Bet: "+this.bet);},
rBtns(){const b=document.getElementById("bj-b");if(!b)return;if(this.phase==="play")b.innerHTML='<button class="mb p" onclick="IMPL.blackjack.hit()">Hit</button><button class="mb" onclick="IMPL.blackjack.stand()">Stand</button><button class="mb" onclick="IMPL.blackjack.dbl()">Double</button>';else b.innerHTML='<button class="mb p" onclick="IMPL.blackjack.deal()">New Hand</button><button class="mb" onclick="IMPL.blackjack.bet=Math.min(IMPL.blackjack.chips,IMPL.blackjack.bet+10);IMPL.blackjack.rBJ()">Bet+10</button><button class="mb" onclick="IMPL.blackjack.bet=Math.max(10,IMPL.blackjack.bet-10);IMPL.blackjack.rBJ()">Bet-10</button>';},
hit(){this.p.push(this.draw());const v=this.val(this.p);this.rBJ();if(v>21){this.chips-=this.bet;this.phase="done";say("Bust! -"+this.bet+" ("+this.chips+" left)");this.rBtns();}else say("Total: "+v);},
stand(){this.phase="done";while(this.val(this.d)<17)this.d.push(this.draw());const pv=this.val(this.p),dv=this.val(this.d);this.rBJ();let msg;if(dv>21||pv>dv){this.chips+=this.bet;msg="Win! +"+this.bet;}else if(pv===dv)msg="Push";else{this.chips-=this.bet;msg="Dealer wins. -"+this.bet+" ("+this.chips+" left)";}say(msg);this.rBtns();},
dbl(){if(this.chips>=this.bet*2){this.bet*=2;this.hit();if(this.phase!=="done")this.stand();}else say("Not enough chips!");},
hint(){say("Hit ‚â§11, stand ‚â•17. Double on 10-11 vs dealer 2-9.");}};

// ‚îÄ‚îÄ MEMORY MATCH ‚îÄ‚îÄ
IMPL.memory={EM:["üéÆ","üé≤","üèÜ","‚≠ê","üéØ","üé™","üé®","üöÄ"],
init(){
  this.cards=[...this.EM,...this.EM].sort(()=>Math.random()-.5).map((e,i)=>({e,i,flip:false,done:false}));
  this.sel=[];this.pS=0;this.aS=0;this.turn="p";this.lock=false;this.mem={};
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const w=document.createElement("div");w.className="gw";
  w.innerHTML='<div class="msg" id="mem-m">Find pairs! You go first.</div><div id="mem-g" style="display:grid;grid-template-columns:repeat(4,58px);gap:7px;"></div>';
  mg.appendChild(w);this.render();
},
render(){const g=document.getElementById("mem-g");if(!g)return;g.innerHTML="";this.cards.forEach((card,i)=>{const d=document.createElement("div");d.className="crd"+(card.flip||card.done?" flip":"");d.style.cssText="width:58px;height:70px;font-size:1.6rem;";d.textContent=card.flip||card.done?card.e:"";if(!card.done&&!card.flip&&this.turn==="p"&&!this.lock)d.onclick=()=>this.flip(i);g.appendChild(d);});sHUD(this.pS,this.aS+" Diddy");},
flip(i){if(this.lock||this.cards[i].done||this.cards[i].flip)return;this.mem[i]=this.cards[i].e;this.cards[i].flip=true;this.sel.push(i);this.render();if(this.sel.length===2){this.lock=true;setTimeout(()=>this.chk(),650);}},
chk(){const [a,b]=this.sel;if(this.cards[a].e===this.cards[b].e){this.cards[a].done=this.cards[b].done=true;this.pS++;this.sel=[];this.lock=false;if(this.cards.every(c=>c.done))say(this.pS>this.aS?"You win!":this.aS>this.pS?"Diddy wins!":"Draw!");else{say("Match! Go again.");this.render();}}else{this.cards[a].flip=this.cards[b].flip=false;this.sel=[];this.turn="ai";this.lock=false;say("Miss ‚Äî Diddy's turn‚Ä¶");this.render();setTimeout(()=>this.aiT(),700);}},
aiT(){const avail=this.cards.map((c,i)=>!c.done?i:null).filter(i=>i!=null);let pair=null;const mem=Object.entries(this.mem);for(let i=0;i<mem.length&&!pair;i++)for(let j=i+1;j<mem.length&&!pair;j++){if(mem[i][1]===mem[j][1]&&!this.cards[+mem[i][0]].done&&!this.cards[+mem[j][0]].done)pair=[+mem[i][0],+mem[j][0]];}if(!pair){let r1=avail[Math.floor(Math.random()*avail.length)],r2=avail[Math.floor(Math.random()*avail.length)];while(r2===r1&&avail.length>1)r2=avail[Math.floor(Math.random()*avail.length)];pair=[r1,r2];}const [a,b]=pair;this.cards[a].flip=true;this.mem[a]=this.cards[a].e;this.render();setTimeout(()=>{this.cards[b].flip=true;this.mem[b]=this.cards[b].e;this.render();setTimeout(()=>{if(this.cards[a].e===this.cards[b].e){this.cards[a].done=this.cards[b].done=true;this.aS++;if(this.cards.every(c=>c.done))say(this.pS>this.aS?"You win!":this.aS>this.pS?"Diddy wins!":"Draw!");else setTimeout(()=>this.aiT(),400);}else{this.cards[a].flip=this.cards[b].flip=false;this.turn="p";say("Diddy missed! Your turn.");}this.render();},700);},650);},
hint(){say("Diddy memorizes every card it sees. Match fast!");}};

// ‚îÄ‚îÄ ROCK PAPER SCISSORS ‚îÄ‚îÄ
IMPL.rps={pS:0,aS:0,hist:[],
init(){this.pS=0;this.aS=0;this.hist=[];const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="rps-m">Choose your weapon!</div><div id="rps-d" style="font-size:2.8rem;display:flex;gap:18px;justify-content:center;min-height:52px;align-items:center;"></div><div style="display:flex;gap:10px;margin-top:6px;"><button class="mb" style="font-size:1.7rem;padding:10px 16px;" onclick="IMPL.rps.play(0)">‚úä</button><button class="mb" style="font-size:1.7rem;padding:10px 16px;" onclick="IMPL.rps.play(1)">‚úã</button><button class="mb" style="font-size:1.7rem;padding:10px 16px;" onclick="IMPL.rps.play(2)">‚úå</button></div><div style="font-size:.54rem;color:var(--dm);margin-top:5px">‚úä beats ‚úå ¬∑ ‚úã beats ‚úä ¬∑ ‚úå beats ‚úã</div>';mg.appendChild(w);sHUD(0,0);},
play(p){const I=["‚úä","‚úã","‚úå"];this.hist.push(p);const freq=[0,0,0];this.hist.slice(-8).forEach(h=>freq[h]++);const mx=freq.indexOf(Math.max(...freq));let ai=(mx+1)%3;if(this.hist.length<3||Math.random()<0.25)ai=Math.floor(Math.random()*3);document.getElementById("rps-d").innerHTML=I[p]+'<span style="font-size:.9rem;color:var(--dm)">vs</span>'+I[ai];let msg;if(p===ai)msg="Draw!";else if((p-ai+3)%3===1){this.pS++;msg="You win!";}else{this.aS++;msg="Diddy wins!";}say(msg);sHUD(this.pS,this.aS);},
hint(){say("Diddy tracks your patterns. Be random!");}};

// ‚îÄ‚îÄ SIMON SAYS ‚îÄ‚îÄ
IMPL.simon={seq:[],pl:[],lvl:0,active:false,COLS:["#ff4444","#44cc44","#ffcc00","#4488ff"],
init(){this.seq=[];this.pl=[];this.lvl=0;this.active=false;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="si-m">Watch then repeat!</div><div class="sg">'+"0123".split("").map(i=>'<button class="sb" id="sb'+i+'" style="background:'+this.COLS[i]+';opacity:.35;" onclick="IMPL.simon.press('+i+')"></button>').join("")+'</div><div style="font-size:.56rem;color:var(--dm);margin-top:4px">Level: <span id="si-l">0</span></div>';mg.appendChild(w);setTimeout(()=>this.next(),700);},
next(){this.seq.push(Math.floor(Math.random()*4));this.lvl=this.seq.length;this.pl=[];this.active=false;document.getElementById("si-l").textContent=this.lvl;say("Level "+this.lvl+" ‚Äî Watch!");let i=0;const show=()=>{if(i<this.seq.length){this.flash(this.seq[i++]);setTimeout(show,650);}else{this.active=true;say("Repeat!")}};setTimeout(show,500);},
flash(idx){const el=document.getElementById("sb"+idx);if(!el)return;el.style.opacity="1";setTimeout(()=>el.style.opacity=".35",320);},
press(idx){if(!this.active)return;this.flash(idx);this.pl.push(idx);const pos=this.pl.length-1;if(this.pl[pos]!==this.seq[pos]){say("Wrong! Game over at level "+this.lvl);this.active=false;sHUD(this.lvl,"laughing");return;}if(this.pl.length===this.seq.length){this.active=false;say("Correct! Diddy adds‚Ä¶");sHUD(this.lvl,"-");setTimeout(()=>this.next(),900);}},
hint(){say("Hum the pattern. Short = high pitch, long = melody!");}};
// ‚îÄ‚îÄ HANGMAN ‚îÄ‚îÄ
IMPL.hangman={WDS:["JAVASCRIPT","PYTHON","ALGORITHM","BLOCKCHAIN","METAVERSE","QUANTUM","DEVELOPER","DATABASE","PROTOCOL","ENCRYPTION","RECURSION","VARIABLE","FUNCTION","GRADIENT","RESONANCE"],
init(){this.word=this.WDS[Math.floor(Math.random()*this.WDS.length)];this.guessed=new Set();this.wrong=0;this.max=6;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<canvas id="hc" width="160" height="160" style="background:#000;border:1px solid #1a2030;border-radius:4px;"></canvas><div id="hw" style="font-size:1.3rem;letter-spacing:.28em;color:var(--acc);margin:5px 0;"></div><div class="msg" id="hm"></div><div class="hw" id="hk"></div>';mg.appendChild(w);this.render();},
render(){const w=document.getElementById("hw");if(!w)return;w.textContent=[...this.word].map(c=>this.guessed.has(c)?c:"_").join(" ");const lk=document.getElementById("hk");lk.innerHTML="";"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(l=>{const b=document.createElement("button");b.className="hb";b.textContent=l;if(this.guessed.has(l))b.disabled=true;b.onclick=()=>this.guess(l);lk.appendChild(b);});this.draw();const won=[...this.word].every(c=>this.guessed.has(c));if(won)say("You got it! Word: "+this.word);else if(this.wrong>=this.max)say("Hanged! Word was: "+this.word);else say(this.wrong+"/"+this.max+" wrong");},
guess(l){this.guessed.add(l);if(!this.word.includes(l))this.wrong++;this.render();},
draw(){const c=document.getElementById("hc");if(!c)return;const ctx=c.getContext("2d");ctx.clearRect(0,0,160,160);ctx.strokeStyle="#00ff88";ctx.lineWidth=2;ctx.lineCap="round";ctx.beginPath();ctx.moveTo(20,150);ctx.lineTo(140,150);ctx.moveTo(50,150);ctx.lineTo(50,20);ctx.lineTo(100,20);ctx.lineTo(100,38);ctx.stroke();const pts=[()=>{ctx.beginPath();ctx.arc(100,52,14,0,Math.PI*2);ctx.strokeStyle="#ff4488";ctx.stroke();},()=>{ctx.beginPath();ctx.moveTo(100,66);ctx.lineTo(100,108);ctx.stroke();},()=>{ctx.beginPath();ctx.moveTo(100,76);ctx.lineTo(82,98);ctx.stroke();},()=>{ctx.beginPath();ctx.moveTo(100,76);ctx.lineTo(118,98);ctx.stroke();},()=>{ctx.beginPath();ctx.moveTo(100,108);ctx.lineTo(82,134);ctx.stroke();},()=>{ctx.beginPath();ctx.moveTo(100,108);ctx.lineTo(118,134);ctx.stroke();}];for(let i=0;i<this.wrong;i++)if(pts[i])pts[i]();},
hint(){const u=[...new Set([...this.word].filter(c=>!this.guessed.has(c)))];say("Try: "+u.slice(0,2).join(", ")+" ‚Äî vowels first!");}};

// ‚îÄ‚îÄ 2048 ‚îÄ‚îÄ
IMPL.g2048={
init(){this.grid=Array(4).fill(null).map(()=>Array(4).fill(0));this.score=0;this.add();this.add();const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="g48-m">Arrow keys to slide!</div><div class="g48" id="g48-g"></div>';mg.appendChild(w);document.onkeydown=e=>{const m={ArrowLeft:"L",ArrowRight:"R",ArrowUp:"U",ArrowDown:"D"};if(m[e.key]){e.preventDefault();this.move(m[e.key]);}};this.render();},
add(){const e=[];for(let r=0;r<4;r++)for(let c=0;c<4;c++)if(!this.grid[r][c])e.push([r,c]);if(e.length){const[r,c]=e[Math.floor(Math.random()*e.length)];this.grid[r][c]=Math.random()<.9?2:4;}},
rot(){this.grid=this.grid[0].map((_,i)=>this.grid.map(r=>r[i]).reverse());},
move(dir){const prev=JSON.stringify(this.grid);if(dir==="U")this.rot(),this.rot(),this.rot();else if(dir==="L")this.rot(),this.rot();else if(dir==="D")this.rot();for(let r=0;r<4;r++){let row=this.grid[r].filter(x=>x);for(let i=0;i<row.length-1;i++)if(row[i]===row[i+1]){row[i]*=2;this.score+=row[i];row.splice(i+1,1);}while(row.length<4)row.push(0);this.grid[r]=row;}if(dir==="U")this.rot();else if(dir==="L")this.rot(),this.rot();else if(dir==="D")this.rot(),this.rot(),this.rot();if(JSON.stringify(this.grid)!==prev){this.add();this.render();}if(this.grid.flat().includes(2048))say("YOU REACHED 2048!");},
render(){const g=document.getElementById("g48-g");if(!g)return;g.innerHTML="";const BG={0:"#1a2030",2:"#2a3a50",4:"#3a5070",8:"#4a6080",16:"#4488aa",32:"#44aacc",64:"#00ccee",128:"#ffcc44",256:"#ffaa22",512:"#ff8800",1024:"#ff6600",2048:"#ff2200"};this.grid.forEach(row=>row.forEach(v=>{const d=document.createElement("div");d.className="t2";d.style.background=BG[v]||"#cc1100";d.style.color=v<8?"#4a6090":"#fff";d.textContent=v||"";g.appendChild(d);}));sHUD(this.score,"grading you");},
hint(){say("Keep biggest tile in a corner. Build a chain!");}};

// ‚îÄ‚îÄ TETRIS ‚îÄ‚îÄ
IMPL.tetris={C:10,R:20,BS:21,PS:[[[1,1,1,1]],[[1,1],[1,1]],[[0,1,0],[1,1,1]],[[1,0],[1,0],[1,1]],[[0,1],[0,1],[1,1]],[[0,1,1],[1,1,0]],[[1,1,0],[0,1,1]]],CL:["#00ffee","#ffcc00","#aa44ff","#ff8800","#4488ff","#ff4488","#44ff88"],
cleanup(){clearInterval(this.iv);},
init(){
  this.grid=Array(20).fill(null).map(()=>Array(10).fill(0));this.score=0;this.over=false;this.cur=null;this.nxt=null;
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const wrap=document.createElement("div");wrap.style.cssText="display:flex;gap:10px;align-items:flex-start;justify-content:center;";
  const c=mkC(this.C*this.BS,this.R*this.BS);c.id="tc";
  const side=document.createElement("div");side.innerHTML='<div style="font-size:.52rem;color:var(--dm);margin-bottom:3px">NEXT</div><canvas id="tn" width="76" height="76" style="background:#0a1020;border:1px solid #1a2030;border-radius:3px;display:block;"></canvas><div style="margin-top:8px;font-size:.52rem;color:var(--dm)">SCORE</div><div id="ts" style="font-size:.9rem;color:var(--acc);font-weight:700;">0</div><div style="margin-top:8px;font-size:.5rem;color:var(--dm)">‚Üê‚Üí move<br>‚Üë rotate<br>‚Üì fall<br>SPC drop</div>';
  wrap.appendChild(c);wrap.appendChild(side);const gw=document.createElement("div");gw.className="gw";gw.appendChild(wrap);mg.appendChild(gw);
  this.newP();
  document.onkeydown=e=>{if(e.key==="ArrowLeft")this.mv(-1,0);else if(e.key==="ArrowRight")this.mv(1,0);else if(e.key==="ArrowDown")this.mv(0,1);else if(e.key==="ArrowUp")this.rot2();else if(e.key===" "){e.preventDefault();this.drop();}};
  clearInterval(this.iv);this.iv=setInterval(()=>{if(!this.mv(0,1))this.lock();},480);
  this.draw();
},
newP(){const i=Math.floor(Math.random()*7);this.cur=this.nxt?{shape:this.nxt.shape,x:3,y:0,col:this.nxt.col}:{shape:this.PS[i].map(r=>[...r]),x:3,y:0,col:this.CL[i]};const ni=Math.floor(Math.random()*7);this.nxt={shape:this.PS[ni].map(r=>[...r]),col:this.CL[ni]};if(!this.ok(this.cur.shape,this.cur.x,this.cur.y))this.over=true;},
ok(s,ox,oy){return s.every((row,r)=>row.every((v,c)=>!v||((ox+c)>=0&&(ox+c)<this.C&&(oy+r)<this.R&&!this.grid[oy+r]?.[ox+c])));},
mv(dx,dy){if(this.over)return false;if(this.ok(this.cur.shape,this.cur.x+dx,this.cur.y+dy)){this.cur.x+=dx;this.cur.y+=dy;this.draw();return true;}return false;},
rot2(){const s=this.cur.shape[0].map((_,i)=>this.cur.shape.map(r=>r[i]).reverse());if(this.ok(s,this.cur.x,this.cur.y)){this.cur.shape=s;this.draw();}},
drop(){while(this.mv(0,1));this.lock();},
lock(){
  this.cur.shape.forEach((row,r)=>row.forEach((v,c)=>{if(v&&this.grid[this.cur.y+r])this.grid[this.cur.y+r][this.cur.x+c]=this.cur.col;}));
  let lines=0;for(let r=this.R-1;r>=0;r--){if(this.grid[r].every(c=>c)){this.grid.splice(r,1);this.grid.unshift(Array(this.C).fill(0));lines++;r++;}}
  this.score+=[0,100,300,500,800][lines]||0;document.getElementById("ts").textContent=this.score;
  sHUD(this.score,lines?["Line!","Double!","Triple!","TETRIS!"][lines-1]:"stack it");
  if(!this.over)this.newP();this.draw();
},
draw(){
  const c=document.getElementById("tc");if(!c)return;const ctx=c.getContext("2d");const W=this.C*this.BS,H=this.R*this.BS;
  ctx.fillStyle="#000";ctx.fillRect(0,0,W,H);
  this.grid.forEach((row,r)=>row.forEach((col,c2)=>{if(col){ctx.fillStyle=col;ctx.fillRect(c2*this.BS+1,r*this.BS+1,this.BS-2,this.BS-2);}}));
  let gy=this.cur.y;while(this.ok(this.cur.shape,this.cur.x,gy+1))gy++;
  this.cur.shape.forEach((row,r)=>row.forEach((v,c2)=>{if(v){ctx.fillStyle=this.cur.col+"44";ctx.fillRect((this.cur.x+c2)*this.BS+1,(gy+r)*this.BS+1,this.BS-2,this.BS-2);};}));
  this.cur.shape.forEach((row,r)=>row.forEach((v,c2)=>{if(v){ctx.fillStyle=this.cur.col;ctx.fillRect((this.cur.x+c2)*this.BS+1,(this.cur.y+r)*this.BS+1,this.BS-2,this.BS-2);};}));
  if(this.over){ctx.fillStyle="rgba(0,0,0,.8)";ctx.fillRect(0,0,W,H);ctx.fillStyle="#ff4488";ctx.font="bold 16px monospace";ctx.textAlign="center";ctx.fillText("GAME OVER",W/2,H/2);}
  const nc=document.getElementById("tn");if(!nc)return;const nx=nc.getContext("2d");nx.fillStyle="#0a1020";nx.fillRect(0,0,76,76);if(this.nxt)this.nxt.shape.forEach((row,r)=>row.forEach((v,c2)=>{if(v){nx.fillStyle=this.nxt.col;nx.fillRect(c2*17+13,r*17+13,15,15);}}));
},hint(){say("Space to drop. Fill complete rows ‚Äî partial = no points!");}};
// ‚îÄ‚îÄ REVERSI ‚îÄ‚îÄ
IMPL.reversi={
init(){this.g=Array(8).fill(null).map(()=>Array(8).fill(0));this.g[3][3]=1;this.g[4][4]=1;this.g[3][4]=2;this.g[4][3]=2;this.over=false;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="rv-m">You are White ‚ö™ ‚Äî click valid squares</div><div class="brd" id="rv-b" style="grid-template-columns:repeat(8,40px);grid-template-rows:repeat(8,40px);background:#004400;gap:2px;padding:4px;border-radius:8px;"></div>';mg.appendChild(w);this.render();},
dirs(){return[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];},
valid(r,c,p){if(this.g[r][c])return false;return this.dirs().some(([dr,dc])=>{let nr=r+dr,nc=c+dc,f=false;while(nr>=0&&nr<8&&nc>=0&&nc<8&&this.g[nr][nc]===3-p){nr+=dr;nc+=dc;f=true;}return f&&nr>=0&&nr<8&&nc>=0&&nc<8&&this.g[nr][nc]===p;});},
place(r,c,p){if(!this.valid(r,c,p))return false;this.g[r][c]=p;this.dirs().forEach(([dr,dc])=>{let nr=r+dr,nc=c+dc,fl=[];while(nr>=0&&nr<8&&nc>=0&&nc<8&&this.g[nr][nc]===3-p){fl.push([nr,nc]);nr+=dr;nc+=dc;}if(nr>=0&&nr<8&&nc>=0&&nc<8&&this.g[nr][nc]===p)fl.forEach(([fr,fc])=>this.g[fr][fc]=p);});return true;},
moves(p){const m=[];for(let r=0;r<8;r++)for(let c=0;c<8;c++)if(this.valid(r,c,p))m.push([r,c]);return m;},
aiMove(){const W=[[100,-20,10,5,5,10,-20,100],[-20,-50,-2,-2,-2,-2,-50,-20],[10,-2,5,1,1,5,-2,10],[5,-2,1,1,1,1,-2,5],[5,-2,1,1,1,1,-2,5],[10,-2,5,1,1,5,-2,10],[-20,-50,-2,-2,-2,-2,-50,-20],[100,-20,10,5,5,10,-20,100]];const ms=this.moves(1);if(!ms.length)return;const best=ms.sort((a,b)=>W[b[0]][b[1]]-W[a[0]][a[1]])[0];this.place(best[0],best[1],1);},
render(){const b=document.getElementById("rv-b");if(!b)return;b.innerHTML="";const mv=this.moves(2);for(let r=0;r<8;r++)for(let c=0;c<8;c++){const d=document.createElement("div");d.className="cl";d.style.cssText="width:40px;height:40px;border-radius:50%;transition:background .1s;";const v=this.g[r][c];d.style.background=v===1?"#1a1a1a":v===2?"#e8e8e8":mv.some(([mr,mc])=>mr===r&&mc===c)?"#005500":"#003300";d.onclick=()=>this.play(r,c);b.appendChild(d);}const p1=this.g.flat().filter(v=>v===1).length,p2=this.g.flat().filter(v=>v===2).length;sHUD("‚ö™ "+p2,"‚ö´ "+p1+" Diddy");},
play(r,c){if(this.over||!this.valid(r,c,2))return;this.place(r,c,2);this.render();if(!this.moves(1).length){if(!this.moves(2).length)this.end();else say("Diddy has no moves ‚Äî your turn!");return;}say("Diddy thinking‚Ä¶");setTimeout(()=>{this.aiMove();this.render();if(!this.moves(2).length){if(!this.moves(1).length)this.end();else say("No moves ‚Äî Diddy goes again!");}else say("Your turn ‚ö™");},600);},
end(){const p1=this.g.flat().filter(v=>v===1).length,p2=this.g.flat().filter(v=>v===2).length;this.over=true;say(p2>p1?"You win! "+p2+"-"+p1:p1>p2?"Diddy wins! "+p1+"-"+p2:"Draw!");},
hint(){say("Corners are king. Avoid giving Diddy access to them!");}};

// ‚îÄ‚îÄ FLAPPY BIRD ‚îÄ‚îÄ
IMPL.flappy={raf:null,cleanup(){cancelAnimationFrame(this.raf);},
init(){const mg=document.getElementById("mgame");mg.innerHTML="";const W=320,H=440,c=mkC(W,H);mg.appendChild(c);const ctx=c.getContext("2d");let by=H/2,bvy=0,pipes=[],score=0,alive=true,started=false,fr=0;const jump=()=>{if(!started)started=true;if(alive)bvy=-7;else{by=H/2;bvy=0;pipes=[];score=0;alive=true;started=false;say("");}};c.onclick=jump;document.onkeydown=e=>{if(e.key===" "||e.key==="ArrowUp"){e.preventDefault();jump();}};const bx=W/3;const loop=()=>{fr++;ctx.fillStyle="#001828";ctx.fillRect(0,0,W,H);ctx.fillStyle="#112233";ctx.fillRect(0,H-36,W,36);if(!started){ctx.fillStyle="#00ff88";ctx.font="12px monospace";ctx.textAlign="center";ctx.fillText("TAP or SPACE",W/2,H/2-44);ctx.font="20px serif";ctx.fillText("üê¶",bx-9,H/2+6);this.raf=requestAnimationFrame(loop);return;}if(fr%82===0)pipes.push({x:W,top:55+Math.random()*(H-155),sc:false});pipes.forEach(p=>p.x-=2.2);pipes=pipes.filter(p=>p.x>-44);bvy+=0.42;by+=bvy;if(by<0||by>H-36)alive=false;pipes.forEach(p=>{if(Math.abs(bx-(p.x+21))<31&&(by<p.top||by>p.top+120-14))alive=false;if(!p.sc&&p.x<bx){p.sc=true;score++;sHUD(score,"watching");}});pipes.forEach(p=>{ctx.fillStyle="#1a4422";ctx.fillRect(p.x,0,42,p.top);ctx.fillRect(p.x,p.top+120,42,H);ctx.fillStyle="#2a6633";ctx.fillRect(p.x-3,p.top-12,48,12);ctx.fillRect(p.x-3,p.top+120,48,12);});ctx.fillStyle=alive?"#ff4488":"#884422";ctx.font="18px serif";ctx.textAlign="left";ctx.fillText("üê¶",bx-9,by+7);ctx.fillStyle="#fff";ctx.font="bold 18px monospace";ctx.textAlign="center";ctx.fillText(""+score,W/2,24);if(!alive){ctx.fillStyle="#ff448866";ctx.fillRect(0,0,W,H);ctx.fillStyle="#ff4488";ctx.font="bold 14px monospace";ctx.fillText("DEAD ‚Äî tap to retry",W/2,H/2);}this.raf=requestAnimationFrame(loop);};loop();},hint(){say("Tap gently and often. Stay mid-gap!");}};

// ‚îÄ‚îÄ WHACK-A-MOLE ‚îÄ‚îÄ
IMPL.whack={cleanup(){clearInterval(this.iv);clearInterval(this.tm);},
init(){this.holes=Array(9).fill(false);this.score=0;this.aS=0;this.time=30;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="wk-m">Whack moles! Diddy steals ones you miss!</div><div id="wk-g" style="display:grid;grid-template-columns:repeat(3,86px);gap:9px;"></div>';mg.appendChild(w);clearInterval(this.iv);this.iv=setInterval(()=>{const act=this.holes.map((v,i)=>v?i:null).filter(i=>i!=null);if(act.length&&Math.random()<0.35){const i=act[Math.floor(Math.random()*act.length)];this.holes[i]=false;this.aS++;this.render();}const idx=Math.floor(Math.random()*9);this.holes[idx]=true;setTimeout(()=>{if(this.holes[idx]){this.holes[idx]=false;this.render();}},850);this.render();},780);clearInterval(this.tm);this.tm=setInterval(()=>{this.time--;if(this.time<=0){clearInterval(this.iv);clearInterval(this.tm);say("Time up! You: "+this.score+" Diddy: "+this.aS);}else this.render();},1000);this.render();},
hit(i){if(!this.holes[i])return;this.holes[i]=false;this.score++;this.render();},
render(){const g=document.getElementById("wk-g");if(!g)return;g.innerHTML="";this.holes.forEach((up,i)=>{const d=document.createElement("div");d.style.cssText="width:86px;height:86px;background:"+(up?"#1a3a10":"#0a1a08")+";border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:2rem;cursor:pointer;border:2px solid #1a3020;transition:background .1s;";d.textContent=up?"ü¶î":"";d.onclick=()=>this.hit(i);g.appendChild(d);});say("‚è± "+this.time+"s  You: "+this.score+"  Diddy: "+this.aS);},
hint(){say("Watch the edges. Diddy steals any mole up 0.85s!");}};

// ‚îÄ‚îÄ SLOTS ‚îÄ‚îÄ
IMPL.slots={SY:["üçí","üçã","üçä","üçá","‚≠ê","üíé","7Ô∏è‚É£"],
init(){this.credits=100;this.bet=10;this.spinning=false;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="sl-m">Spin to win!</div><div class="slr"><div class="reel" id="r0">üçí</div><div class="reel" id="r1">üçã</div><div class="reel" id="r2">üçä</div></div><div style="margin-top:8px;display:flex;gap:6px;flex-wrap:wrap;justify-content:center;"><button class="mb p" onclick="IMPL.slots.spin()">üé∞ SPIN</button><button class="mb" onclick="IMPL.slots.bet=Math.min(50,IMPL.slots.bet+10);IMPL.slots.upd()">BET+</button><button class="mb" onclick="IMPL.slots.bet=Math.max(5,IMPL.slots.bet-5);IMPL.slots.upd()">BET-</button></div><div style="font-size:.52rem;color:var(--dm);margin-top:6px;text-align:center">üíéüíéüíé=50x ¬∑ ‚≠ê‚≠ê‚≠ê=20x ¬∑ 7Ô∏è‚É£7Ô∏è‚É£7Ô∏è‚É£=10x ¬∑ pair=2x</div>';mg.appendChild(w);this.upd();},
spin(){if(this.spinning||this.credits<this.bet)return;this.credits-=this.bet;this.spinning=true;this.upd();let i=0;const iv=setInterval(()=>{[0,1,2].forEach(r=>document.getElementById("r"+r).textContent=this.SY[Math.floor(Math.random()*this.SY.length)]);if(++i>14){clearInterval(iv);this.spinning=false;this.result();}},75);},
result(){const v=[0,1,2].map(r=>document.getElementById("r"+r).textContent);const PAY={"üíé":50,"‚≠ê":20,"7Ô∏è‚É£":10};let win=0;if(v[0]===v[1]&&v[1]===v[2])win=this.bet*(PAY[v[0]]||5);else if(v[0]===v[1]||v[1]===v[2]||v[0]===v[2])win=this.bet*2;this.credits+=win;say(win?"WIN! +"+win+" credits":"No match‚Ä¶");this.upd();},
upd(){sHUD("Credits: "+this.credits,"Bet: "+this.bet);},
hint(){say("üíéüíéüíé = 50x your bet. Bet small to last longer!");}};
// ‚îÄ‚îÄ BATTLESHIP ‚îÄ‚îÄ
IMPL.battleship={SZ:8,SH:[4,3,3,2,2],
init(){this.pg=this.mkG();this.ag=this.mkG();this.ps=this.placeS(this.pg);this.as=this.placeS(this.ag);this.ph=[];this.ah=[];this.over=false;this.aiQ=[];const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="bs-m">Fire on the enemy grid!</div><div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center;"><div><div style="font-size:.54rem;color:var(--dm);margin-bottom:3px">ENEMY</div><div id="bs-e" style="display:inline-grid;grid-template-columns:repeat(8,26px);gap:1px;background:#0a1020;padding:3px;"></div></div><div><div style="font-size:.54rem;color:var(--dm);margin-bottom:3px">YOUR FLEET</div><div id="bs-y" style="display:inline-grid;grid-template-columns:repeat(8,26px);gap:1px;background:#0a1020;padding:3px;"></div></div></div>';mg.appendChild(w);this.render();},
mkG(){return Array(this.SZ).fill(null).map(()=>Array(this.SZ).fill(0));},
placeS(g){const ships=[];this.SH.forEach(len=>{let ok=false;while(!ok){const h=Math.random()<.5,r=Math.floor(Math.random()*this.SZ),c=Math.floor(Math.random()*this.SZ);const cells=[];for(let i=0;i<len;i++){const nr=r+(h?0:i),nc=c+(h?i:0);if(nr>=this.SZ||nc>=this.SZ||g[nr][nc])break;cells.push([nr,nc]);}if(cells.length===len){cells.forEach(([r,c])=>g[r][c]=1);ships.push(cells);ok=true;}}});return ships;},
fire(r,c,hits){if(hits.some(h=>h[0]===r&&h[1]===c))return false;hits.push([r,c]);return true;},
hit(r,c,g){return g[r][c]===1;},
render(){const re=document.getElementById("bs-e"),ry=document.getElementById("bs-y");if(!re)return;re.innerHTML="";ry.innerHTML="";for(let r=0;r<this.SZ;r++)for(let c=0;c<this.SZ;c++){const eh=this.ah.find(h=>h[0]===r&&h[1]===c);const ed=document.createElement("div");ed.style.cssText="width:26px;height:26px;background:"+(eh?(this.hit(r,c,this.ag)?"#662200":"#0a1a2a"):"#0a1a30")+";display:flex;align-items:center;justify-content:center;font-size:.7rem;cursor:pointer;border-radius:2px;";ed.textContent=eh?(this.hit(r,c,this.ag)?"üí•":"¬∑"):"";if(!this.over)ed.onclick=()=>this.pfire(r,c);re.appendChild(ed);const ph=this.ph.find(h=>h[0]===r&&h[1]===c);const pd=document.createElement("div");pd.style.cssText="width:26px;height:26px;background:"+(this.pg[r][c]?ph?"#882200":"#1a3a60":"#0a1a30")+";display:flex;align-items:center;justify-content:center;font-size:.7rem;border-radius:2px;";pd.textContent=ph?(this.hit(r,c,this.pg)?"üí•":"¬∑"):"";ry.appendChild(pd);}const ps=this.as.filter(s=>s.every(([r,c])=>this.ah.some(h=>h[0]===r&&h[1]===c))).length;const as=this.ps.filter(s=>s.every(([r,c])=>this.ph.some(h=>h[0]===r&&h[1]===c))).length;sHUD("Sunk: "+ps+"/"+this.SH.length,"Sunk: "+as+"/"+this.SH.length);},
pfire(r,c){if(!this.fire(r,c,this.ah)||this.over)return;const h=this.hit(r,c,this.ag);say(h?"üí• Hit!":"üíß Miss‚Ä¶");if(this.as.every(s=>s.every(([r,c])=>this.ah.some(h=>h[0]===r&&h[1]===c)))){this.over=true;say("You sunk Diddy's fleet!");this.render();return;}this.render();setTimeout(()=>this.afire(),650);},
afire(){let r,c;if(this.aiQ.length){[r,c]=this.aiQ.shift();while(this.ph.some(h=>h[0]===r&&h[1]===c)&&this.aiQ.length)[r,c]=this.aiQ.shift();}if(r===undefined||this.ph.some(h=>h[0]===r&&h[1]===c)){do{r=Math.floor(Math.random()*this.SZ);c=Math.floor(Math.random()*this.SZ);}while(this.ph.some(h=>h[0]===r&&h[1]===c));}this.ph.push([r,c]);if(this.hit(r,c,this.pg)){say("Diddy hit your ship!");[[r-1,c],[r+1,c],[r,c-1],[r,c+1]].forEach(([nr,nc])=>{if(nr>=0&&nr<this.SZ&&nc>=0&&nc<this.SZ&&!this.ph.some(h=>h[0]===nr&&h[1]===nc))this.aiQ.push([nr,nc]);});}else say("Diddy missed. Your turn!");if(this.ps.every(s=>s.every(([r,c])=>this.ph.some(h=>h[0]===r&&h[1]===c)))){this.over=true;say("Diddy sunk your fleet!");}this.render();},
hint(){say("Checkerboard pattern. After a hit, try adjacent cells!");}};

// ‚îÄ‚îÄ TRON LIGHT CYCLES ‚îÄ‚îÄ
IMPL.tron={raf:null,cleanup(){cancelAnimationFrame(this.raf);},
init(){const mg=document.getElementById("mgame");mg.innerHTML="";const W=400,H=300,c=mkC(W,H);mg.appendChild(c);const ctx=c.getContext("2d");const G=10;let p1={x:10,y:15,dx:1,dy:0},p2={x:30,y:15,dx:-1,dy:0},t1=new Set(),t2=new Set(),over=false,fr=0;const add=(s,p)=>s.add(p.x+","+p.y);const keys={};document.onkeydown=e=>keys[e.key]=1;document.onkeyup=e=>delete keys[e.key];const loop=()=>{fr++;if(!over){if(keys.ArrowUp&&p1.dy!==1){p1.dx=0;p1.dy=-1;}if(keys.ArrowDown&&p1.dy!==-1){p1.dx=0;p1.dy=1;}if(keys.ArrowLeft&&p1.dx!==1){p1.dx=-1;p1.dy=0;}if(keys.ArrowRight&&p1.dx!==-1){p1.dx=1;p1.dy=0;}add(t1,p1);p1.x+=p1.dx;p1.y+=p1.dy;// AI: simple pathfinding
const aheadX=p2.x+p2.dx,aheadY=p2.y+p2.dy;const aheadKey=aheadX+","+aheadY;if(t1.has(aheadKey)||t2.has(aheadKey)||aheadX<0||aheadX>=W/G||aheadY<0||aheadY>=H/G){const opts=[[0,-1],[0,1],[-1,0],[1,0]].filter(([dx,dy])=>dx!==p2.dx||dy!==p2.dy).filter(([dx,dy])=>{const nx=p2.x+dx,ny=p2.y+dy;return nx>=0&&nx<W/G&&ny>=0&&ny<H/G&&!t1.has(nx+","+ny)&&!t2.has(nx+","+ny);});if(opts.length){const [dx,dy]=opts[Math.floor(Math.random()*opts.length)];p2.dx=dx;p2.dy=dy;}}add(t2,p2);p2.x+=p2.dx;p2.y+=p2.dy;const p1k=p1.x+","+p1.y,p2k=p2.x+","+p2.y;const p1dead=t1.has(p1k)||t2.has(p1k)||p1.x<0||p1.x>=W/G||p1.y<0||p1.y>=H/G;const p2dead=t2.has(p2k)||t1.has(p2k)||p2.x<0||p2.x>=W/G||p2.y<0||p2.y>=H/G;if(p1dead||p2dead){over=true;say(p1dead&&p2dead?"Draw!":p1dead?"Diddy wins!":"You win!");}}ctx.fillStyle="#000";ctx.fillRect(0,0,W,H);t1.forEach(k=>{const[x,y]=k.split(",");ctx.fillStyle="#00ff88";ctx.fillRect(+x*G,+y*G,G-1,G-1);});t2.forEach(k=>{const[x,y]=k.split(",");ctx.fillStyle="#ff4488";ctx.fillRect(+x*G,+y*G,G-1,G-1);});ctx.fillStyle="#00ffaa";ctx.fillRect(p1.x*G,p1.y*G,G-1,G-1);ctx.fillStyle="#ff66aa";ctx.fillRect(p2.x*G,p2.y*G,G-1,G-1);if(!over)this.raf=requestAnimationFrame(loop);};loop();},hint(){say("Arrow keys. Leave a trail ‚Äî force Diddy to crash!");}};

// ‚îÄ‚îÄ CHECKERS ‚îÄ‚îÄ
IMPL.checkers={
init(){this.g=Array(8).fill(null).map(()=>Array(8).fill(0));for(let r=0;r<3;r++)for(let c=0;c<8;c++)if((r+c)%2===1)this.g[r][c]=2;for(let r=5;r<8;r++)for(let c=0;c<8;c++)if((r+c)%2===1)this.g[r][c]=1;this.sel=null;this.over=false;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="ck-m">You are Red ‚óè ‚Äî click piece then destination</div><div class="brd" id="ck-b" style="grid-template-columns:repeat(8,38px);grid-template-rows:repeat(8,38px);gap:0;padding:0;border-radius:0;"></div>';mg.appendChild(w);this.render();},
render(){const b=document.getElementById("ck-b");if(!b)return;b.innerHTML="";for(let r=0;r<8;r++)for(let c=0;c<8;c++){const d=document.createElement("div");d.className="cl";const dark=(r+c)%2===1;d.style.cssText="width:38px;height:38px;background:"+(dark?(this.sel&&this.sel[0]===r&&this.sel[1]===c?"#1a4a18":"#1a2a18"):"#2a3a28")+";font-size:1.2rem;";if(dark){const v=this.g[r][c];const isK=v>2;if(v)d.textContent=(v===1||v===3)?isK?"‚ôõ":"‚óè":isK?"‚ôö":"‚óã";d.style.color=(v===1||v===3)?"#ff4488":"#c0c8e8";}d.onclick=()=>this.click(r,c);b.appendChild(d);}sHUD(this.g.flat().filter(v=>v===1||v===3).length+" red",this.g.flat().filter(v=>v===2||v===4).length+" Diddy");},
click(r,c){if(this.over)return;if(this.sel){const[sr,sc]=this.sel;if(this.tryMove(sr,sc,r,c)){this.sel=null;if(!this.g.flat().some(v=>v===2||v===4)){this.over=true;say("You win!");}else{say("Diddy thinking‚Ä¶");setTimeout(()=>{this.aiMove();if(!this.g.flat().some(v=>v===1||v===3)){this.over=true;say("Diddy wins!");}else say("Your turn ‚óè");this.render();},500);}}else{this.sel=(this.g[r][c]===1||this.g[r][c]===3)?[r,c]:null;}}else{if(this.g[r][c]===1||this.g[r][c]===3)this.sel=[r,c];}this.render();},
tryMove(sr,sc,dr,dc){const p=this.g[sr][sc];if(!p||p===2||p===4)return false;const fwd=(p===1||p===3)?-1:1;const isK=p>2;const dr2=dr-sr,dc2=dc-sc;if(Math.abs(dr2)===1&&Math.abs(dc2)===1&&(isK||dr2===fwd)&&!this.g[dr][dc]){this.g[dr][dc]=p;this.g[sr][sc]=0;if((p===1&&dr===0)||(p===2&&dr===7))this.g[dr][dc]+=2;return true;}if(Math.abs(dr2)===2&&Math.abs(dc2)===2&&(isK||dr2===fwd*2)){const mr=Math.floor((sr+dr)/2),mc=Math.floor((sc+dc)/2);const mid=this.g[mr][mc];if(mid&&(p<3?mid>=2:mid<2)&&!this.g[dr][dc]){this.g[dr][dc]=p;this.g[sr][sc]=0;this.g[mr][mc]=0;if((p===1&&dr===0)||(p===2&&dr===7))this.g[dr][dc]+=2;return true;}}return false;},
aiMove(){for(let r=0;r<8;r++)for(let c=0;c<8;c++)if(this.g[r][c]===2||this.g[r][c]===4){for(const dr of[-2,-1,1,2])for(const dc of[-2,-1,1,2])if(this.tryMove(r,c,r+dr,c+dc))return;}},
hint(){say("Protect back row. Force trades only when ahead!");}};

// ‚îÄ‚îÄ DOTS & BOXES ‚îÄ‚îÄ
IMPL.dots={N:5,
init(){this.h=Array(6).fill(null).map(()=>Array(5).fill(0));this.v=Array(5).fill(null).map(()=>Array(6).fill(0));this.boxes=Array(5).fill(null).map(()=>Array(5).fill(0));this.pS=0;this.aS=0;this.turn=1;const mg=document.getElementById("mgame");mg.innerHTML="";const c=mkC(250,250);c.id="dc";c.onclick=e=>this.click(e,c);const gw=document.createElement("div");gw.className="gw";gw.innerHTML='<div class="msg" id="db-m">Click between dots to draw lines!</div>';gw.appendChild(c);mg.appendChild(gw);this.draw(c);},
draw(c){if(!c)c=document.getElementById("dc");if(!c)return;const ctx=c.getContext("2d"),M=24,S=40;ctx.fillStyle="#000";ctx.fillRect(0,0,250,250);for(let r=0;r<=5;r++)for(let cc=0;cc<=5;cc++){ctx.fillStyle="#00ff88";ctx.beginPath();ctx.arc(M+cc*S,M+r*S,4,0,Math.PI*2);ctx.fill();}for(let r=0;r<=5;r++)for(let cc=0;cc<5;cc++){if(this.h[r][cc]){ctx.strokeStyle=this.h[r][cc]===1?"#4488ff":"#ff4488";ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(M+cc*S,M+r*S);ctx.lineTo(M+(cc+1)*S,M+r*S);ctx.stroke();}}for(let r=0;r<5;r++)for(let cc=0;cc<=5;cc++){if(this.v[r][cc]){ctx.strokeStyle=this.v[r][cc]===1?"#4488ff":"#ff4488";ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(M+cc*S,M+r*S);ctx.lineTo(M+cc*S,M+(r+1)*S);ctx.stroke();}}for(let r=0;r<5;r++)for(let cc=0;cc<5;cc++){if(this.boxes[r][cc]){ctx.fillStyle=this.boxes[r][cc]===1?"#4488ff33":"#ff448833";ctx.fillRect(M+cc*S+2,M+r*S+2,S-4,S-4);}}sHUD(this.pS,this.aS+" Diddy");},
click(e,c){if(this.turn!==1)return;const rect=c.getBoundingClientRect(),M=24,S=40;const x=(e.clientX-rect.left)*250/rect.width-M,y=(e.clientY-rect.top)*250/rect.height-M;let best=22,mv=null;for(let r=0;r<=5;r++)for(let cc=0;cc<5;cc++){if(!this.h[Math.min(r,5)][cc]){const d=Math.sqrt((x-cc*S-S/2)**2+(y-r*S)**2);if(d<best){best=d;mv={t:"h",r:Math.min(r,5),c:cc};}}}for(let r=0;r<5;r++)for(let cc=0;cc<=5;cc++){if(!this.v[r][Math.min(cc,5)]){const d=Math.sqrt((x-cc*S)**2+(y-r*S-S/2)**2);if(d<best){best=d;mv={t:"v",r,c:Math.min(cc,5)};}}}if(!mv)return;if(mv.t==="h")this.h[mv.r][mv.c]=1;else this.v[mv.r][mv.c]=1;if(!this.chkBoxes(1)){this.turn=2;say("Diddy thinking‚Ä¶");setTimeout(()=>this.aiTurn(),400);}else say("You scored! Go again.");this.draw(c);},
chkBoxes(p){let sc=false;for(let r=0;r<5;r++)for(let c=0;c<5;c++){if(!this.boxes[r][c]&&this.h[r][c]&&this.h[r+1]&&this.h[r+1][c]&&this.v[r][c]&&this.v[r][c+1]){this.boxes[r][c]=p;if(p===1)this.pS++;else this.aS++;sc=true;}}return sc;},
aiTurn(){let mv=null;outer:for(let r=0;r<5;r++)for(let c=0;c<5;c++){if(!this.boxes[r][c]){const t=(!this.h[r][c]?1:0)+(!this.h[r+1][c]?1:0)+(!this.v[r][c]?1:0)+(!this.v[r][c+1]?1:0);if(t===1){if(!this.h[r][c])mv={t:"h",r,c};else if(!this.h[r+1][c])mv={t:"h",r:r+1,c};else if(!this.v[r][c])mv={t:"v",r,c};else mv={t:"v",r,c:c+1};break outer;}}}if(!mv){const opts=[];for(let r=0;r<=5;r++)for(let c=0;c<5;c++)if(!this.h[Math.min(r,5)][c])opts.push({t:"h",r:Math.min(r,5),c});for(let r=0;r<5;r++)for(let c=0;c<=5;c++)if(!this.v[r][Math.min(c,5)])opts.push({t:"v",r,c:Math.min(c,5)});if(opts.length)mv=opts[Math.floor(Math.random()*opts.length)];}if(mv){if(mv.t==="h")this.h[mv.r][mv.c]=2;else this.v[mv.r][mv.c]=2;if(this.chkBoxes(2))setTimeout(()=>this.aiTurn(),300);else{this.turn=1;say("Your turn!");}}const c=document.getElementById("dc");if(c)this.draw(c);},
hint(){say("Complete boxes when you see 3 sides. Don't give Diddy chains!");}};
// ‚îÄ‚îÄ GOMOKU ‚îÄ‚îÄ
IMPL.gomoku={S:13,
init(){this.g=Array(13).fill(null).map(()=>Array(13).fill(0));this.over=false;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="gk-m">5 in a row wins! You are ‚ö´</div><div class="brd" id="gk-b" style="grid-template-columns:repeat(13,32px);grid-template-rows:repeat(13,32px);background:#1a1a0a;gap:1px;padding:3px;border-radius:6px;"></div>';mg.appendChild(w);this.render();},
render(){const b=document.getElementById("gk-b");if(!b)return;b.innerHTML="";for(let r=0;r<13;r++)for(let c=0;c<13;c++){const d=document.createElement("div");d.className="cl";d.style.cssText="width:32px;height:32px;background:#1a1a0a;font-size:1rem;";const v=this.g[r][c];d.textContent=v===1?"‚ö´":v===2?"‚ö™":"";d.onclick=()=>this.play(r,c);b.appendChild(d);}sHUD("‚ö´ you","‚ö™ Diddy");},
play(r,c){if(this.over||this.g[r][c])return;this.g[r][c]=1;this.render();if(this.chk(1)){this.over=true;say("You win! 5 in a row!");return;}say("Diddy thinking‚Ä¶");setTimeout(()=>{const best=this.aiPick();this.g[best[0]][best[1]]=2;this.render();if(this.chk(2)){this.over=true;say("Diddy wins!");}else say("Your turn ‚ö´");},400);},
aiPick(){const scores=[];for(let r=0;r<13;r++)for(let c=0;c<13;c++){if(!this.g[r][c]){this.g[r][c]=2;const s2=this.lineLen(r,c,2);this.g[r][c]=1;const s1=this.lineLen(r,c,1);this.g[r][c]=0;scores.push([r,c,s2*10+s1*8+Math.random()]);}}scores.sort((a,b)=>b[2]-a[2]);return scores[0];},
lineLen(r,c,p){let mx=0;[[0,1],[1,0],[1,1],[1,-1]].forEach(([dr,dc])=>{let cnt=1;for(let d=1;d<5;d++){const nr=r+dr*d,nc=c+dc*d;if(nr<0||nr>=13||nc<0||nc>=13||this.g[nr][nc]!==p)break;cnt++;}for(let d=1;d<5;d++){const nr=r-dr*d,nc=c-dc*d;if(nr<0||nr>=13||nc<0||nc>=13||this.g[nr][nc]!==p)break;cnt++;}mx=Math.max(mx,cnt);});return mx;},
chk(p){return[[0,1],[1,0],[1,1],[1,-1]].some(([dr,dc])=>this.g.some((row,r)=>row.some((v,c)=>v===p&&[1,2,3,4].every(i=>{const nr=r+dr*i,nc=c+dc*i;return nr>=0&&nr<13&&nc>=0&&nc<13&&this.g[nr][nc]===p;}))));},
hint(){say("Block Diddy's 4-in-a-rows first, then build your own!");}};

// ‚îÄ‚îÄ MANCALA ‚îÄ‚îÄ
IMPL.mancala={
init(){this.pits=Array(14).fill(0);for(let i=0;i<6;i++)this.pits[i]=4;for(let i=7;i<13;i++)this.pits[i]=4;this.turn=0;this.over=false;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="mn-m">Your pits are 0-5 (bottom). Click to sow seeds!</div><div id="mn-b" style="display:flex;flex-direction:column;gap:6px;align-items:center;"></div>';mg.appendChild(w);this.render();},
render(){const b=document.getElementById("mn-b");if(!b)return;b.innerHTML="";const row=s=>{const d=document.createElement("div");d.style.cssText="display:flex;gap:5px;align-items:center;";return d;};const pit=(i,clickable)=>{const d=document.createElement("div");d.style.cssText="width:44px;height:44px;background:var(--bg3);border:1px solid "+(clickable&&this.pits[i]?"var(--acc)":"#2a3050")+";border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.9rem;cursor:"+(clickable&&this.pits[i]?"pointer":"default")+";color:var(--acc);font-weight:700;";d.textContent=this.pits[i];if(clickable&&this.pits[i]&&!this.over)d.onclick=()=>this.sow(i);return d;};const store=i=>{const d=document.createElement("div");d.style.cssText="width:44px;height:100px;background:var(--bg3);border:1px solid #2a3050;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1.1rem;font-weight:700;color:var(--a4);";d.textContent=this.pits[i];return d;};const aiRow=row();aiRow.appendChild(store(13));for(let i=12;i>=7;i--)aiRow.appendChild(pit(i,false));aiRow.appendChild(store(6));const pRow=row();pRow.appendChild(store(13));for(let i=0;i<6;i++)pRow.appendChild(pit(i,this.turn===0));pRow.appendChild(store(6));b.appendChild(aiRow);b.appendChild(pRow);sHUD("Store: "+this.pits[6],"Store: "+this.pits[13]+" Diddy");},
sow(idx){if(this.over||this.turn!==0||!this.pits[idx])return;let seeds=this.pits[idx];this.pits[idx]=0;let pos=idx;while(seeds>0){pos=(pos+1)%14;if(pos===13)continue;this.pits[pos]++;seeds--;}if(pos===6){say("Bonus turn!");this.render();}else{if(pos<6&&this.pits[pos]===1&&this.pits[12-pos]>0){this.pits[6]+=this.pits[12-pos]+1;this.pits[12-pos]=0;this.pits[pos]=0;say("Captured!");}this.turn=1;this.render();setTimeout(()=>this.aiMove(),700);}this.chkEnd();},
aiMove(){if(this.over)return;const moves=[];for(let i=7;i<13;i++)if(this.pits[i])moves.push(i);if(!moves.length){this.turn=0;this.render();return;}const pick=moves[Math.floor(Math.random()*moves.length)];let seeds=this.pits[pick];this.pits[pick]=0;let pos=pick;while(seeds>0){pos=(pos+1)%14;if(pos===6)continue;this.pits[pos]++;seeds--;}if(pos===13){say("Diddy gets bonus turn!");this.render();setTimeout(()=>this.aiMove(),700);}else{this.turn=0;say("Your turn!");}this.render();this.chkEnd();},
chkEnd(){const pSum=this.pits.slice(0,6).reduce((a,b)=>a+b,0);const aSum=this.pits.slice(7,13).reduce((a,b)=>a+b,0);if(!pSum||!aSum){this.pits[6]+=pSum;this.pits[13]+=aSum;for(let i=0;i<6;i++)this.pits[i]=0;for(let i=7;i<13;i++)this.pits[i]=0;this.over=true;say(this.pits[6]>this.pits[13]?"You win! "+this.pits[6]+"-"+this.pits[13]:this.pits[13]>this.pits[6]?"Diddy wins! "+this.pits[13]+"-"+this.pits[6]:"Draw!");}},
hint(){say("Land in your store for a free turn. Aim to capture opponent seeds!");}};

// ‚îÄ‚îÄ NIM ‚îÄ‚îÄ
IMPL.nim={
init(){this.piles=[7,5,3];this.turn="p";this.over=false;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="nm-m">Take any number from one pile. Take the last one and LOSE!</div><div id="nm-b"></div>';mg.appendChild(w);this.render();},
render(){const b=document.getElementById("nm-b");if(!b)return;b.innerHTML="";this.piles.forEach((n,i)=>{const row=document.createElement("div");row.style.cssText="display:flex;align-items:center;gap:6px;margin:5px 0;";const lbl=document.createElement("div");lbl.style.cssText="width:60px;font-size:.62rem;color:var(--dm);";lbl.textContent="Pile "+(i+1)+": "+n;row.appendChild(lbl);for(let j=1;j<=n;j++){const s=document.createElement("div");s.style.cssText="width:22px;height:22px;background:var(--acc);border-radius:3px;cursor:pointer;";s.onclick=()=>this.take(i,n-j+1);row.appendChild(s);}b.appendChild(row);});sHUD("your turn","Diddy's turn");if(this.over)sHUD(this.turn==="ai"?"You win!":"Diddy wins!","");},
take(pile,count){if(this.over||this.turn!=="p"||count<1||count>this.piles[pile])return;this.piles[pile]-=count;if(this.piles.every(p=>p===0)){this.over=true;say("Diddy wins! (You took last)");this.render();return;}this.turn="ai";say("Diddy thinking‚Ä¶");this.render();setTimeout(()=>this.aiMove(),700);},
aiMove(){const xor=this.piles.reduce((a,b)=>a^b,0);let moved=false;if(xor){for(let i=0;i<this.piles.length&&!moved;i++){const target=this.piles[i]^xor;if(target<this.piles[i]){this.piles[i]=target;moved=true;}}}if(!moved){const nonEmpty=this.piles.map((v,i)=>v?i:null).filter(i=>i!=null);if(nonEmpty.length){const i=nonEmpty[Math.floor(Math.random()*nonEmpty.length)];this.piles[i]--;}}if(this.piles.every(p=>p===0)){this.over=true;say("You win! Diddy took last!");this.render();return;}this.turn="p";say("Your turn!");this.render();},
hint(){say("XOR all piles to 0 on your move ‚Äî that's the winning strategy!");}};

// ‚îÄ‚îÄ YAHTZEE ‚îÄ‚îÄ
IMPL.yahtzee={
init(){this.dice=Array(5).fill(1);this.held=Array(5).fill(false);this.rolls=0;this.scores={};this.CATS=["Ones","Twos","Threes","Fours","Fives","Sixes","3ofKind","4ofKind","FullHouse","SmStraight","LgStraight","Yahtzee","Chance"];const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="yh-m">Roll the dice! Up to 3 rolls per turn.</div><div id="yh-dice" style="display:flex;gap:8px;justify-content:center;margin:8px 0;"></div><div style="display:flex;gap:6px;"><button class="mb p" id="yh-roll" onclick="IMPL.yahtzee.roll()">üé≤ Roll ('+this.rolls+'/3)</button><button class="mb" onclick="IMPL.yahtzee.clrHeld()">Clear Hold</button></div><div id="yh-cats" style="display:flex;flex-wrap:wrap;gap:5px;margin-top:8px;justify-content:center;"></div>';mg.appendChild(w);this.renderDice();this.renderCats();},
roll(){if(this.rolls>=3)return;this.dice.forEach((v,i)=>{if(!this.held[i])this.dice[i]=Math.ceil(Math.random()*6);});this.rolls++;document.getElementById("yh-roll").textContent="üé≤ Roll ("+this.rolls+"/3)";if(this.rolls>=3)document.getElementById("yh-roll").disabled=true;this.renderDice();},
clrHeld(){this.held=Array(5).fill(false);this.renderDice();},
renderDice(){const d=document.getElementById("yh-dice");if(!d)return;d.innerHTML="";const F=["","‚öÄ","‚öÅ","‚öÇ","‚öÉ","‚öÑ","‚öÖ"];this.dice.forEach((v,i)=>{const el=document.createElement("div");el.style.cssText="width:46px;height:46px;background:"+(this.held[i]?"#1a3a1a":"var(--bg3)")+";border:2px solid "+(this.held[i]?"var(--acc)":"#2a3050")+";border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1.8rem;cursor:pointer;";el.textContent=F[v];el.onclick=()=>{if(this.rolls>0){this.held[i]=!this.held[i];this.renderDice();}};d.appendChild(el);});},
renderCats(){const c=document.getElementById("yh-cats");if(!c)return;c.innerHTML="";this.CATS.forEach(cat=>{const sc=this.calcScore(cat);const btn=document.createElement("button");btn.className="mb";btn.style.cssText="font-size:.56rem;opacity:"+(this.scores[cat]!==undefined?"0.3":"1")+";";btn.textContent=cat+": "+sc;btn.disabled=this.scores[cat]!==undefined||this.rolls===0;btn.onclick=()=>this.scoreIt(cat);c.appendChild(btn);});},
calcScore(cat){const d=this.dice;const c=Array(7).fill(0);d.forEach(v=>c[v]++);const sum=d.reduce((a,b)=>a+b,0);if(cat==="Ones")return c[1];if(cat==="Twos")return c[2]*2;if(cat==="Threes")return c[3]*3;if(cat==="Fours")return c[4]*4;if(cat==="Fives")return c[5]*5;if(cat==="Sixes")return c[6]*6;if(cat==="3ofKind")return c.some(v=>v>=3)?sum:0;if(cat==="4ofKind")return c.some(v=>v>=4)?sum:0;if(cat==="FullHouse")return c.some(v=>v===3)&&c.some(v=>v===2)?25:0;const uniq=[...new Set(d)].sort((a,b)=>a-b);if(cat==="SmStraight")return uniq.length>=4&&(uniq.some((_,i,a)=>i<3&&a[i+1]-a[i]===1&&a[i+2]-a[i+1]===1&&a[i+3]-a[i+2]===1))?30:0;if(cat==="LgStraight")return uniq.length===5&&uniq[4]-uniq[0]===4?40:0;if(cat==="Yahtzee")return c.some(v=>v===5)?50:0;if(cat==="Chance")return sum;return 0;},
scoreIt(cat){this.scores[cat]=this.calcScore(cat);const total=Object.values(this.scores).reduce((a,b)=>a+b,0);sHUD("Total: "+total,"watching");this.dice=Array(5).fill(1);this.held=Array(5).fill(false);this.rolls=0;const rb=document.getElementById("yh-roll");if(rb){rb.textContent="üé≤ Roll (0/3)";rb.disabled=false;}this.renderDice();this.renderCats();if(Object.keys(this.scores).length>=this.CATS.length)say("Game over! Final: "+total+(total>=250?" ‚Äî Incredible!":" ‚Äî Diddy: not bad."));},
hint(){say("Aim for Yahtzee (50pts). Hold matching dice, reroll the rest!");}};
// ‚îÄ‚îÄ WORD SEARCH ‚îÄ‚îÄ
IMPL.wordsearch={WDS:["CODE","GAME","PIXEL","ARCADE","RETRO","QUEST","SCORE","LEVEL","BONUS","CRYPTO"],
init(){const S=12;this.grid=Array(S).fill(null).map(()=>Array(S).fill(""));this.found=new Set();this.sel=[];this.start=null;this.words=[...this.WDS];this.placeWords(S);this.fillRand(S);const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="ws-m">Find the hidden words! Click-drag to select.</div><div id="ws-g" style="display:inline-grid;grid-template-columns:repeat(12,22px);gap:1px;user-select:none;"></div><div id="ws-wds" style="display:flex;flex-wrap:wrap;gap:5px;margin-top:8px;justify-content:center;"></div>';mg.appendChild(w);this.render();},
placeWords(S){const dirs=[[0,1],[1,0],[1,1],[1,-1],[0,-1],[-1,0]];this.words.forEach(word=>{let placed=false,tries=0;while(!placed&&tries<100){tries++;const [dr,dc]=dirs[Math.floor(Math.random()*dirs.length)];const r=Math.floor(Math.random()*S),c=Math.floor(Math.random()*S);const cells=[];for(let i=0;i<word.length;i++){const nr=r+dr*i,nc=c+dc*i;if(nr<0||nr>=S||nc<0||nc>=S)break;cells.push([nr,nc]);}if(cells.length===word.length&&cells.every(([nr,nc])=>!this.grid[nr][nc]||this.grid[nr][nc]===word[cells.indexOf([nr,nc])])){cells.forEach(([nr,nc],i)=>this.grid[nr][nc]=word[i]);placed=true;}}});},
fillRand(S){for(let r=0;r<S;r++)for(let c=0;c<S;c++)if(!this.grid[r][c])this.grid[r][c]="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(Math.random()*26)];},
render(){const g=document.getElementById("ws-g");if(!g)return;g.innerHTML="";for(let r=0;r<12;r++)for(let c=0;c<12;c++){const d=document.createElement("div");const key=r+","+c;const isSel=this.sel.some(([sr,sc])=>sr===r&&sc===c);const isFound=this.foundCells&&this.foundCells.has(key);d.style.cssText="width:22px;height:22px;display:flex;align-items:center;justify-content:center;font-size:.6rem;font-weight:700;cursor:pointer;border-radius:2px;background:"+(isFound?"#0a3050":isSel?"#1a3020":"#0a0a10")+";color:"+(isFound?"var(--a3)":isSel?"var(--acc)":"var(--tx)")+";";d.textContent=this.grid[r][c];d.onmousedown=()=>{this.start=[r,c];this.sel=[[r,c]];this.render();};d.onmouseover=()=>{if(!this.start)return;this.buildSel(r,c);this.render();};d.onmouseup=()=>{this.check();this.start=null;};g.appendChild(d);}const wd=document.getElementById("ws-wds");if(wd){wd.innerHTML=this.words.map(w=>'<div style="font-size:.56rem;color:'+(this.found.has(w)?"var(--a3)":"var(--dm)")+';">'+w+'</div>').join("");}if(this.found.size===this.words.length)say("All words found! Diddy is amazed.");},
buildSel(er,ec){if(!this.start)return;const[sr,sc]=this.start;const dr=Math.sign(er-sr),dc=Math.sign(ec-sc);this.sel=[];let r=sr,c=sc;const max=Math.max(Math.abs(er-sr),Math.abs(ec-sc));for(let i=0;i<=max;i++){this.sel.push([r,c]);r+=dr;c+=dc;}},
check(){const str=this.sel.map(([r,c])=>this.grid[r][c]).join("");const rev=str.split("").reverse().join("");const match=this.words.find(w=>w===str||w===rev);if(match&&!this.found.has(match)){this.found.add(match);if(!this.foundCells)this.foundCells=new Set();this.sel.forEach(([r,c])=>this.foundCells.add(r+","+c));say("Found: "+match+" ("+this.found.size+"/"+this.words.length+")");}this.sel=[];this.render();},
hint(){const unfound=this.words.filter(w=>!this.found.has(w));say("Look for: "+unfound[0]+". Try scanning diagonals!");}};

// ‚îÄ‚îÄ WORD SCRAMBLE ‚îÄ‚îÄ
IMPL.scramble={WDS:["JAVASCRIPT","ALGORITHM","BLOCKCHAIN","DEVELOPER","INTERFACE","RECURSION","PROTOCOL","FUNCTION","DATABASE","VARIABLE"],
init(){this.score=0;this.aScore=0;this.newWord();},
newWord(){this.word=this.WDS[Math.floor(Math.random()*this.WDS.length)];this.scrambled=[...this.word].sort(()=>Math.random()-.5).join("");while(this.scrambled===this.word)this.scrambled=[...this.word].sort(()=>Math.random()-.5).join("");const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="sc-m">Unscramble the word!</div><div style="font-size:1.4rem;letter-spacing:.2em;color:var(--a2);margin:8px 0;">'+this.scrambled+'</div><input id="sc-i" type="text" style="background:var(--bg3);border:1px solid #2a3050;color:var(--tx);padding:6px 10px;border-radius:6px;font-family:inherit;font-size:.75rem;outline:none;width:200px;" placeholder="Type answer..." autofocus><div style="display:flex;gap:7px;margin-top:8px;"><button class="mb p" onclick="IMPL.scramble.guess()">Submit</button><button class="mb" onclick="IMPL.scramble.skip()">Skip</button></div>';mg.appendChild(w);sHUD(this.score,this.aScore+" Diddy");document.onkeydown=e=>{if(e.key==="Enter")IMPL.scramble.guess();};// AI reveals after 8s
clearTimeout(this.aiTimer);this.aiTimer=setTimeout(()=>{this.aScore++;say("Diddy figured it out: "+this.word);sHUD(this.score,this.aScore+" Diddy");},8000);},
guess(){const inp=document.getElementById("sc-i");if(!inp)return;if(inp.value.toUpperCase()===this.word){this.score++;clearTimeout(this.aiTimer);say("Correct! +1");sHUD(this.score,this.aScore+" Diddy");setTimeout(()=>this.newWord(),1000);}else{say("Not quite, try again!");}},
skip(){clearTimeout(this.aiTimer);say("Skipped. Word was: "+this.word);this.aScore++;setTimeout(()=>this.newWord(),1000);},
hint(){say("Word has "+this.word.length+" letters. First letter: "+this.word[0]);}};

// ‚îÄ‚îÄ TYPE RACER ‚îÄ‚îÄ
IMPL.typerace={SNTS:["The quick brown fox jumps over the lazy dog","Pack my box with five dozen liquor jugs","How razorback jumping frogs can level six piqued gymnasts","Sphinx of black quartz judge my vow","Fix problem quickly with galvanized jets"],
init(){this.sent=this.SNTS[Math.floor(Math.random()*this.SNTS.length)];this.start=null;this.done=false;this.aiPos=0;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="tr-m">Type the text as fast as you can!</div><div id="tr-txt" style="font-size:.72rem;color:var(--dm);line-height:1.6;max-width:400px;text-align:center;margin:6px 0;padding:8px;background:var(--bg3);border-radius:6px;border:1px solid #2a3050;"></div><input id="tr-i" type="text" style="background:var(--bg3);border:1px solid #2a3050;color:var(--tx);padding:6px 10px;border-radius:6px;font-family:inherit;font-size:.72rem;outline:none;width:100%;max-width:400px;" placeholder="Start typing..." autofocus><div id="tr-bars" style="display:flex;gap:8px;margin-top:8px;width:100%;max-width:400px;"><div style="flex:1;"><div style="font-size:.52rem;color:var(--acc);margin-bottom:2px">YOU</div><div id="tr-pb" style="height:8px;background:var(--bg3);border-radius:4px;"><div id="tr-pf" style="height:100%;background:var(--acc);border-radius:4px;width:0%;transition:width .1s;"></div></div></div><div style="flex:1;"><div style="font-size:.52rem;color:var(--a2);margin-bottom:2px">DIDDY</div><div id="tr-ab" style="height:8px;background:var(--bg3);border-radius:4px;"><div id="tr-af" style="height:100%;background:var(--a2);border-radius:4px;width:0%;transition:width .1s;"></div></div></div></div>';mg.appendChild(w);document.getElementById("tr-txt").textContent=this.sent;const inp=document.getElementById("tr-i");inp.oninput=()=>this.update(inp.value);// AI types at ~55 WPM
clearInterval(this.aiIv);this.aiIv=setInterval(()=>{if(!this.done){this.aiPos=Math.min(this.sent.length,this.aiPos+1);const pct=this.aiPos/this.sent.length*100;const af=document.getElementById("tr-af");if(af)af.style.width=pct+"%";if(this.aiPos>=this.sent.length){clearInterval(this.aiIv);if(!this.done){this.done=true;say("Diddy finished first! Try again.");}}}},120);},
cleanup(){clearInterval(this.aiIv);},
update(typed){if(!this.start)this.start=Date.now();const correct=this.sent.slice(0,typed.length);const right=typed===correct;const pct=Math.min(100,typed.length/this.sent.length*100);const pf=document.getElementById("tr-pf");if(pf)pf.style.width=pct+"%";document.getElementById("tr-i").style.borderColor=right?"var(--acc)":"var(--a2)";if(typed===this.sent&&!this.done){this.done=true;clearInterval(this.aiIv);const elapsed=(Date.now()-this.start)/1000;const wpm=Math.round((this.sent.split(" ").length/elapsed)*60);say("Done in "+elapsed.toFixed(1)+"s ‚Äî "+wpm+" WPM!");sHUD(wpm+" WPM","beaten!");}},
hint(){say("Don't look at your hands. Let muscle memory do it!");}};

// ‚îÄ‚îÄ NUMBER GUESS ‚îÄ‚îÄ
IMPL.numguess={
init(){this.num=Math.floor(Math.random()*100)+1;this.guesses=0;this.aiNum=Math.floor(Math.random()*100)+1;this.aiLow=1;this.aiHigh=100;this.aiGuesses=0;this.over=false;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="ng-m">Guess a number 1-100. Diddy is also guessing!</div><div style="display:flex;gap:7px;margin-top:8px;align-items:center;"><input id="ng-i" type="number" min="1" max="100" style="width:80px;background:var(--bg3);border:1px solid #2a3050;color:var(--tx);padding:5px 8px;border-radius:5px;font-family:inherit;font-size:.75rem;outline:none;" placeholder="1-100"><button class="mb p" onclick="IMPL.numguess.guess()">Guess</button></div><div id="ng-hist" style="margin-top:8px;font-size:.6rem;color:var(--dm);min-height:40px;"></div>';mg.appendChild(w);document.onkeydown=e=>{if(e.key==="Enter")IMPL.numguess.guess();};sHUD("Guesses: 0","Guesses: 0");// AI guesses every 2s
clearInterval(this.aiIv);this.aiIv=setInterval(()=>{if(!this.over)this.aiGuess();},2000);},
cleanup(){clearInterval(this.aiIv);},
guess(){const inp=document.getElementById("ng-i");const g=parseInt(inp.value);if(!g||g<1||g>100)return;this.guesses++;inp.value="";const hist=document.getElementById("ng-hist");const msg=g===this.num?"Correct!":g<this.num?"Too low":"Too high";if(g===this.num){this.over=true;clearInterval(this.aiIv);say("You got it in "+this.guesses+" guesses!");hist.innerHTML+='<div style="color:var(--acc)">'+g+' ‚Äî CORRECT!</div>';}else{hist.innerHTML+='<div>'+g+' ‚Äî '+msg+'</div>';sHUD("Guesses: "+this.guesses,"Guesses: "+this.aiGuesses);}},
aiGuess(){const g=Math.floor((this.aiLow+this.aiHigh)/2);this.aiGuesses++;if(g===this.aiNum){this.over=true;clearInterval(this.aiIv);say("Diddy got it in "+this.aiGuesses+" guesses! (Binary search)");sHUD("Guesses: "+this.guesses,"Won in "+this.aiGuesses);}else{if(g<this.aiNum)this.aiLow=g+1;else this.aiHigh=g-1;sHUD("Guesses: "+this.guesses,"Guesses: "+this.aiGuesses);}},
hint(){say("Use binary search: always guess the middle of remaining range!");}};
// ‚îÄ‚îÄ REACTION TIME ‚îÄ‚îÄ
IMPL.reaction={
init(){this.state="wait";this.t=null;this.pTimes=[];this.aiTimes=[850,720,680,910,760];const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="rc-m">Wait for GREEN, then click as fast as you can!</div><div id="rc-box" style="width:220px;height:140px;background:#1a1020;border:2px solid #2a3050;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:.8rem;color:var(--dm);cursor:pointer;margin:8px 0;" onclick="IMPL.reaction.click()">Click to start</div><div id="rc-hist" style="font-size:.6rem;color:var(--dm);min-height:30px;text-align:center;"></div>';mg.appendChild(w);},
click(){
  const box=document.getElementById("rc-box");if(!box)return;
  if(this.state==="wait"){this.state="ready";box.style.background="#440000";box.style.color="#ff4488";box.textContent="Wait...";const delay=1000+Math.random()*3000;this.t=setTimeout(()=>{this.state="go";box.style.background="#004400";box.style.color="#00ff88";box.textContent="CLICK NOW!";this.goTime=Date.now();},delay);}
  else if(this.state==="ready"){box.style.background="#1a1020";box.style.color="#ff4488";box.textContent="Too early! Click to retry";this.state="wait";clearTimeout(this.t);}
  else if(this.state==="go"){const rt=Date.now()-this.goTime;this.pTimes.push(rt);const aiTime=this.aiTimes[Math.floor(Math.random()*this.aiTimes.length)];const avg=Math.round(this.pTimes.reduce((a,b)=>a+b,0)/this.pTimes.length);box.style.background="#1a1020";box.style.color=rt<aiTime?"var(--acc)":"var(--a2)";box.textContent=rt+"ms ‚Äî "+(rt<aiTime?"You beat Diddy!":"Diddy: "+aiTime+"ms");document.getElementById("rc-hist").textContent="Your avg: "+avg+"ms ("+this.pTimes.length+" rounds) | Diddy avg: ~790ms";this.state="wait";say(rt<500?"Lightning!":rt<800?"Fast!":rt<1200?"Decent":"Slow‚Ä¶");}
},hint(){say("Average human: 250ms. Diddy averages ~790ms. Beat that!");}};

// ‚îÄ‚îÄ BOWLING ‚îÄ‚îÄ
IMPL.bowling={
init(){this.frame=1;this.rolls=[];this.curRoll=1;this.pins=Array(10).fill(true);const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="bw-m">Click the ball to bowl! Aim with cursor.</div><canvas id="bw-c" width="360" height="200" style="background:#000;border:1px solid #1a2030;border-radius:4px;"></canvas><div style="display:flex;gap:8px;margin-top:6px;"><button class="mb p" onclick="IMPL.bowling.bowl()">üé≥ Bowl</button></div><div id="bw-score" style="font-size:.6rem;color:var(--dm);margin-top:5px;"></div>';mg.appendChild(w);this.drawLane();this.updateScore();},
bowl(){
  const knocked=this.pins.map(()=>Math.random()>0.35);knocked.forEach((k,i)=>{if(k)this.pins[i]=false;});const count=this.pins.filter(p=>!p).length;this.rolls.push(count);this.animBowl(count);if(!this.pins.some(p=>p)||this.curRoll===2){if(this.frame<10){this.frame++;this.pins=Array(10).fill(true);this.curRoll=1;}else{say("Game over! Score: "+this.calcTotal());}}else{this.curRoll=2;}// AI bowls after 1.5s
setTimeout(()=>{const aiKnock=Math.floor(Math.random()*8)+2;say("Diddy knocks "+aiKnock+"!");},1500);this.updateScore();
},
animBowl(count){const c=document.getElementById("bw-c");if(!c)return;const ctx=c.getContext("2d");ctx.fillStyle="#000";ctx.fillRect(0,0,360,200);ctx.fillStyle="#1a2030";ctx.fillRect(60,10,240,140);// pins
for(let i=0;i<10;i++){const row=Math.floor((Math.sqrt(8*i+1)-1)/2);const col=i-row*(row+1)/2;const x=150+col*20-row*10,y=20+row*24;ctx.beginPath();ctx.arc(x,y,8,0,Math.PI*2);ctx.fillStyle=this.pins[i]?"#fff":"#333";ctx.fill();}// ball
ctx.fillStyle="#4488ff";ctx.beginPath();ctx.arc(180,170,18,0,Math.PI*2);ctx.fill();say("Knocked "+count+" pins! Frame "+this.frame);},
drawLane(){const c=document.getElementById("bw-c");if(!c)return;const ctx=c.getContext("2d");ctx.fillStyle="#000";ctx.fillRect(0,0,360,200);ctx.fillStyle="#1a2030";ctx.fillRect(60,10,240,140);ctx.fillStyle="#2a3040";ctx.fillRect(150,150,60,30);for(let i=0;i<10;i++){const row=Math.floor((Math.sqrt(8*i+1)-1)/2);const col=i-row*(row+1)/2;const x=150+col*20-row*10,y=20+row*24;ctx.beginPath();ctx.arc(x,y,8,0,Math.PI*2);ctx.fillStyle="#fff";ctx.fill();}},
calcTotal(){return this.rolls.reduce((a,b)=>a+b,0);},
updateScore(){document.getElementById("bw-score").textContent="Frame: "+this.frame+"/10 | Roll: "+this.curRoll+" | Total: "+this.calcTotal();},
hint(){say("Aim for the center pin (headpin). Consistent is better than powerful!");}};

// ‚îÄ‚îÄ COIN FLIP ‚îÄ‚îÄ
IMPL.coin={
init(){this.pW=0;this.aW=0;this.streak=0;this.bet=10;this.coins=100;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="cf-m">Predict the flip!</div><div id="cf-coin" style="width:80px;height:80px;background:#ffcc00;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:2rem;border:3px solid #aa8800;margin:8px 0;">ü™ô</div><div style="display:flex;gap:8px;"><button class="mb p" onclick="IMPL.coin.flip(\'H\')">üëë HEADS</button><button class="mb" onclick="IMPL.coin.flip(\'T\')">‚ö° TAILS</button></div><div style="margin-top:6px;display:flex;gap:6px;"><button class="mb" onclick="IMPL.coin.bet=Math.min(50,IMPL.coin.bet+5)">BET+</button><button class="mb" onclick="IMPL.coin.bet=Math.max(5,IMPL.coin.bet-5)">BET-</button></div>';mg.appendChild(w);sHUD("Coins: "+this.coins,"Bet: "+this.bet);},
flip(pick){
  const result=Math.random()>0.5?"H":"T";const coin=document.getElementById("cf-coin");
  // Diddy uses pattern recognition (pure random itself)
  const aiPick=Math.random()>0.5?"H":"T";
  let i=0;const iv=setInterval(()=>{coin.textContent=Math.random()>0.5?"üëë":"‚ö°";if(++i>8){clearInterval(iv);coin.textContent=result==="H"?"üëë":"‚ö°";const win=pick===result;if(win){this.pW++;this.coins+=this.bet;this.streak++;say("Correct! +"+this.bet+" (streak: "+this.streak+")");}else{this.coins-=this.bet;this.streak=0;say("Wrong! -"+this.bet+" | It was "+(result==="H"?"Heads":"Tails"));}const aiWin=aiPick===result;if(aiWin)this.aW++;sHUD("Coins: "+this.coins+" ("+this.pW+" wins)","Bet: "+this.bet+" | Diddy: "+this.aW+" wins");}},100);
},hint(){say("No strategy beats 50/50. But bigger streaks = bigger swings!");}};

// ‚îÄ‚îÄ MATH QUIZ ‚îÄ‚îÄ
IMPL.mathquiz={
init(){this.score=0;this.aScore=0;this.q=null;this.newQ();},
newQ(){const ops=["+","-","*"];const op=ops[Math.floor(Math.random()*ops.length)];const a=Math.floor(Math.random()*12)+1,b=Math.floor(Math.random()*12)+1;this.ans=op==="+"?a+b:op==="-"?a-b:a*b;this.q=a+" "+op+" "+b+" = ?";const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="mq-m">Solve faster than Diddy!</div><div style="font-size:1.8rem;color:var(--acc);font-weight:900;margin:10px 0;">'+this.q+'</div><div style="display:flex;gap:7px;align-items:center;"><input id="mq-i" type="number" style="width:80px;background:var(--bg3);border:1px solid #2a3050;color:var(--tx);padding:5px 8px;border-radius:5px;font-family:inherit;font-size:.9rem;outline:none;" autofocus><button class="mb p" onclick="IMPL.mathquiz.check()">Submit</button></div>';mg.appendChild(w);sHUD(this.score,this.aScore+" Diddy");document.onkeydown=e=>{if(e.key==="Enter")IMPL.mathquiz.check();};clearTimeout(this.aiT);const aiDelay=800+Math.random()*1500;this.aiT=setTimeout(()=>{this.aScore++;say("Diddy solved it! Answer: "+this.ans);sHUD(this.score,this.aScore+" Diddy");setTimeout(()=>this.newQ(),1200);},aiDelay);},
check(){const inp=document.getElementById("mq-i");if(!inp)return;if(parseInt(inp.value)===this.ans){clearTimeout(this.aiT);this.score++;say("Correct! +1");sHUD(this.score,this.aScore+" Diddy");setTimeout(()=>this.newQ(),700);}else{say("Wrong! Try again‚Ä¶");}},
hint(){say("Approximate first, then refine. Diddy uses mental math shortcuts!");}};

// ‚îÄ‚îÄ COLOR MATCH ‚îÄ‚îÄ
IMPL.colormatch={
init(){this.score=0;this.aScore=0;this.newRound();},
newRound(){const colors=["RED","BLUE","GREEN","YELLOW","PURPLE","ORANGE"];const word=colors[Math.floor(Math.random()*colors.length)];const ink=colors[Math.floor(Math.random()*colors.length)];this.correct=word===ink?"match":"nomatch";const mg=document.getElementById("mgame");mg.innerHTML="";const inkMap={RED:"#ff4444",BLUE:"#4488ff",GREEN:"#44cc44",YELLOW:"#ffcc00",PURPLE:"#aa44ff",ORANGE:"#ff8800"};const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="cm-m">Does the COLOR of the text match the WORD?</div><div style="font-size:2rem;font-weight:900;color:'+inkMap[ink]+';margin:14px 0;">'+word+'</div><div style="display:flex;gap:10px;"><button class="mb p" style="font-size:.9rem;padding:8px 18px;" onclick="IMPL.colormatch.ans(\'match\')">MATCH</button><button class="mb" style="font-size:.9rem;padding:8px 18px;" onclick="IMPL.colormatch.ans(\'nomatch\')">NO MATCH</button></div>';mg.appendChild(w);sHUD(this.score,this.aScore+" Diddy");clearTimeout(this.aiT);this.aiT=setTimeout(()=>{this.aScore++;say("Diddy answered! It was: "+this.correct);sHUD(this.score,this.aScore+" Diddy");setTimeout(()=>this.newRound(),1000);},1800+Math.random()*1000);},
ans(a){clearTimeout(this.aiT);if(a===this.correct){this.score++;say("Correct!");}else{say("Wrong! It was: "+this.correct);}sHUD(this.score,this.aScore+" Diddy");setTimeout(()=>this.newRound(),700);},
hint(){say("Ignore the word ‚Äî focus only on the ink COLOR. Stroop effect!");}};

// ‚îÄ‚îÄ TRIVIA ‚îÄ‚îÄ
IMPL.trivia={Qs:[
  {q:"What does CPU stand for?",a:"Central Processing Unit",opts:["Central Processing Unit","Computer Power Unit","Core Processor Utility","Central Program Updater"]},
  {q:"Which language runs in a browser natively?",a:"JavaScript",opts:["Python","JavaScript","Ruby","Swift"]},
  {q:"What is 2^10?",a:"1024",opts:["512","2048","1024","256"]},
  {q:"Who created Bitcoin?",a:"Satoshi Nakamoto",opts:["Vitalik Buterin","Satoshi Nakamoto","Elon Musk","Tim Berners-Lee"]},
  {q:"What does HTML stand for?",a:"HyperText Markup Language",opts:["HyperText Markup Language","High Transfer Machine Learning","Hyper Transfer Mode Link","HyperText Modern Layout"]},
  {q:"Which data structure uses LIFO?",a:"Stack",opts:["Queue","Heap","Stack","Graph"]},
  {q:"What year was the iPhone first released?",a:"2007",opts:["2004","2005","2007","2009"]},
  {q:"What is the time complexity of binary search?",a:"O(log n)",opts:["O(n)","O(log n)","O(n¬≤)","O(1)"]},
],idx:0,pScore:0,aScore:0,
init(){this.idx=0;this.pScore=0;this.aScore=0;this.shuffle();this.ask();},
shuffle(){this.Qs=[...this.Qs].sort(()=>Math.random()-.5);},
ask(){if(this.idx>=this.Qs.length){say("Done! You: "+this.pScore+" Diddy: "+this.aScore+(this.pScore>this.aScore?" ‚Äî You win!":" ‚Äî Diddy wins!"));return;}const q=this.Qs[this.idx];const shuffOpts=[...q.opts].sort(()=>Math.random()-.5);const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="tv-m">Question '+(this.idx+1)+"/"+this.Qs.length+'</div><div style="font-size:.72rem;color:var(--acc);text-align:center;max-width:360px;margin:8px 0;line-height:1.5;">'+q.q+'</div><div id="tv-opts" style="display:flex;flex-direction:column;gap:6px;width:100%;max-width:360px;"></div>';mg.appendChild(w);const opts=document.getElementById("tv-opts");shuffOpts.forEach(opt=>{const b=document.createElement("button");b.className="mb";b.style.cssText="text-align:left;font-size:.62rem;padding:7px 10px;";b.textContent=opt;b.onclick=()=>this.answer(opt,q.a,shuffOpts);opts.appendChild(b);});sHUD(this.pScore,this.aScore+" Diddy");// AI answers after delay
clearTimeout(this.aiT);this.aiT=setTimeout(()=>{const aiCorrect=Math.random()>0.35;if(aiCorrect)this.aScore++;say("Diddy answered "+(aiCorrect?"correctly":"wrong")+"!");},2500);},
answer(pick,correct,opts){clearTimeout(this.aiT);const right=pick===correct;if(right)this.pScore++;const aiCorrect=Math.random()>0.35;if(aiCorrect)this.aScore++;const optEls=document.querySelectorAll("#tv-opts .mb");optEls.forEach((b,i)=>{b.disabled=true;if(opts[i]===correct)b.style.borderColor="var(--acc)";else if(opts[i]===pick&&!right)b.style.borderColor="var(--a2)";});say(right?"Correct!":"Wrong! Answer: "+correct);sHUD(this.pScore,this.aScore+" Diddy");this.idx++;setTimeout(()=>this.ask(),1200);},
hint(){say("Diddy gets ~65% right. Can you beat that?");}};

// ‚îÄ‚îÄ HI-LO CARDS ‚îÄ‚îÄ
IMPL.hilo={
init(){this.deck=this.nd();this.score=0;this.aScore=0;this.over=false;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="hl-m">Will the next card be Higher or Lower?</div><div id="hl-cur" style="font-size:3rem;margin:8px 0;">?</div><div id="hl-nxt" style="font-size:2rem;min-height:50px;margin-bottom:8px;"></div><div style="display:flex;gap:8px;"><button class="mb p" onclick="IMPL.hilo.guess(true)">‚¨Ü HIGHER</button><button class="mb" onclick="IMPL.hilo.guess(false)">‚¨á LOWER</button></div>';mg.appendChild(w);this.cur=this.deck.pop();this.show();sHUD(this.score,this.aScore+" Diddy");},
nd(){const vals="A23456789TJQK",s="SHDC",d=[];for(const ss of s)for(const v of vals)d.push({v,s:ss,n:v==="A"?1:v==="T"?10:v==="J"?11:v==="Q"?12:v==="K"?13:+v});return d.sort(()=>Math.random()-.5);},
show(){const su={S:"‚ô†",H:"‚ô•",D:"‚ô¶",C:"‚ô£"};const cur=document.getElementById("hl-cur");if(cur)cur.textContent=this.cur.v+su[this.cur.s];},
guess(higher){if(!this.deck.length){say("Deck empty! Game over.");return;}const nxt=this.deck.pop();const su={S:"‚ô†",H:"‚ô•",D:"‚ô¶",C:"‚ô£"};const nxtEl=document.getElementById("hl-nxt");if(nxtEl)nxtEl.textContent=nxt.v+su[nxt.s];const correct=higher?(nxt.n>this.cur.n):(nxt.n<this.cur.n);if(correct){this.score++;say("Correct! +1");}else say("Wrong!");// AI strategy: guess higher if cur < 7
const aiGuess=this.cur.n<7;const aiCorrect=aiGuess?(nxt.n>this.cur.n):(nxt.n<this.cur.n);if(aiCorrect)this.aScore++;sHUD(this.score,this.aScore+" Diddy");this.cur=nxt;setTimeout(()=>this.show(),600);},
hint(){say("If card < 7, guess Higher. If > 7, guess Lower. Simple edge!");}};

// ‚îÄ‚îÄ SUDOKU ‚îÄ‚îÄ
IMPL.sudoku={
init(){
  this.sol=this.makeSol();this.puzzle=this.sol.map((r,ri)=>r.map((v,ci)=>Math.random()<0.55?null:v));this.sel=null;this.user=this.puzzle.map(r=>[...r]);const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="su-m">Fill the 9x9 grid ‚Äî each row, col, box has 1-9.</div><div id="su-g" style="display:inline-grid;grid-template-columns:repeat(9,34px);gap:1px;background:#2a3050;"></div><div style="display:flex;gap:5px;margin-top:7px;flex-wrap:wrap;justify-content:center;" id="su-nums"></div>';mg.appendChild(w);this.renderGrid();this.renderNums();},
makeSol(){const g=Array(9).fill(null).map(()=>Array(9).fill(0));this.fillGrid(g,0);return g;},
fillGrid(g,pos){if(pos===81)return true;const r=Math.floor(pos/9),c=pos%9;const nums=[1,2,3,4,5,6,7,8,9].sort(()=>Math.random()-.5);for(const n of nums){if(this.ok2(g,r,c,n)){g[r][c]=n;if(this.fillGrid(g,pos+1))return true;g[r][c]=0;}}return false;},
ok2(g,r,c,n){for(let i=0;i<9;i++){if(g[r][i]===n||g[i][c]===n)return false;}const br=Math.floor(r/3)*3,bc=Math.floor(c/3)*3;for(let i=0;i<3;i++)for(let j=0;j<3;j++)if(g[br+i][bc+j]===n)return false;return true;},
renderGrid(){const g=document.getElementById("su-g");if(!g)return;g.innerHTML="";for(let r=0;r<9;r++)for(let c=0;c<9;c++){const d=document.createElement("div");const given=this.puzzle[r][c]!==null;const isSel=this.sel&&this.sel[0]===r&&this.sel[1]===c;const isWrong=this.user[r][c]&&this.user[r][c]!==this.sol[r][c];d.style.cssText="width:34px;height:34px;display:flex;align-items:center;justify-content:center;font-size:.8rem;cursor:pointer;font-weight:"+(given?"700":"400")+";background:"+(isSel?"#1a3020":((r%3===2&&r<8)||(c%3===2&&c<8))?"#1a1a24":"var(--bg2)")+";color:"+(given?"var(--acc)":isWrong?"var(--a2)":"var(--tx)")+";border-right:"+(c%3===2&&c<8?"2px solid #2a3050":"none")+";border-bottom:"+(r%3===2&&r<8?"2px solid #2a3050":"none")+";";d.textContent=this.user[r][c]||"";if(!given)d.onclick=()=>{this.sel=[r,c];this.renderGrid();};g.appendChild(d);}},
renderNums(){const d=document.getElementById("su-nums");if(!d)return;d.innerHTML="";for(let n=1;n<=9;n++){const b=document.createElement("button");b.className="mb";b.style.cssText="width:30px;padding:4px;font-size:.72rem;";b.textContent=n;b.onclick=()=>{if(this.sel){const[r,c]=this.sel;if(this.puzzle[r][c]===null){this.user[r][c]=n;this.renderGrid();if(this.user.every((row,ri)=>row.every((v,ci)=>v===this.sol[ri][ci])))say("Puzzle solved! Diddy rates: impressive.");}}};d.appendChild(b);}const cl=document.createElement("button");cl.className="mb";cl.textContent="‚úï";cl.onclick=()=>{if(this.sel&&this.puzzle[this.sel[0]][this.sel[1]]===null){this.user[this.sel[0]][this.sel[1]]=null;this.renderGrid();}};d.appendChild(cl);},
hint(){if(this.sel){const[r,c]=this.sel;say("Hint: cell ("+r+","+c+") = "+this.sol[r][c]);}else say("Click a cell first, then hint reveals its answer!");}};

// ‚îÄ‚îÄ WAR (card game) ‚îÄ‚îÄ
IMPL.war={
init(){const vals="23456789TJQKA",d=[];for(let i=0;i<4;i++)for(const v of vals)d.push({v,n:vals.indexOf(v)});const sh=d.sort(()=>Math.random()-.5);this.p=sh.slice(0,26);this.a=sh.slice(26);this.over=false;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="wr-m">War! Each player flips a card. High card wins.</div><div style="display:flex;gap:20px;align-items:center;margin:10px 0;"><div style="text-align:center;"><div style="font-size:.56rem;color:var(--dm)">YOU</div><div id="wr-p" class="crd" style="width:60px;height:80px;font-size:1.3rem;">?</div><div id="wr-pc" style="font-size:.56rem;color:var(--dm);margin-top:3px;">'+this.p.length+' cards</div></div><div id="wr-res" style="font-size:1.4rem;color:var(--a4);">‚öî</div><div style="text-align:center;"><div style="font-size:.56rem;color:var(--dm)">DIDDY</div><div id="wr-a" class="crd" style="width:60px;height:80px;font-size:1.3rem;">?</div><div id="wr-ac" style="font-size:.56rem;color:var(--dm);margin-top:3px;">'+this.a.length+' cards</div></div></div><button class="mb p" onclick="IMPL.war.flip()">‚öî Flip!</button>';mg.appendChild(w);sHUD(this.p.length+" cards",this.a.length+" Diddy");},
flip(){if(!this.p.length||!this.a.length){say("Game over! "+(this.p.length?"You win!":"Diddy wins!"));return;}const pc=this.p.shift(),ac=this.a.shift();const su={S:"‚ô†",H:"‚ô•",D:"‚ô¶",C:"‚ô£"};document.getElementById("wr-p").textContent=pc.v;document.getElementById("wr-a").textContent=ac.v;let res,msg;if(pc.n>ac.n){res="p";msg="You win this round!";this.p.push(pc,ac);}else if(ac.n>pc.n){res="a";msg="Diddy wins this round!";this.a.push(pc,ac);}else{msg="WAR! Both take a card.";if(this.p.length)this.p.push(this.p.shift());if(this.a.length)this.a.push(this.a.shift());}document.getElementById("wr-res").textContent=res==="p"?"‚úÖ":res==="a"?"‚ùå":"‚öî";document.getElementById("wr-pc").textContent=this.p.length+" cards";document.getElementById("wr-ac").textContent=this.a.length+" cards";say(msg);sHUD(this.p.length+" cards",this.a.length+" Diddy");},
hint(){say("Pure luck! But watch for streaks ‚Äî you can quit while ahead.");}};

// ‚îÄ‚îÄ VIDEO POKER ‚îÄ‚îÄ
IMPL.poker={
init(){this.deck=this.nd();this.hand=[];this.held=Array(5).fill(false);this.credits=100;this.bet=10;this.phase="deal";const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="pk-m">5-card draw poker! Hold good cards and draw.</div><div id="pk-hand" style="display:flex;gap:6px;justify-content:center;margin:8px 0;"></div><div id="pk-btns" style="display:flex;gap:6px;flex-wrap:wrap;justify-content:center;"></div><div style="font-size:.54rem;color:var(--dm);margin-top:6px;text-align:center;">Royal Flush=800x ¬∑ Straight Flush=50x ¬∑ 4Kind=25x ¬∑ Full House=9x ¬∑ Flush=6x ¬∑ Straight=4x ¬∑ 3Kind=3x ¬∑ 2Pair=2x ¬∑ Jacks+=1x</div>';mg.appendChild(w);this.deal();},
nd(){const v="23456789TJQKA",s="SHDC",d=[];for(const ss of s)for(const vv of v)d.push({v:vv,s:ss,n:v.indexOf(vv)});return d.sort(()=>Math.random()-.5);},
draw2(){return this.deck.pop()||(this.deck=this.nd(),this.deck.pop());},
deal(){this.deck=this.nd();this.hand=[0,1,2,3,4].map(()=>this.draw2());this.held=Array(5).fill(false);this.phase="hold";this.renderH();document.getElementById("pk-btns").innerHTML='<button class="mb p" onclick="IMPL.poker.draw()">Draw (keep held cards)</button>';},
renderH(){const d=document.getElementById("pk-hand");if(!d)return;d.innerHTML="";const su={S:"‚ô†",H:"‚ô•",D:"‚ô¶",C:"‚ô£"};this.hand.forEach((c,i)=>{const el=document.createElement("div");el.className="crd"+(this.held[i]?" flip":"");el.style.cssText="width:54px;height:74px;flex-direction:column;line-height:1.3;font-size:.82rem;";el.innerHTML='<span style="color:'+("HD".includes(c.s)?"#ff4488":"#c0c8e8")+'">'+c.v+'</span><span style="font-size:.62rem;color:'+("HD".includes(c.s)?"#ff4488":"#888")+'">'+su[c.s]+'</span>';if(this.phase==="hold")el.onclick=()=>{this.held[i]=!this.held[i];this.renderH();};d.appendChild(el);});sHUD("Credits: "+this.credits,"Bet: "+this.bet);},
draw(){this.hand=this.hand.map((c,i)=>this.held[i]?c:this.draw2());this.phase="result";this.renderH();const pay=this.calcPay();this.credits+=pay?pay*this.bet-this.bet:-this.bet;say(pay?(pay===1?"Pair!":"Win! "+pay+"x ‚Äî +"+pay*this.bet):"No win‚Ä¶");sHUD("Credits: "+this.credits,"Bet: "+this.bet);document.getElementById("pk-btns").innerHTML='<button class="mb p" onclick="IMPL.poker.deal()">New Hand</button><button class="mb" onclick="IMPL.poker.bet=Math.min(50,IMPL.poker.bet+10);IMPL.poker.renderH()">Bet+</button>';},
calcPay(){const ns=this.hand.map(c=>c.n).sort((a,b)=>a-b);const ss=this.hand.map(c=>c.s);const c=Array(13).fill(0);ns.forEach(n=>c[n]++);const flush=ss.every(s=>s===ss[0]);const straight=ns[4]-ns[0]===4&&new Set(ns).size===5;const counts=c.filter(v=>v>0).sort((a,b)=>b-a);if(flush&&straight&&ns[0]===8)return 800;if(flush&&straight)return 50;if(counts[0]===4)return 25;if(counts[0]===3&&counts[1]===2)return 9;if(flush)return 6;if(straight)return 4;if(counts[0]===3)return 3;if(counts[0]===2&&counts[1]===2)return 2;if(counts[0]===2&&ns[c.indexOf(2)]>=9)return 1;return 0;},
hint(){say("Hold pairs or better. Always hold 4-to-a-flush or straight!");}};

// ‚îÄ‚îÄ TOWER OF HANOI ‚îÄ‚îÄ
IMPL.towers={
init(){this.N=4;this.pegs=[Array.from({length:this.N},(_, i)=>this.N-i),[],[]];this.sel=null;this.moves=0;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="th-m">Move all discs to peg 3! Can\'t place larger on smaller.</div><canvas id="th-c" width="340" height="160" style="background:#000;border:1px solid #1a2030;border-radius:4px;"></canvas><div style="display:flex;gap:8px;margin-top:8px;"><button class="mb" onclick="IMPL.towers.pickPeg(0)">PEG 1</button><button class="mb" onclick="IMPL.towers.pickPeg(1)">PEG 2</button><button class="mb" onclick="IMPL.towers.pickPeg(2)">PEG 3</button></div>';mg.appendChild(w);this.draw();},
pickPeg(p){if(this.sel===null){if(this.pegs[p].length)this.sel=p;}else{if(p!==this.sel&&(!this.pegs[p].length||this.pegs[this.sel][this.pegs[this.sel].length-1]<this.pegs[p][this.pegs[p].length-1])){this.pegs[p].push(this.pegs[this.sel].pop());this.moves++;if(this.pegs[2].length===this.N){say("Solved in "+this.moves+" moves! Min = "+(Math.pow(2,this.N)-1));}}this.sel=null;}this.draw();},
draw(){const c=document.getElementById("th-c");if(!c)return;const ctx=c.getContext("2d"),W=340,H=160,PW=4,BASE=140;ctx.fillStyle="#000";ctx.fillRect(0,0,W,H);ctx.fillStyle="#2a3050";ctx.fillRect(20,BASE-100,PW,100);ctx.fillRect(155,BASE-100,PW,100);ctx.fillRect(310,BASE-100,PW,100);ctx.fillRect(10,BASE,320,4);const colors=["#ff4488","#ff8844","#ffcc44","#44ff88","#4488ff"];const xPos=[22,157,312];this.pegs.forEach((peg,pi)=>{peg.forEach((disc,di)=>{const w2=disc*16+8,x=xPos[pi]-(w2/2)+2;ctx.fillStyle=colors[disc-1]||"#888";ctx.fillRect(x,BASE-14*(di+1),w2,12);});});if(this.sel!==null){ctx.fillStyle="#00ff8844";ctx.fillRect(xPos[this.sel]-40,BASE-110,80,110);}say("Moves: "+this.moves+" | Sel: "+(this.sel!==null?"Peg "+(this.sel+1):"none"));},
hint(){say("Move small discs out of the way. Always think 2 moves ahead!");}};

// ‚îÄ‚îÄ LIGHTS OUT ‚îÄ‚îÄ
IMPL.lights={N:5,
init(){this.g=Array(5).fill(null).map(()=>Array(5).fill(false));for(let i=0;i<8;i++)this.toggle(Math.floor(Math.random()*5),Math.floor(Math.random()*5));this.moves=0;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="lo-m">Click to toggle lights. Turn them ALL OFF!</div><div id="lo-g" style="display:inline-grid;grid-template-columns:repeat(5,50px);gap:4px;"></div>';mg.appendChild(w);this.render();},
toggle(r,c){[[0,0],[-1,0],[1,0],[0,-1],[0,1]].forEach(([dr,dc])=>{const nr=r+dr,nc=c+dc;if(nr>=0&&nr<5&&nc>=0&&nc<5)this.g[nr][nc]=!this.g[nr][nc];});},
render(){const g=document.getElementById("lo-g");if(!g)return;g.innerHTML="";for(let r=0;r<5;r++)for(let c=0;c<5;c++){const d=document.createElement("div");d.style.cssText="width:50px;height:50px;background:"+(this.g[r][c]?"#ffcc00":"#1a1a10")+";border:2px solid "+(this.g[r][c]?"#aa8800":"#2a3050")+";border-radius:6px;cursor:pointer;transition:background .1s;";d.onclick=()=>{this.toggle(r,c);this.moves++;this.render();if(!this.g.flat().some(v=>v))say("All off! Solved in "+this.moves+" moves!");};g.appendChild(d);}sHUD("Moves: "+this.moves,"watching");},
hint(){say("Work row by row, left to right. Each cell affects 5 tiles!");}};

// ‚îÄ‚îÄ PIPE DREAM ‚îÄ‚îÄ
IMPL.pipe={
init(){const S=6;this.S=S;this.g=Array(S).fill(null).map(()=>Array(S).fill(0));this.g[0][0]=1;this.g[S-1][S-1]=9;this.over=false;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="pp-m">Connect ‚óè to ‚òÖ using pipe tiles! Click cells to rotate.</div><div id="pp-g" style="display:inline-grid;grid-template-columns:repeat(6,46px);gap:2px;"></div><div style="display:flex;gap:6px;margin-top:6px;"><button class="mb p" onclick="IMPL.pipe.check()">Check Path</button></div>';mg.appendChild(w);this.render();},
render(){const g=document.getElementById("pp-g");if(!g)return;g.innerHTML="";const glyphs=["","‚îÉ","‚îÅ","‚îì","‚îó","‚îè","‚îõ","‚î£","‚î≥","‚òÖ"];for(let r=0;r<this.S;r++)for(let c=0;c<this.S;c++){const d=document.createElement("div");const v=this.g[r][c];d.style.cssText="width:46px;height:46px;background:var(--bg3);border:1px solid #2a3050;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:1.4rem;cursor:pointer;color:var(--acc);";d.textContent=v===0?"":v===1?"‚óè":glyphs[v]||"?";if(v!==1&&v!==9)d.onclick=()=>{this.g[r][c]=(this.g[r][c]%8)+2;if(this.g[r][c]>8||this.g[r][c]<2)this.g[r][c]=2;this.render();};g.appendChild(d);}},
check(){say("Path checking! Diddy evaluates: "+Math.random()>0.5?"Valid path! +10":"No complete path yet‚Ä¶");},
hint(){say("Place ‚îÉ for vertical, ‚îÅ for horizontal, corners to turn!");}};

// ‚îÄ‚îÄ ASTEROIDS ‚îÄ‚îÄ
IMPL.asteroids={raf:null,cleanup(){cancelAnimationFrame(this.raf);},
init(){const mg=document.getElementById("mgame");mg.innerHTML="";const W=400,H=340,c=mkC(W,H);mg.appendChild(c);const ctx=c.getContext("2d");let ship={x:W/2,y:H/2,a:0,vx:0,vy:0},bullets=[],rocks=[],score=0,lives=3,fr=0;const keys={};document.onkeydown=e=>keys[e.key]=1;document.onkeyup=e=>delete keys[e.key];for(let i=0;i<5;i++)rocks.push({x:Math.random()*W,y:Math.random()*H,vx:(Math.random()-.5)*2.5,vy:(Math.random()-.5)*2.5,r:30,pts:20});const loop=()=>{fr++;if(keys.ArrowLeft)ship.a-=0.07;if(keys.ArrowRight)ship.a+=0.07;if(keys.ArrowUp){ship.vx+=Math.cos(ship.a)*0.2;ship.vy+=Math.sin(ship.a)*0.2;}ship.vx*=0.99;ship.vy*=0.99;ship.x=(ship.x+ship.vx+W)%W;ship.y=(ship.y+ship.vy+H)%H;if(keys[" "]&&fr%10===0)bullets.push({x:ship.x,y:ship.y,vx:Math.cos(ship.a)*8,vy:Math.sin(ship.a)*8,life:50});bullets.forEach(b=>{b.x=(b.x+b.vx+W)%W;b.y=(b.y+b.vy+H)%H;b.life--;});bullets=bullets.filter(b=>b.life>0);rocks.forEach(r=>{r.x=(r.x+r.vx+W)%W;r.y=(r.y+r.vy+H)%H;});const newRocks=[];bullets.forEach(b=>{rocks.forEach(r=>{if(Math.hypot(b.x-r.x,b.y-r.y)<r.r){score+=r.pts;b.life=0;if(r.r>12){for(let i=0;i<2;i++)newRocks.push({x:r.x,y:r.y,vx:(Math.random()-.5)*4,vy:(Math.random()-.5)*4,r:r.r/2,pts:r.pts*2});}r.r=0;}});});rocks=rocks.filter(r=>r.r>0);rocks.push(...newRocks);if(!rocks.length)for(let i=0;i<5;i++)rocks.push({x:Math.random()<0.5?0:W,y:Math.random()*H,vx:(Math.random()-.5)*3,vy:(Math.random()-.5)*3,r:30,pts:20});rocks.forEach(r=>{if(Math.hypot(ship.x-r.x,ship.y-r.y)<r.r){lives--;rocks=rocks.map(r=>({...r,x:Math.random()*W,y:Math.random()*H}));if(!lives){say("GAME OVER! Score: "+score);return;}}});sHUD(score,"lives: "+lives);ctx.fillStyle="#000";ctx.fillRect(0,0,W,H);ctx.strokeStyle="#00ff88";ctx.lineWidth=1.5;rocks.forEach(r=>{ctx.beginPath();for(let i=0;i<7;i++){const a=i/7*Math.PI*2,rx=r.x+Math.cos(a)*r.r*(0.7+Math.random()*0.3);const ry=r.y+Math.sin(a)*r.r;i?ctx.lineTo(rx,ry):ctx.moveTo(rx,ry);}ctx.closePath();ctx.stroke();});ctx.save();ctx.translate(ship.x,ship.y);ctx.rotate(ship.a);ctx.strokeStyle="#00ff88";ctx.beginPath();ctx.moveTo(14,0);ctx.lineTo(-8,8);ctx.lineTo(-4,0);ctx.lineTo(-8,-8);ctx.closePath();ctx.stroke();if(keys.ArrowUp){ctx.fillStyle="#ff8800";ctx.beginPath();ctx.moveTo(-4,0);ctx.lineTo(-12,4);ctx.lineTo(-10,0);ctx.lineTo(-12,-4);ctx.closePath();ctx.fill();}ctx.restore();ctx.fillStyle="#fff";bullets.forEach(b=>{ctx.beginPath();ctx.arc(b.x,b.y,2,0,Math.PI*2);ctx.fill();});this.raf=requestAnimationFrame(loop);};loop();},hint(){say("Arrow keys to turn/thrust, Space to shoot. Shoot big rocks first!");}};

// ‚îÄ‚îÄ FROGGER ‚îÄ‚îÄ
IMPL.frogger={raf:null,cleanup(){cancelAnimationFrame(this.raf);},
init(){const mg=document.getElementById("mgame");mg.innerHTML="";const W=380,H=340,c=mkC(W,H);mg.appendChild(c);const ctx=c.getContext("2d");const ROWS=8,RH=H/ROWS;let fy=H-RH/2,fx=W/2,lives=3,score=0,fr=0;const lanes=[{y:H*6/8,dir:1,speed:1.8,cars:[{x:20},{x:140},{x:280}],col:"#ff4444"},{y:H*5/8,dir:-1,speed:2.2,cars:[{x:60},{x:200},{x:330}],col:"#ff8844"},{y:H*4/8,dir:1,speed:1.5,cars:[{x:100},{x:250}],col:"#4488ff"},{y:H*3/8,dir:-1,speed:2.8,cars:[{x:30},{x:180},{x:320}],col:"#44ff88"},{y:H*2/8,dir:1,speed:1.2,cars:[{x:80},{x:220}],col:"#aa44ff"}];document.onkeydown=e=>{const S=RH;if(e.key==="ArrowUp")fy-=S;if(e.key==="ArrowDown")fy=Math.min(H-RH/2,fy+S);if(e.key==="ArrowLeft")fx=Math.max(20,fx-40);if(e.key==="ArrowRight")fx=Math.min(W-20,fx+40);if(fy<RH/2){score++;fy=H-RH/2;fx=W/2;say("Made it! Score: "+score);}};const loop=()=>{fr++;lanes.forEach(lane=>lane.cars.forEach(car=>{car.x+=lane.dir*lane.speed;if(car.x>W+40)car.x=-40;if(car.x<-40)car.x=W+40;}));let hit=false;lanes.forEach(lane=>lane.cars.forEach(car=>{if(Math.abs(fy-lane.y)<18&&Math.abs(fx-car.x-20)<36)hit=true;}));if(hit){lives--;fy=H-RH/2;fx=W/2;if(!lives)say("GAME OVER! Score: "+score);}sHUD(score,"lives: "+lives);ctx.fillStyle="#111";ctx.fillRect(0,0,W,H);ctx.fillStyle="#224400";ctx.fillRect(0,0,W,RH);ctx.fillRect(0,H-RH,W,RH);ctx.fillStyle="#333";for(let i=1;i<ROWS-1;i++){ctx.fillRect(0,i*RH,W,RH*0.9);}lanes.forEach(lane=>{lane.cars.forEach(car=>{ctx.fillStyle=lane.col;ctx.fillRect(car.x,lane.y-12,60,24);ctx.fillStyle="#000";ctx.fillRect(car.x+5,lane.y-9,14,10);ctx.fillRect(car.x+41,lane.y-9,14,10);});});ctx.fillStyle="#00ff88";ctx.font="20px serif";ctx.textAlign="center";ctx.fillText("üê∏",fx,fy+7);ctx.fillStyle="#fff";ctx.font="bold 14px monospace";ctx.fillText(score,W/2,18);this.raf=requestAnimationFrame(loop);};loop();},hint(){say("Arrow keys. Watch car speeds. Cross one lane at a time!");}};

// ‚îÄ‚îÄ PAC-MAN ‚îÄ‚îÄ
IMPL.pacman={raf:null,cleanup(){cancelAnimationFrame(this.raf);},
init(){const mg=document.getElementById("mgame");mg.innerHTML="";const GS=20,COLS=19,ROWS=15,W=COLS*GS,H=ROWS*GS,c=mkC(W,H);mg.appendChild(c);const ctx=c.getContext("2d");const MAP=["###################","#........#........#","#.##.###.#.###.##.#","#.................#","#.##.#.#####.#.##.#","#....#...#...#....#","####.###.#.###.####","####.#.......#.####","####.#.#####.#.####","#........#........#","#.##.###.#.###.##.#","#..#.............#.#","##.#.#.#####.#.#.##","#....#...#...#....#","###################"];let px=9,py=7,pdx=1,pdy=0,mouth=0,score=0,dots=0;const ghosts=[{x:9,y:4,dx:1,dy:0,col:"#ff4488"},{x:9,y:5,dx:-1,dy:0,col:"#ff8844"}];const walls=new Set();MAP.forEach((row,r)=>[...row].forEach((c2,cc)=>{if(c2==="#")walls.add(cc+","+r);if(c2===".")dots++;}));const pellets=new Set(MAP.map((row,r)=>[...row].map((c2,cc)=>c2==="."?cc+","+r:null)).flat().filter(Boolean));const keys={};document.onkeydown=e=>keys[e.key]=1;document.onkeyup=e=>delete keys[e.key];let fr=0;const loop=()=>{fr++;if(fr%4===0){let nx=px+pdx,ny=py+pdy;if(!walls.has(nx+","+ny)){px=nx;py=ny;}const pk=px+","+py;if(pellets.has(pk)){pellets.delete(pk);score+=10;}// Move ghosts
ghosts.forEach(g=>{const dirs=[[1,0],[-1,0],[0,1],[0,-1]].filter(([dx,dy])=>!walls.has((g.x+dx)+","+(g.y+dy)));if(dirs.length){const[dx,dy]=dirs[Math.floor(Math.random()*dirs.length)];g.x+=dx;g.y+=dy;}if(Math.abs(g.x-px)<1.5&&Math.abs(g.y-py)<1.5)say("Caught! Score: "+score);})}if(keys.ArrowLeft)pdx=-1,pdy=0;if(keys.ArrowRight)pdx=1,pdy=0;if(keys.ArrowUp)pdx=0,pdy=-1;if(keys.ArrowDown)pdx=0,pdy=1;mouth=(mouth+0.15)%Math.PI;sHUD(score,"chasing you");ctx.fillStyle="#000";ctx.fillRect(0,0,W,H);MAP.forEach((row,r)=>[...row].forEach((ch,cc)=>{if(ch==="#"){ctx.fillStyle="#0000aa";ctx.fillRect(cc*GS,r*GS,GS,GS);}else if(pellets.has(cc+","+r)){ctx.fillStyle="#ffcc00";ctx.beginPath();ctx.arc(cc*GS+GS/2,r*GS+GS/2,3,0,Math.PI*2);ctx.fill();}}));ctx.fillStyle="#ffcc00";ctx.beginPath();ctx.moveTo(px*GS+GS/2,py*GS+GS/2);ctx.arc(px*GS+GS/2,py*GS+GS/2,GS/2-2,mouth,Math.PI*2-mouth);ctx.closePath();ctx.fill();ghosts.forEach(g=>{ctx.fillStyle=g.col;ctx.beginPath();ctx.arc(g.x*GS+GS/2,g.y*GS+GS/2,GS/2-2,Math.PI,0);ctx.lineTo(g.x*GS+GS-2,g.y*GS+GS);ctx.lineTo(g.x*GS+2,g.y*GS+GS);ctx.closePath();ctx.fill();});if(!pellets.size)say("YOU WIN! All dots eaten!");this.raf=requestAnimationFrame(loop);};loop();},hint(){say("Arrow keys. Eat all dots! Avoid red/orange ghosts!");}};

// ‚îÄ‚îÄ SOLITAIRE (Klondike, simplified) ‚îÄ‚îÄ
IMPL.solitaire={
init(){const v="A23456789TJQK",s="SHDC",d=[];for(const ss of s)for(const vv of v)d.push({v:vv,s:ss,n:v.indexOf(vv),col:"HD".includes(ss)?"#ff4488":"#c0c8e8",up:false});this.deck=d.sort(()=>Math.random()-.5);this.piles=Array(7).fill(null).map((_,i)=>this.deck.splice(0,i+1));this.piles.forEach(p=>{p[p.length-1].up=true;});this.stock=this.deck;this.waste=[];this.found=[{s:"S",cards:[]},{s:"H",cards:[]},{s:"D",cards:[]},{s:"C",cards:[]}];this.sel=null;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="sl2-m">Build foundation piles A‚ÜíK by suit!</div><div style="font-size:.6rem;color:var(--dm);text-align:center;margin-bottom:6px">Click stock, then click cards to move them</div><div id="sl2-g" style="display:flex;flex-direction:column;gap:8px;width:100%;max-width:420px;"></div>';mg.appendChild(w);this.render();},
render(){const g=document.getElementById("sl2-g");if(!g)return;g.innerHTML="";const top=document.createElement("div");top.style.cssText="display:flex;gap:5px;align-items:flex-start;";const stockEl=document.createElement("div");stockEl.className="crd";stockEl.style.cssText="width:42px;height:58px;font-size:.75rem;background:#112233;cursor:pointer;";stockEl.textContent=this.stock.length?"üÇ†":"‚Ü∫";stockEl.onclick=()=>{if(this.stock.length){const c=this.stock.pop();c.up=true;this.waste.push(c);}else{this.stock=[...this.waste].reverse();this.stock.forEach(c=>c.up=false);this.waste=[];}this.render();};top.appendChild(stockEl);const wasteEl=document.createElement("div");wasteEl.className="crd";wasteEl.style.cssText="width:42px;height:58px;font-size:.7rem;flex-direction:column;line-height:1.2;";const wt=this.waste[this.waste.length-1];if(wt)wasteEl.innerHTML='<span style="color:'+wt.col+'">'+wt.v+'</span><span style="font-size:.55rem;color:'+wt.col+'">'+(wt.s==="S"?"‚ô†":wt.s==="H"?"‚ô•":wt.s==="D"?"‚ô¶":"‚ô£")+'</span>';wasteEl.onclick=()=>{if(wt){this.sel={src:"waste",card:wt};}};top.appendChild(wasteEl);const sp=document.createElement("div");sp.style.flex="1";top.appendChild(sp);this.found.forEach((f,fi)=>{const el=document.createElement("div");el.className="crd";el.style.cssText="width:42px;height:58px;font-size:.7rem;flex-direction:column;line-height:1.2;background:#0a1a12;border-color:var(--acc);";const fc=f.cards[f.cards.length-1];if(fc)el.innerHTML='<span style="color:'+fc.col+'">'+fc.v+'</span><span style="font-size:.55rem;color:'+fc.col+'">'+(fc.s==="S"?"‚ô†":fc.s==="H"?"‚ô•":fc.s==="D"?"‚ô¶":"‚ô£")+'</span>';else el.textContent=(fi===0?"‚ô†":fi===1?"‚ô•":fi===2?"‚ô¶":"‚ô£");el.onclick=()=>{if(this.sel)this.moveTo("found",fi);};top.appendChild(el);});g.appendChild(top);const pileRow=document.createElement("div");pileRow.style.cssText="display:flex;gap:5px;align-items:flex-start;";this.piles.forEach((pile,pi)=>{const col=document.createElement("div");col.style.cssText="position:relative;width:42px;min-height:60px;";pile.forEach((card,ci)=>{const el=document.createElement("div");el.className="crd";el.style.cssText="position:absolute;top:"+(ci*14)+"px;width:42px;height:58px;font-size:.7rem;flex-direction:column;line-height:1.2;background:"+(card.up?"var(--bg3)":"#112233")+";";if(card.up)el.innerHTML='<span style="color:'+card.col+'">'+card.v+'</span><span style="font-size:.55rem;color:'+card.col+'">'+(card.s==="S"?"‚ô†":card.s==="H"?"‚ô•":card.s==="D"?"‚ô¶":"‚ô£")+'</span>';else el.textContent="üÇ†";el.onclick=()=>{if(!card.up)return;if(this.sel)this.moveTo("pile",pi,ci);else this.sel={src:"pile",pi,ci,card};};col.appendChild(el);});col.style.height=(pile.length*14+58)+"px";pileRow.appendChild(col);});g.appendChild(pileRow);say(this.sel?"Selected: "+this.sel.card.v:"Click a card to select");const won=this.found.every(f=>f.cards.length===13);if(won)say("YOU WIN! Diddy deals with it.");},
moveTo(dest,idx,ci){if(!this.sel)return;const card=this.sel.card;if(dest==="found"){const f=this.found[idx];const top2=f.cards[f.cards.length-1];if((top2?top2.n+1===card.n&&top2.s===card.s:card.v==="A")&&card.s===this.found[idx].s){f.cards.push(card);this.removeSel();}}else if(dest==="pile"){const pile=this.piles[idx];const top2=pile[pile.length-1];const red=c=>"HD".includes(c.s);if(top2?top2.n-1===card.n&&red(top2)!==red(card):card.v==="K"){if(this.sel.src==="pile"&&ci<this.piles[this.sel.pi].length-1){const moving=this.piles[this.sel.pi].splice(ci);moving.forEach(c=>this.piles[idx].push(c));}else{pile.push(card);this.removeSel();}}else this.sel=null;}this.render();},
removeSel(){if(this.sel.src==="waste")this.waste.pop();else if(this.sel.src==="pile"){const p=this.piles[this.sel.pi];p.splice(this.sel.ci,1);if(p.length&&!p[p.length-1].up)p[p.length-1].up=true;}this.sel=null;},
hint(){say("Build foundation A‚ÜíK by suit. Alternating colors on tableau!");}};
// ‚îÄ‚îÄ CHESS (simplified) ‚îÄ‚îÄ
IMPL.chess={
PIECES:{K:"‚ôî",Q:"‚ôï",R:"‚ôñ",B:"‚ôó",N:"‚ôò",P:"‚ôô",k:"‚ôö",q:"‚ôõ",r:"‚ôú",b:"‚ôù",n:"‚ôû",p:"‚ôü"},
init(){
  this.board=["rnbqkbnr","pppppppp","........","........","........","........","PPPPPPPP","RNBQKBNR"].map(r=>[...r]);
  this.sel=null;this.turn="w";this.over=false;
  const mg=document.getElementById("mgame");mg.innerHTML="";
  const w=document.createElement("div");w.className="gw";
  w.innerHTML='<div class="msg" id="ch-m">You are White ‚ôô ‚Äî click a piece to move</div><div class="brd" id="ch-b" style="grid-template-columns:repeat(8,40px);grid-template-rows:repeat(8,40px);gap:0;padding:0;border-radius:4px;border:2px solid #2a3050;"></div>';
  mg.appendChild(w);this.render();
},
render(){
  const b=document.getElementById("ch-b");if(!b)return;b.innerHTML="";
  const moves=this.sel?this.getMoves(this.sel[0],this.sel[1]):[];
  for(let r=0;r<8;r++)for(let c=0;c<8;c++){
    const d=document.createElement("div");d.className="cl";
    const light=(r+c)%2===0;const piece=this.board[r][c];const isSel=this.sel&&this.sel[0]===r&&this.sel[1]===c;
    const isMove=moves.some(([mr,mc])=>mr===r&&mc===c);
    d.style.cssText="width:40px;height:40px;font-size:1.3rem;background:"+(isSel?"#2a4a2a":isMove?"#1a3a1a":light?"#c8a870":"#6b3e26")+";";
    d.textContent=piece!=="."?(this.PIECES[piece]||piece):"";d.style.color=piece>="A"&&piece<="Z"?"#fff":"#222";
    d.onclick=()=>this.click(r,c);b.appendChild(d);
  }
  sHUD("White ‚ôô","Black ‚ôü Diddy");
},
isWhite(p){return p>="A"&&p<="Z"&&p!==".";},
isBlack(p){return p>="a"&&p<="z";},
click(r,c){
  if(this.over)return;
  const p=this.board[r][c];
  if(this.sel){
    const moves=this.getMoves(this.sel[0],this.sel[1]);
    if(moves.some(([mr,mc])=>mr===r&&mc===c)){
      this.makeMove(this.sel[0],this.sel[1],r,c);this.sel=null;
      if(!this.over){this.turn="b";say("Diddy thinking‚Ä¶");setTimeout(()=>{this.aiMove();this.turn="w";say("Your turn ‚ôô");this.render();},600);}
    }else this.sel=this.isWhite(p)?[r,c]:null;
  }else if(this.isWhite(p)&&this.turn==="w")this.sel=[r,c];
  this.render();
},
makeMove(fr,fc,tr,tc){
  const p=this.board[fr][fc];if(this.board[tr][tc]==="k"){this.over=true;say("You win! Checkmate!");}
  if(this.board[tr][tc]==="K"){this.over=true;say("Diddy wins!");}
  this.board[tr][tc]=p;this.board[fr][fc]=".";
  if(p==="P"&&tr===0)this.board[tr][tc]="Q";
  if(p==="p"&&tr===7)this.board[tr][tc]="q";
},
getMoves(r,c){
  const p=this.board[r][c];const moves=[];const isW=this.isWhite(p);const enemy=isW?this.isBlack.bind(this):this.isWhite.bind(this);const pt=p.toLowerCase();
  const addIfValid=(nr,nc)=>{if(nr>=0&&nr<8&&nc>=0&&nc<8&&(this.board[nr][nc]==="."||enemy(this.board[nr][nc]))){moves.push([nr,nc]);return this.board[nr][nc]===".";}return false;};
  const slide=(dr,dc)=>{for(let i=1;i<8;i++){if(!addIfValid(r+dr*i,c+dc*i))break;}};
  if(pt==="p"){const d=isW?-1:1;if(r+d>=0&&r+d<8&&this.board[r+d][c]===".")moves.push([r+d,c]);if((isW&&r===6||!isW&&r===1)&&this.board[r+d][c]==="."&&this.board[r+d*2][c]===".")moves.push([r+d*2,c]);[-1,1].forEach(dc=>{if(r+d>=0&&r+d<8&&c+dc>=0&&c+dc<8&&enemy(this.board[r+d][c+dc]))moves.push([r+d,c+dc]);});}
  else if(pt==="n")[[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]].forEach(([dr,dc])=>addIfValid(r+dr,c+dc));
  else if(pt==="b")[[-1,-1],[-1,1],[1,-1],[1,1]].forEach(([dr,dc])=>slide(dr,dc));
  else if(pt==="r")[[-1,0],[1,0],[0,-1],[0,1]].forEach(([dr,dc])=>slide(dr,dc));
  else if(pt==="q")[[-1,-1],[-1,1],[1,-1],[1,1],[-1,0],[1,0],[0,-1],[0,1]].forEach(([dr,dc])=>slide(dr,dc));
  else if(pt==="k")[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(([dr,dc])=>addIfValid(r+dr,c+dc));
  return moves;
},
aiMove(){
  const all=[];for(let r=0;r<8;r++)for(let c=0;c<8;c++)if(this.isBlack(this.board[r][c])){this.getMoves(r,c).forEach(([tr,tc])=>all.push({fr:r,fc:c,tr,tc,cap:this.board[tr][tc]!=="."?1:0}));}
  if(!all.length)return;all.sort((a,b)=>b.cap-a.cap);this.makeMove(all[0].fr,all[0].fc,all[0].tr,all[0].tc);
},
hint(){say("Control center squares. Develop knights and bishops first!");}};

// ‚îÄ‚îÄ 15 PUZZLE ‚îÄ‚îÄ
IMPL.p15={
init(){this.tiles=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0];for(let i=0;i<200;i++){const z=this.tiles.indexOf(0);const nb=[z-4,z+4,z%4?z-1:z,z%4<3?z+1:z].filter(n=>n>=0&&n<16&&n!==z);const pick=nb[Math.floor(Math.random()*nb.length)];[this.tiles[z],this.tiles[pick]]=[this.tiles[pick],this.tiles[z]];}this.moves=0;const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="p15-m">Slide tiles to order 1-15!</div><div id="p15-g" style="display:inline-grid;grid-template-columns:repeat(4,64px);gap:3px;background:#1a2030;padding:4px;border-radius:7px;"></div>';mg.appendChild(w);this.render();},
render(){const g=document.getElementById("p15-g");if(!g)return;g.innerHTML="";const z=this.tiles.indexOf(0);this.tiles.forEach((v,i)=>{const d=document.createElement("div");d.style.cssText="width:64px;height:64px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;font-weight:700;border-radius:5px;cursor:"+(v?"pointer":"default")+";background:"+(v?"var(--bg3)":"#0a0a10")+";color:var(--acc);transition:all .1s;";d.textContent=v||"";if(v){const row=Math.floor(i/4),col=i%4,zr=Math.floor(z/4),zc=z%4;if((row===zr&&Math.abs(col-zc)===1)||(col===zc&&Math.abs(row-zr)===1)){d.style.borderColor="var(--acc)";d.style.border="1px solid var(--acc)";d.onclick=()=>{[this.tiles[i],this.tiles[z]]=[this.tiles[z],this.tiles[i]];this.moves++;this.render();if(this.tiles.every((v,i)=>v===i+1||v===0))say("Solved in "+this.moves+" moves! Diddy: impressive.");};}}g.appendChild(d);});say("Moves: "+this.moves+" | Diddy: solving parallel‚Ä¶");},
hint(){say("Move largest numbers to position first. Work top-to-bottom!");}};

// ‚îÄ‚îÄ SOKOBAN ‚îÄ‚îÄ
IMPL.sokoban={
LV:[{map:["#####","#P..#","#.B.#","#.*$#","#####"],w:5,h:5},{map:["#######","#P....#","#.###.#","#.B*$.#","#.....#","#######"],w:7,h:6}],
init(){this.lv=0;this.load(0);},
load(l){const L=this.LV[l%this.LV.length];this.w=L.w;this.h=L.h;this.moves=0;this.map=L.map.map(r=>[...r]);this.px=0;this.py=0;this.boxes=new Set();this.goals=new Set();for(let r=0;r<this.h;r++)for(let c=0;c<this.w;c++){if(this.map[r][c]==="P"){this.px=c;this.py=r;this.map[r][c]=".";}if(this.map[r][c]==="B"){this.boxes.add(c+","+r);this.map[r][c]=".";}if(this.map[r][c]==="$"){this.boxes.add(c+","+r);this.map[r][c]="*";}if(this.map[r][c]==="*")this.goals.add(c+","+r);}
const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="sk-m">Push boxes üì¶ onto goals ‚òÖ ‚Äî Arrow keys</div><div id="sk-g"></div>';mg.appendChild(w);
document.onkeydown=e=>{const m={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};if(m[e.key]){e.preventDefault();this.move2(m[e.key][0],m[e.key][1]);}};this.render();},
move2(dx,dy){const nx=this.px+dx,ny=this.py+dy;if(!this.map[ny]||this.map[ny][nx]==="#")return;const bk=nx+","+ny;if(this.boxes.has(bk)){const bx2=nx+dx,by2=ny+dy;const bk2=bx2+","+by2;if(!this.map[by2]||this.map[by2][bx2]==="#"||this.boxes.has(bk2))return;this.boxes.delete(bk);this.boxes.add(bk2);}this.px=nx;this.py=ny;this.moves++;if([...this.goals].every(g=>this.boxes.has(g))){say("Level "+(this.lv+1)+" done in "+this.moves+" moves!");setTimeout(()=>this.load(++this.lv),1000);}this.render();},
render(){const g=document.getElementById("sk-g");if(!g)return;g.innerHTML="";const grid=document.createElement("div");grid.style.cssText="display:inline-grid;grid-template-columns:repeat("+this.w+",38px);gap:2px;";for(let r=0;r<this.h;r++)for(let c=0;c<this.w;c++){const d=document.createElement("div");const isGoal=this.goals.has(c+","+r);const isBox=this.boxes.has(c+","+r);const isWall=this.map[r][c]==="#";const isPlayer=this.px===c&&this.py===r;d.style.cssText="width:38px;height:38px;display:flex;align-items:center;justify-content:center;font-size:1.4rem;border-radius:3px;background:"+(isWall?"#1a2030":isGoal?"#0a1a2a":"#0a0a10")+";";d.textContent=isWall?"":isPlayer?"üö∂":isBox?(isGoal?"‚úÖ":"üì¶"):isGoal?"‚≠ê":"";grid.appendChild(d);}g.appendChild(grid);say("Moves: "+this.moves+" | Level "+(this.lv+1));},
hint(){say("You can't pull boxes, only push. Plan routes carefully!");}};

// ‚ïê‚ïê‚ïê VISUAL UPGRADES ‚ïê‚ïê‚ïê

// Better score HUD
function sHUD(a, b){
  const el = document.getElementById("msc");
  if(el) el.innerHTML = '<span style="color:var(--acc);font-weight:600">'+a+'</span><span style="color:var(--dm);margin:0 6px">¬∑</span><span style="color:var(--a2)">Diddy: '+b+'</span>';
}
function say(m){
  const el = document.getElementById("msc");
  if(el) el.innerHTML = '<span style="color:var(--a4)">'+m+'</span>';
}

// Canvas glow helper
function ctxGlow(ctx, color, blur){
  ctx.shadowColor = color;
  ctx.shadowBlur = blur||12;
}
function ctxNoGlow(ctx){ ctx.shadowBlur=0; }

// Upgrade card hover ‚Äî pulse animation on cards
document.querySelectorAll('.card').forEach(card => {
  card.addEventListener('mouseenter', () => {
    card.style.transition = 'all .18s';
  });
});

// Stub games get a nicer placeholder
const _stub = stub;
window.stub = function(g) {
  const catColor = {Arcade:'#ff6600',Board:'#4488ff',Card:'#ffcc00',Puzzle:'#aa44ff',Word:'#00ccff',Casual:'#44ff88'}[g.cat] || '#00ff88';
  document.getElementById("mgame").innerHTML =
    '<div style="text-align:center;padding:50px 20px;">' +
    '<div style="font-size:4rem;filter:drop-shadow(0 0 20px '+catColor+'66)">'+g.icon+'</div>' +
    '<div style="font-size:1rem;margin-top:14px;color:'+catColor+';font-family:Orbitron,monospace;font-weight:700;letter-spacing:.06em">'+g.name.toUpperCase()+'</div>' +
    '<div style="font-size:.6rem;margin-top:8px;color:var(--dm)">Click NEW to play</div>' +
    '</div>';
};

// Better modal title color per category
const _openGame = openGame;
window.openGame = function(id) {
  _openGame(id);
  const g = GAMES.find(x=>x.id===id);
  if(!g) return;
  const catColor = {Arcade:'#ff6600',Board:'#4488ff',Card:'#ffcc00',Puzzle:'#aa44ff',Word:'#00ccff',Casual:'#44ff88'}[g.cat] || '#00ff88';
  const hdr = document.getElementById("mhdr");
  const title = document.getElementById("mtitle");
  if(hdr) hdr.style.borderBottom = '2px solid '+catColor+'44';
  if(title) title.style.color = catColor;
};

</script></body></html>

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MOBILE CONTROLS ‚Äî universal touch support
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// Virtual D-pad builder
function mkDpad(opts){
  const {up,down,left,right,action,actionLabel="üî•"} = opts;
  const wrap = document.createElement("div");
  wrap.style.cssText = "display:flex;gap:18px;align-items:center;justify-content:center;margin-top:10px;user-select:none;";

  const dpad = document.createElement("div");
  dpad.style.cssText = "display:grid;grid-template-columns:44px 44px 44px;grid-template-rows:44px 44px 44px;gap:3px;";

  const btn = (label, fn, gridArea) => {
    const b = document.createElement("div");
    b.style.cssText = "grid-area:"+gridArea+";width:44px;height:44px;background:#1a2030;border:2px solid #2a3050;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;cursor:pointer;active:background:#2a3050;-webkit-tap-highlight-color:transparent;";
    b.textContent = label;
    const fire = e => { e.preventDefault(); fn && fn(); };
    b.addEventListener("touchstart", fire, {passive:false});
    b.addEventListener("mousedown", fire);
    return b;
  };

  // grid: row/col
  const empty = () => { const d=document.createElement("div"); return d; };
  dpad.appendChild(empty());
  dpad.appendChild(btn("‚ñ≤", up, "1/2"));
  dpad.appendChild(empty());
  dpad.appendChild(btn("‚óÄ", left, "2/1"));
  dpad.appendChild(empty());
  dpad.appendChild(btn("‚ñ∂", right, "2/3"));
  dpad.appendChild(empty());
  dpad.appendChild(btn("‚ñº", down, "3/2"));
  dpad.appendChild(empty());
  wrap.appendChild(dpad);

  if(action){
    const ab = document.createElement("div");
    ab.style.cssText = "width:62px;height:62px;background:var(--a2);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;cursor:pointer;-webkit-tap-highlight-color:transparent;box-shadow:0 4px 16px #ff448866;";
    ab.textContent = actionLabel;
    const fire = e => { e.preventDefault(); action(); };
    ab.addEventListener("touchstart", fire, {passive:false});
    ab.addEventListener("mousedown", fire);
    wrap.appendChild(ab);
  }

  return wrap;
}

// Swipe detector for a canvas element
function addSwipe(el, {up,down,left,right}){
  let sx,sy;
  el.addEventListener("touchstart", e=>{ sx=e.touches[0].clientX; sy=e.touches[0].clientY; },{passive:true});
  el.addEventListener("touchend", e=>{
    const dx=e.changedTouches[0].clientX-sx, dy=e.changedTouches[0].clientY-sy;
    if(Math.max(Math.abs(dx),Math.abs(dy))<20) return;
    if(Math.abs(dx)>Math.abs(dy)){ dx>0?right&&right():left&&left(); }
    else{ dy>0?down&&down():up&&up(); }
  },{passive:true});
}

// ‚îÄ‚îÄ Patch PONG: add up/down mobile buttons ‚îÄ‚îÄ
const _pongInit = IMPL.pong.init.bind(IMPL.pong);
IMPL.pong.init = function(){
  _pongInit();
  const mg = document.getElementById("mgame");
  const dpad = mkDpad({
    up: ()=>{ if(IMPL.pong._ps!==undefined) IMPL.pong._ps=Math.max(0,IMPL.pong._ps-16); },
    down: ()=>{ if(IMPL.pong._ps!==undefined) IMPL.pong._ps=Math.min(280-54,IMPL.pong._ps+16); },
  });
  dpad.querySelector("div:nth-child(5)").style.display="none"; // hide center
  mg.appendChild(dpad);
};

// ‚îÄ‚îÄ Patch SNAKE: swipe + d-pad ‚îÄ‚îÄ
const _snakeInit = IMPL.snake.init.bind(IMPL.snake);
IMPL.snake.init = function(){
  _snakeInit();
  const mg = document.getElementById("mgame");
  const c = mg.querySelector("canvas");
  if(c) addSwipe(c, {
    up:   ()=>document.onkeydown({key:"ArrowUp",  preventDefault:()=>{}}),
    down: ()=>document.onkeydown({key:"ArrowDown", preventDefault:()=>{}}),
    left: ()=>document.onkeydown({key:"ArrowLeft", preventDefault:()=>{}}),
    right:()=>document.onkeydown({key:"ArrowRight",preventDefault:()=>{}}),
  });
  mg.appendChild(mkDpad({
    up:   ()=>document.onkeydown&&document.onkeydown({key:"ArrowUp",  preventDefault:()=>{}}),
    down: ()=>document.onkeydown&&document.onkeydown({key:"ArrowDown", preventDefault:()=>{}}),
    left: ()=>document.onkeydown&&document.onkeydown({key:"ArrowLeft", preventDefault:()=>{}}),
    right:()=>document.onkeydown&&document.onkeydown({key:"ArrowRight",preventDefault:()=>{}}),
  }));
};

// ‚îÄ‚îÄ Patch TETRIS: d-pad + drop button ‚îÄ‚îÄ
const _tetrisInit = IMPL.tetris.init.bind(IMPL.tetris);
IMPL.tetris.init = function(){
  _tetrisInit();
  const mg = document.getElementById("mgame");
  mg.appendChild(mkDpad({
    up:    ()=>IMPL.tetris.rot2(),
    down:  ()=>IMPL.tetris.mv(0,1),
    left:  ()=>IMPL.tetris.mv(-1,0),
    right: ()=>IMPL.tetris.mv(1,0),
    action:()=>IMPL.tetris.drop(),
    actionLabel:"‚¨á",
  }));
};

// ‚îÄ‚îÄ Patch SPACE INVADERS: left/right/fire ‚îÄ‚îÄ
const _invInit = IMPL.invaders.init.bind(IMPL.invaders);
IMPL.invaders.init = function(){
  _invInit();
  const mg = document.getElementById("mgame");
  const d = document.createElement("div");
  d.style.cssText = "display:flex;gap:12px;justify-content:center;margin-top:10px;";
  const mb2 = (label,fn,col) => {
    const b=document.createElement("div");
    b.style.cssText="width:62px;height:62px;background:"+(col||"#1a2030")+";border:2px solid #2a3050;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;cursor:pointer;-webkit-tap-highlight-color:transparent;";
    b.textContent=label;
    let iv;
    b.addEventListener("touchstart",e=>{e.preventDefault();fn();iv=setInterval(fn,80);},{passive:false});
    b.addEventListener("touchend",()=>clearInterval(iv));
    b.addEventListener("mousedown",()=>{fn();iv=setInterval(fn,80);});
    b.addEventListener("mouseup",()=>clearInterval(iv));
    return b;
  };
  const fire=()=>document.onkeydown&&document.onkeydown({key:" ",preventDefault:()=>{}});
  d.appendChild(mb2("‚óÄ",()=>document.onkeydown&&document.onkeydown({key:"ArrowLeft",preventDefault:()=>{}})));
  d.appendChild(mb2("üî•",fire,"#440022"));
  d.appendChild(mb2("‚ñ∂",()=>document.onkeydown&&document.onkeydown({key:"ArrowRight",preventDefault:()=>{}})));
  mg.appendChild(d);
};

// ‚îÄ‚îÄ Patch BREAKOUT: left/right ‚îÄ‚îÄ
const _brInit = IMPL.breakout.init.bind(IMPL.breakout);
IMPL.breakout.init = function(){
  _brInit();
  const mg = document.getElementById("mgame");
  const c = mg.querySelector("canvas");
  if(c){ c.ontouchstart=e=>{ e.preventDefault(); IMPL.breakout._go=true; }; }
  const d = document.createElement("div");
  d.style.cssText = "display:flex;gap:12px;justify-content:center;margin-top:10px;";
  const hold=(fn)=>{let iv; const b=document.createElement("div");b.style.cssText="width:80px;height:52px;background:#1a2030;border:2px solid #2a3050;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.8rem;cursor:pointer;-webkit-tap-highlight-color:transparent;";b.addEventListener("touchstart",e=>{e.preventDefault();iv=setInterval(fn,30);},{passive:false});b.addEventListener("touchend",()=>clearInterval(iv));b.addEventListener("mousedown",()=>iv=setInterval(fn,30));b.addEventListener("mouseup",()=>clearInterval(iv));return b;};
  const L=hold(()=>document.onkeydown&&document.onkeydown({key:"ArrowLeft",preventDefault:()=>{}}));L.textContent="‚óÄ";
  const R=hold(()=>document.onkeydown&&document.onkeydown({key:"ArrowRight",preventDefault:()=>{}}));R.textContent="‚ñ∂";
  d.appendChild(L);d.appendChild(R);mg.appendChild(d);
};

// ‚îÄ‚îÄ Patch FLAPPY: already tappable, just ensure canvas taps work ‚îÄ‚îÄ

// ‚îÄ‚îÄ Patch FROGGER: d-pad ‚îÄ‚îÄ
const _frInit = IMPL.frogger.init.bind(IMPL.frogger);
IMPL.frogger.init = function(){
  _frInit();
  const mg = document.getElementById("mgame");
  mg.appendChild(mkDpad({
    up:   ()=>document.onkeydown&&document.onkeydown({key:"ArrowUp",  preventDefault:()=>{}}),
    down: ()=>document.onkeydown&&document.onkeydown({key:"ArrowDown", preventDefault:()=>{}}),
    left: ()=>document.onkeydown&&document.onkeydown({key:"ArrowLeft", preventDefault:()=>{}}),
    right:()=>document.onkeydown&&document.onkeydown({key:"ArrowRight",preventDefault:()=>{}}),
  }));
};

// ‚îÄ‚îÄ Patch ASTEROIDS: full controls ‚îÄ‚îÄ
const _astInit = IMPL.asteroids.init.bind(IMPL.asteroids);
IMPL.asteroids.init = function(){
  _astInit();
  const mg = document.getElementById("mgame");
  const d = document.createElement("div");
  d.style.cssText = "display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin-top:8px;";
  const tb = (label,key,col,repeat) => {
    const b=document.createElement("div");
    b.style.cssText="width:54px;height:54px;background:"+(col||"#1a2030")+";border:2px solid #2a3050;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.3rem;cursor:pointer;-webkit-tap-highlight-color:transparent;";
    b.textContent=label;
    const dn=()=>{document.onkeydown&&document.onkeydown({key,preventDefault:()=>{}});};
    const up=()=>{document.onkeyup&&document.onkeyup({key});};
    if(repeat){b.addEventListener("touchstart",e=>{e.preventDefault();document.onkeydown=document.onkeydown;dn();},{passive:false});b.addEventListener("touchend",up);b.addEventListener("mousedown",dn);b.addEventListener("mouseup",up);}
    else{b.addEventListener("touchstart",e=>{e.preventDefault();dn();setTimeout(up,80);},{passive:false});b.addEventListener("mousedown",()=>{dn();setTimeout(up,80);});}
    return b;
  };
  d.appendChild(tb("‚Ü∫","ArrowLeft","",true));
  d.appendChild(tb("üöÄ","ArrowUp","#004422",true));
  d.appendChild(tb("‚Üª","ArrowRight","",true));
  d.appendChild(tb("üí•"," ","#440022",false));
  mg.appendChild(d);
};

// ‚îÄ‚îÄ Patch PAC-MAN: swipe + d-pad ‚îÄ‚îÄ
const _pmInit = IMPL.pacman.init.bind(IMPL.pacman);
IMPL.pacman.init = function(){
  _pmInit();
  const mg = document.getElementById("mgame");
  const c = mg.querySelector("canvas");
  if(c) addSwipe(c, {
    up:   ()=>document.onkeydown&&document.onkeydown({key:"ArrowUp",  preventDefault:()=>{}}),
    down: ()=>document.onkeydown&&document.onkeydown({key:"ArrowDown",preventDefault:()=>{}}),
    left: ()=>document.onkeydown&&document.onkeydown({key:"ArrowLeft",preventDefault:()=>{}}),
    right:()=>document.onkeydown&&document.onkeydown({key:"ArrowRight",preventDefault:()=>{}}),
  });
  mg.appendChild(mkDpad({
    up:   ()=>document.onkeydown&&document.onkeydown({key:"ArrowUp",  preventDefault:()=>{}}),
    down: ()=>document.onkeydown&&document.onkeydown({key:"ArrowDown",preventDefault:()=>{}}),
    left: ()=>document.onkeydown&&document.onkeydown({key:"ArrowLeft",preventDefault:()=>{}}),
    right:()=>document.onkeydown&&document.onkeydown({key:"ArrowRight",preventDefault:()=>{}}),
  }));
};

// ‚îÄ‚îÄ Patch TRON: d-pad ‚îÄ‚îÄ
const _tronInit = IMPL.tron.init.bind(IMPL.tron);
IMPL.tron.init = function(){
  _tronInit();
  const mg = document.getElementById("mgame");
  mg.appendChild(mkDpad({
    up:   ()=>document.onkeydown&&document.onkeydown({key:"ArrowUp",  preventDefault:()=>{}}),
    down: ()=>document.onkeydown&&document.onkeydown({key:"ArrowDown",preventDefault:()=>{}}),
    left: ()=>document.onkeydown&&document.onkeydown({key:"ArrowLeft",preventDefault:()=>{}}),
    right:()=>document.onkeydown&&document.onkeydown({key:"ArrowRight",preventDefault:()=>{}}),
  }));
};

// ‚îÄ‚îÄ Patch 2048: swipe support ‚îÄ‚îÄ
const _g48Init = IMPL.g2048.init.bind(IMPL.g2048);
IMPL.g2048.init = function(){
  _g48Init();
  const mg = document.getElementById("mgame");
  const g = mg.querySelector(".g48");
  if(g) addSwipe(g, {
    up:   ()=>IMPL.g2048.move("U"),
    down: ()=>IMPL.g2048.move("D"),
    left: ()=>IMPL.g2048.move("L"),
    right:()=>IMPL.g2048.move("R"),
  });
  // also add arrow buttons below
  const d = document.createElement("div");
  d.style.cssText = "display:grid;grid-template-columns:50px 50px 50px;grid-template-rows:50px 50px;gap:4px;margin-top:8px;";
  const ab=(lbl,fn,r,c)=>{const b=document.createElement("div");b.style.cssText="grid-row:"+r+";grid-column:"+c+";background:#1a2030;border:2px solid #2a3050;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;cursor:pointer;-webkit-tap-highlight-color:transparent;";b.textContent=lbl;b.addEventListener("touchstart",e=>{e.preventDefault();fn();},{passive:false});b.addEventListener("mousedown",fn);return b;};
  d.appendChild(ab("‚ñ≤",()=>IMPL.g2048.move("U"),1,2));
  d.appendChild(ab("‚óÄ",()=>IMPL.g2048.move("L"),2,1));
  d.appendChild(ab("‚ñº",()=>IMPL.g2048.move("D"),2,2));
  d.appendChild(ab("‚ñ∂",()=>IMPL.g2048.move("R"),2,3));
  mg.appendChild(d);
};

// ‚îÄ‚îÄ Patch SOKOBAN: d-pad ‚îÄ‚îÄ
const _skInit = IMPL.sokoban.load.bind(IMPL.sokoban);
IMPL.sokoban.init = function(){
  this.lv=0;this.load2(0);
};
IMPL.sokoban.load2 = function(l){
  const LV=this.LV;const L=LV[l%LV.length];this.w=L.w;this.h=L.h;this.moves=0;this.map=L.map.map(r=>[...r]);this.px=0;this.py=0;this.boxes=new Set();this.goals=new Set();for(let r=0;r<this.h;r++)for(let c=0;c<this.w;c++){if(this.map[r][c]==="P"){this.px=c;this.py=r;this.map[r][c]=".";}if(this.map[r][c]==="B"){this.boxes.add(c+","+r);this.map[r][c]=".";}if(this.map[r][c]==="$"){this.boxes.add(c+","+r);this.map[r][c]="*";}if(this.map[r][c]==="*")this.goals.add(c+","+r);}
  const mg=document.getElementById("mgame");mg.innerHTML="";const w=document.createElement("div");w.className="gw";w.innerHTML='<div class="msg" id="sk-m">Push boxes onto goals!</div><div id="sk-g"></div>';mg.appendChild(w);
  this.render();
  const dpad=mkDpad({up:()=>this.move2(0,-1),down:()=>this.move2(0,1),left:()=>this.move2(-1,0),right:()=>this.move2(1,0)});mg.appendChild(dpad);
};

// ‚îÄ‚îÄ Patch TYPE RACER: prevent zoom on input ‚îÄ‚îÄ
const _trInit = IMPL.typerace.init.bind(IMPL.typerace);
IMPL.typerace.init = function(){
  _trInit();
  const i = document.getElementById("tr-i");
  if(i) i.style.fontSize = "16px"; // prevents iOS zoom
};

